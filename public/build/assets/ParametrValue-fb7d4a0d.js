import{b as Ve,c as ye,r,F as o,d as H,x as K,K as xe,o as De,N as Ne,f as w,g as T,h as z,i as C,k as d,l as F,j as b,L as W,M as Ee,m as c,V as Ie,n as Te,D as j,I as Fe,J as _e,B as ke,t as Re,O as Se}from"./app-b5e7d578.js";/* empty css                   */import{_ as Me}from"./EditValue-ebe81afc.js";import{f as M}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Ae={class:"grid grid-rows-[55px,1fr]"},Pe=C("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ue={class:"flex flex-col"},Oe={class:"m-2 flex"},Be="yyyy-MM-dd",Le=8*60,$e=19*60+59,je={__name:"ParametrValue",setup(qe){const Q=Ve(),{t:n,locale:J}=ye(),A=r([]),u=r(null),g=r({}),P=r([]),_=r(new Date),X=r(null),D=r(null),Y=r(null),U=r(null);r(null);const p=r(null),Z=o.state.user.id,ee=o.state.user.structure_id,m=r(null);r([]);const ae=r([]),N=r([]),te=r([]),le=r([]);r(0);const E=H({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:o.state.user.structure_id,SourceID:"",userId:o.state.user.id}),i=H({id:"",Comment:"",Value:"",userId:o.state.user.id}),O=r([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0,cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=g.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,s;return e.data&&e.data.Value!==((a=g.value)==null?void 0:a[e.data.id])&&((s=g.value)==null?void 0:s[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"}},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:K(()=>J.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:e=>(console.log("params.data:",e.data),e.data&&e.data.WithFormula!=="1"),suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=g.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,s;return e.data&&e.data.Value!==((a=g.value)==null?void 0:a[e.data.id])&&((s=g.value)==null?void 0:s[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),se=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?m.value>1?m.value-=1:m.value=N.value.length:m.value<N.value.length?m.value+=1:m.value=1)},re=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&u.navigateToNextCell({key:e.key}))},ne=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&re(e)})};function oe(){const e=U.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const B=async()=>{try{const e=await c.get("/changes"),a=await c.get("/pages");N.value=a.data;const s=await c.get(`/paramWithId/${ee}`);P.value=e.data.map(t=>({value:t.Change,text:t.Change})),ae.value=s.data.map(t=>({value:t.Pid,text:t.PName}));const f=await c.get("/source");te.value=f.data.map(t=>({value:t.id,text:t.Name}));const h=await c.get("/graphictimes");le.value=h.data.map(t=>({value:t.id,text:t.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},ue={sortable:!0,filter:!0,resizable:!0},ie=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",L={columnDefs:O.value,suppressScrollOnNewData:!0,getRowClass:ie,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},de=e=>{console.log("Updated Data:",e)},ce=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},$=()=>{const e=ce();return e>=Le&&e<=$e?1:2},me=()=>{Q.push("/vparamsget")};E.Change=$(),K(()=>$());async function k(e){o.state.newValue=e;const a=E.Change,s=M(_.value,Be);new Date().getHours();try{const[f,h]=await c.all([c.get(`/get-params-for-user/${o.state.user.structure_id}/${a}/${s}/${e}`),c.get(`/vparams-value/${o.state.user.structure_id}/${s}`)]),t=f.data,x=h.data;t.forEach((v,l)=>{const q=x.find(G=>G.TimeID==v.GTid&&G.ParametersID==v.ParametersID);q&&(t[l]={...v,...q})}),A.value=t}catch(f){console.error("Error fetching data:",f)}}const fe=async e=>{const{data:a,colDef:s,newValue:f,oldValue:h}=e;if(f!==h)try{await he(a);const t=e.rowIndex,x=u.value.getDisplayedRowCount();if(u.value&&u.value.ensureIndexVisible(t,"bottom"),t<x-1){u.value.stopEditing();const v=s.field==="Value"?"Value":"Comment";u.value.setFocusedCell(t+1,v)}}catch(t){console.error("Error saving data",t)}},he=async e=>{try{const a=await c.post("/vparams",{...e,userId:Z});return ve(),k(o.state.newValue),a}catch(a){console.error("Error saving data",a)}},ve=()=>{u.value&&u.value.clearFocusedCell()},ge=()=>{I.value&&u.value&&(u.value.stopEditing(),I.value=!1)};let V=null,y=null,I=r(!1);const pe=e=>{const{column:a}=e;if(a){const s=a.getColId();s==="Value"||s==="Comment"?(S(),I.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(ge,6e4)):R()}},we=e=>{const{column:a}=e;if(a){const s=a.getColId();(s==="Value"||s==="Comment")&&(S(),I.value=!1,p.value&&(clearTimeout(p.value),p.value=null))}},R=()=>{V||(o.state.newValue=o.state.newValue||1,V=setInterval(()=>k(o.state.newValue),6e4)),y||(y=setInterval(B,6e4))},be=async e=>{try{const{data:a}=await c.post("/vparamsEdit",i);a.status===200?(X.value=!1,i.id="",i.Comment="",i.Value="",i.userId="",e.setData(a.updatedRowData),L.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},S=()=>{V&&(clearInterval(V),V=null),y&&(clearInterval(y),y=null)},Ce=e=>{u.value=e.api,e.api.addEventListener("cellFocused",pe),e.api.addEventListener("cellBlurred",we),R()};return xe(m,e=>{k(e)}),De(()=>{B(),R(),ne()}),Ne(()=>{S()}),(e,a)=>{const s=w("VaTextarea"),f=w("VaModal"),h=w("VaDateInput"),t=w("VaSelect"),x=w("VaTab"),v=w("ag-grid-vue");return T(),z("div",Ae,[C("main",null,[d(f,{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=l=>D.value=l),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=l=>be(Y.value)),"close-button":""},{default:F(()=>[Pe,C("div",null,[d(b(Ie),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:F(()=>[d(b(Te),{class:"w-full",modelValue:i.Value,"onUpdate:modelValue":a[0]||(a[0]=l=>i.Value=l),rules:[l=>l&&l.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),d(s,{class:"w-full",modelValue:i.Comment,"onUpdate:modelValue":a[1]||(a[1]=l=>i.Comment=l),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),C("main",Ue,[C("div",Oe,[d(h,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=l=>_.value=l),class:"mr-2",label:"Day"},null,8,["modelValue"]),d(t,{modelValue:E.Change,"onUpdate:modelValue":a[5]||(a[5]=l=>E.Change=l),"value-by":"value",label:b(n)("menu.changes"),options:P.value,clearable:""},null,8,["modelValue","label","options"]),d(b(j),{onClick:oe,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),d(b(j),{onClick:me,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),C("div",{ref_key:"gridContainer",ref:U,class:"ag-grid-container h-full"},[d(b(Se),{modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=l=>m.value=l),stateful:"",grow:"",onKeydown:se,tabindex:"0"},{tabs:F(()=>[(T(!0),z(Fe,null,_e(N.value,l=>(T(),W(x,{key:l.id,name:l.id},{default:F(()=>[ke(Re(l.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),d(v,{rowData:A.value,columnDefs:O.value,defaultColDef:ue,gridOptions:L,animateRows:"true",class:"ag-theme-material h-full",onGridReady:Ce,onCellValueChanged:fe,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),D.value?(T(),W(Me,{key:0,showModalEdit:D.value,resultEdit:i,onUpdate:de},null,8,["showModalEdit","resultEdit"])):Ee("",!0)])])}}};export{je as default};

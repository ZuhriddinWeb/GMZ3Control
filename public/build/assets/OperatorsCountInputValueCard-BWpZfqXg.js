import{C as j,R as H,u as K,c as G,r as g,s as k,b as J,K as Z,o as Q,D as W,n as v,S as X,f as Y,g as I,h as D,i as l,I as ee,J as te,j as y,l as ae,k as b,m as le,T as se,U as ne,G as oe,z as $,t as _}from"./app-CmvRHBI6.js";/* empty css                   */import{V as re}from"./VueShiftCalendar-B4FSYX5G.js";j.register(...H);const ie={class:"grid grid-rows-[55px,1fr] bg-stone-100"},ue={class:"flex justify-between w-full mt-6 px-4"},de={class:"flex flex-col w-full"},ce={class:"w-full"},me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-1 my-6 shadow-sm border border-slate-200 mt-16 p-4"},pe=["onClick"],fe={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},ge={class:"flex justify-between"},ve={class:"flex flex-col w-9/12"},ye={class:"mb-2 text-slate-800 font-semibold flex items-center p-2"},be=["innerHTML"],_e={class:"p-2"},xe={class:"grid grid-cols-[min-content,auto] gap-x-2 gap-y-1 font-semibold m-2"},he={class:"text-green-600"},we={class:"text-red-600"},Ce={class:"text-blue-600"},ke={class:"text-teal-600"},Ie={class:"text-purple-600"},De={class:"flex flex-col justify-between"},Ve={class:"w-[200] mt-20 mr-2"},$e={__name:"OperatorsCountInputValueCard",setup(Re){const{init:Te}=K(),{locale:x,t:V}=G(),r=g({smena:null,day:null}),B=k(()=>route.query.type);let R=null,T=null;const h=J(),c=g([]);g(null);const w=g(null);function z(a){h.push({name:"OperatorDetail",params:{id:a}})}function A(a){w.value=a,C()}function P(a){h.push({name:"OperatorDetail",params:{id:a},query:{type:"inputed"}})}function E(a){h.push({name:"OperatorDetail",params:{id:a},query:{type:"not_inputed"}})}const O=k(()=>r.value.day?`${r.value.day} - ${r.value.smena}`:"");function M(a){const o=(x.value==="ru"?a.NameRus:a.Name).split(" "),e=[];for(let s=0;s<o.length;s+=3)e.push(o.slice(s,s+3).join(" "));return e.join("<br>")}Z(r,async a=>{a.day&&a.smena&&(c.value.forEach(t=>{t.loading=!0}),await C())},{deep:!0}),k(()=>B.value==="inputed"?allData.value.filter(a=>a.Value!==null):B.value==="not_inputed"?allData.value.filter(a=>a.Value===null):allData.value);const S=g(0),F=g(0);async function C(){const a=r.value.day,t=r.value.smena;if(!(!a||!t)){if(S.value=0,F.value=0,w.value){const{data:o}=await v.get(`/getRowPageResult/${w.value}`,{params:{day:a,smena:t}}),e=o.reduce((s,n)=>(s.total+=n.multiplied_parameter_count,s.filled+=n.kiritilgan,s.formula+=n.multiplied_formula_count,s.manual+=n.multiplied_manual_count,s),{total:0,filled:0,formula:0,manual:0});S.value=e.formula,F.value=e.manual}else{const{data:o}=await v.get("/structure");for(const e of o){const s=await v.get(`/getRowPageResult/${e.id}`,{params:{day:a,smena:t}}),n=s.data.reduce((u,p)=>u+p.multiplied_parameter_count,0),i=s.data.reduce((u,p)=>u+p.kiritilgan,0),d=s.data.reduce((u,p)=>u+p.multiplied_formula_count,0),f=s.data.reduce((u,p)=>u+p.multiplied_manual_count,0),q=n-i;S.value+=d,F.value+=f;const m=c.value.find(u=>u.id===e.id);m&&(m.loading=!0,m.filled=i,m.notFilled=q,m.formula=d,m.manual=f,m.loading=!1)}}if(await se(),U(),!w.value){let o=0,e=0;const{data:s}=await v.get("/structure");for(const n of s){const i=await v.get(`/getRowPageResult/${n.id}`,{params:{day:a,smena:t}});o+=i.data.reduce((d,f)=>d+f.multiplied_parameter_count,0),e+=i.data.reduce((d,f)=>d+f.kiritilgan,0)}L(e,o)}}}function U(){const a=document.getElementById("barChart");if(!a)return;R&&R.destroy();const t=c.value.map(s=>x.value==="ru"?s.NameRus:s.Name),o=c.value.map(s=>s.filled),e=c.value.map(s=>s.notFilled);R=new j(a,{type:"bar",data:{labels:t,datasets:[{label:V("To‘ldirilgan"),data:o,backgroundColor:"rgba(34,197,94,0.6)"},{label:V("To‘ldirilmagan"),data:e,backgroundColor:"rgba(239,68,68,0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:V("Bo‘limlar bo‘yicha parametrlar holati")},legend:{position:"top"}},scales:{x:{ticks:{autoSkip:!1,maxRotation:90,minRotation:45}},y:{beginAtZero:!0}}}})}function L(a,t){const o=document.getElementById("pieChart");o&&(T&&T.destroy(),T=new j(o,{type:"pie",data:{labels:["Kiritilgan","Kiritilmagan"],datasets:[{data:[a,t-a],backgroundColor:["#10b981","#ef4444"]}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},title:{display:!0,text:"Umumiy parametrlar"}}}}))}let N=null;return Q(async()=>{document.body.style.transform="scale(0.9)",document.body.style.transformOrigin="top left",document.body.style.width="111.11%";const a=localStorage.getItem("locale");a&&(x.value=a);const t=new Date,o=t.getHours(),e=t.toISOString().split("T")[0],s=o>=8&&o<20?1:2;(!r.value.day||!r.value.smena)&&(r.value={day:e,smena:s});try{const n=W.state.user.structure_id;if(Array.isArray(n)&&n.length===1){const i=n[0];h.push({name:"OperatorDetail",params:{id:i}})}else if(Array.isArray(n)&&n.length>1){const i=await v.get(`/structures/${n.join(",")}`);c.value=i.data.map(d=>({...d,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(n){console.error("Error fetching data:",n)}await C(),N=setInterval(()=>{C()},6e5)}),k(()=>x.value==="uz"?"Русский":"O‘zbek"),X(()=>{N&&clearInterval(N)}),(a,t)=>{const o=Y("VaProgressCircle");return D(),I("div",ie,[l("div",ue,[l("div",de,[l("div",ce,[l("div",me,[(D(!0),I(ee,null,te(c.value,(e,s)=>(D(),I("div",{onClick:n=>A(e.id),key:s,class:ne(["relative p-1 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(D(),I("div",fe,[y(o,{indeterminate:"",size:"medium"})])):oe("",!0),l("div",ge,[l("div",ve,[l("div",null,[l("h5",ye,[l("span",{class:"block flex-grow leading-none",innerHTML:M(e)},null,8,be)])]),l("div",null,[l("div",_e,[y(b($),{onClick:n=>z(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),y(b($),{onClick:n=>P(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),y(b($),{onClick:n=>E(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])])])]),l("div",xe,[t[2]||(t[2]=l("span",{class:"text-green-600 material-symbols-outlined text-lg mr-3"},"edit",-1)),l("span",he,_(e.filled),1),t[3]||(t[3]=l("span",{class:"text-red-600 material-symbols-outlined text-lg mr-3"},"warning",-1)),l("span",we,_(e.notFilled),1),t[4]||(t[4]=l("span",{class:"text-blue-600 material-symbols-outlined text-lg mr-3"},"support_agent",-1)),l("span",Ce,_(e.manual),1),t[5]||(t[5]=l("span",{class:"text-teal-600 material-symbols-outlined text-lg mr-3"},"function",-1)),l("span",ke,_(e.formula),1),t[6]||(t[6]=l("span",{class:"text-purple-600 material-symbols-outlined text-lg mr-3"},"%",-1)),l("span",Ie,_(e.filled+e.notFilled>0?Math.round(e.filled/(e.filled+e.notFilled)*100):0),1)])])],10,pe))),128))])]),t[7]||(t[7]=l("div",{class:"p-6 bg-white border border-slate-200 shadow-lg mt-2 mx-3 rounded-lg"},[l("div",{style:{height:"280px"}},[l("canvas",{id:"barChart"})])],-1))]),l("div",De,[l("div",Ve,[y(b(re),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),class:"w-full mr-2 shadow-lg"},{default:ae(()=>[y(b(le),{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),t[8]||(t[8]=l("div",{class:"w-full mr-2 mt-80 flex justify-center"},[l("canvas",{id:"pieChart",class:"w-[350px] h-[350px]"})],-1))])])])}}};export{$e as default};

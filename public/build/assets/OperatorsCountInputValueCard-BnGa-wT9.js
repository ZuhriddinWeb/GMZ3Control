import{u as B,c as L,r as m,s as x,b as P,K as q,o as E,D as H,n as h,R as U,f as G,g as w,h as C,i as l,j as p,l as J,k as f,m as K,I as Q,J as W,S as X,G as Y,z as j,t as g}from"./app-C4uAHtRq.js";/* empty css                   */import{V as Z}from"./VueShiftCalendar-If09_iqE.js";const ee={class:"grid grid-rows-[55px,1fr] bg-stone-100"},te={class:"flex flex-row-reverse justify-between w-full"},ae={class:"w-[200] mt-28 mr-2"},le={class:"flex-1 w-5/6"},se={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 my-6 shadow-sm border border-slate-200 mt-24 p-4"},ne=["onClick"],oe={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},re={class:"mb-2 text-slate-800 font-semibold flex items-center"},ie=["innerHTML"],ue={class:"flex justify-between"},de={class:"flex justify-between flex-col"},ce={class:"flex justify-end"},me={class:"absolute top-1 right-2 w-20 grid grid-cols-[min-content,1fr] gap-x-2 gap-y-1 font-semibold text-right"},pe={class:"text-green-600 text-base"},fe={class:"text-red-600 text-base"},ge={class:"text-blue-600 text-base"},ve={class:"text-teal-600 text-base"},ye={class:"text-purple-600 text-base"},ke={__name:"OperatorsCountInputValueCard",setup(_e){const{init:be}=B(),{locale:k,t:xe}=L(),o=m({smena:null,day:null}),$=x(()=>route.query.type),v=P(),y=m([]);m(null);const V=m(null);function T(a){v.push({name:"OperatorDetail",params:{id:a}})}function O(a){V.value=a,_()}function R(a){v.push({name:"OperatorDetail",params:{id:a},query:{type:"inputed"}})}function z(a){v.push({name:"OperatorDetail",params:{id:a},query:{type:"not_inputed"}})}const F=x(()=>o.value.day?`${o.value.day} - ${o.value.smena}`:"");function M(a){const r=(k.value==="ru"?a.NameRus:a.Name).split(" "),e=[];for(let s=0;s<r.length;s+=2)e.push(r.slice(s,s+2).join(" "));return e.join("<br>")}q(o,async a=>{a.day&&a.smena&&(y.value.forEach(t=>{t.loading=!0}),await _())},{deep:!0}),x(()=>$.value==="inputed"?allData.value.filter(a=>a.Value!==null):$.value==="not_inputed"?allData.value.filter(a=>a.Value===null):allData.value);const D=m(0),I=m(0);async function _(){const a=o.value.day,t=o.value.smena;if(!(!a||!t))if(D.value=0,I.value=0,V.value){const{data:r}=await h.get(`/getRowPageResult/${V.value}`,{params:{day:a,smena:t}}),e=r.reduce((s,n)=>(s.total+=n.multiplied_parameter_count,s.filled+=n.kiritilgan,s.formula+=n.multiplied_formula_count,s.manual+=n.multiplied_manual_count,s),{total:0,filled:0,formula:0,manual:0});D.value=e.formula,I.value=e.manual}else{const{data:r}=await h.get("/structure");for(const e of r){const s=await h.get(`/getRowPageResult/${e.id}`,{params:{day:a,smena:t}}),n=s.data.reduce((i,d)=>i+d.multiplied_parameter_count,0),c=s.data.reduce((i,d)=>i+d.kiritilgan,0),b=s.data.reduce((i,d)=>i+d.multiplied_formula_count,0),N=s.data.reduce((i,d)=>i+d.multiplied_manual_count,0),A=n-c;D.value+=b,I.value+=N;const u=y.value.find(i=>i.id===e.id);u&&(u.loading=!0,u.filled=c,u.notFilled=A,u.formula=b,u.manual=N,u.loading=!1)}}}let S=null;return E(async()=>{const a=localStorage.getItem("locale");a&&(k.value=a);const t=new Date,r=t.getHours(),e=t.toISOString().split("T")[0],s=r>=8&&r<20?1:2;(!o.value.day||!o.value.smena)&&(o.value={day:e,smena:s});try{const n=H.state.user.structure_id;if(Array.isArray(n)&&n.length===1){const c=n[0];v.push({name:"OperatorDetail",params:{id:c}})}else if(Array.isArray(n)&&n.length>1){const c=await h.get(`/structures/${n.join(",")}`);y.value=c.data.map(b=>({...b,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(n){console.error("Error fetching data:",n)}await _(),S=setInterval(()=>{_()},6e5)}),x(()=>k.value==="uz"?"Русский":"O‘zbek"),U(()=>{S&&clearInterval(S)}),(a,t)=>{const r=G("VaProgressCircle");return C(),w("div",ee,[l("div",te,[l("div",ae,[p(f(Z),{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),class:"w-full mr-2 shadow-sm"},{default:J(()=>[p(f(K),{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),l("div",le,[l("div",se,[(C(!0),w(Q,null,W(y.value,(e,s)=>(C(),w("div",{onClick:n=>O(e.id),key:s,class:X(["relative p-6 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(C(),w("div",oe,[p(r,{indeterminate:"",size:"medium"})])):Y("",!0),l("h5",re,[t[2]||(t[2]=l("span",{class:"material-symbols-outlined w-1"}," factory ",-1)),l("span",{class:"block flex-grow leading-none w-5/6",innerHTML:M(e)},null,8,ie)]),l("div",ue,[l("div",de,[l("div",ce,[l("div",null,[p(f(j),{onClick:n=>T(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),p(f(j),{onClick:n=>R(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),p(f(j),{onClick:n=>z(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])]),l("div",null,[l("div",me,[t[3]||(t[3]=l("span",{class:"text-green-600 material-symbols-outlined"},"edit",-1)),l("span",pe,g(e.filled),1),t[4]||(t[4]=l("span",{class:"material-symbols-outlined text-red-600"},"warning",-1)),l("span",fe,g(e.notFilled),1),t[5]||(t[5]=l("span",{class:"material-symbols-outlined text-blue-600"},"support_agent",-1)),l("span",ge,g(e.manual),1),t[6]||(t[6]=l("span",{class:"material-symbols-outlined text-teal-600"},"function",-1)),l("span",ve,g(e.formula),1),t[7]||(t[7]=l("span",{class:"material-symbols-outlined text-purple-600"},"%",-1)),l("span",ye,g(e.filled+e.notFilled>0?Math.round(e.filled/(e.filled+e.notFilled)*100):0),1)])])])])])],10,ne))),128))])])])])}}};export{ke as default};

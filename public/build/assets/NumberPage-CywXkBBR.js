import{u as useToast,c as useI18n,r as ref,E as inject,f as resolveComponent,g as createElementBlock,h as openBlock,j as createVNode,k as unref,z as VaButton,l as withCtx,i as createBaseVNode,t as toDisplayString,n as axios,d as reactive,K as watch,V as VaForm,m as VaInput,x as createTextVNode,F as createBlock,G as createCommentVNode,L as VaModal,_ as _export_sfc,s as computed,o as onMounted,I as Fragment,J as renderList,M as VaSelect,N as VaTextarea,O as nextTick,a as useStore,H as provide}from"./app-C6DkEnxQ.js";/* empty css                   */import{D as DxDataGrid,a as DxSelection,b as DxColumn}from"./data-grid-BSpa5dIU.js";import{a as anime}from"./anime.es-BNELU3II.js";const _hoisted_1$6={class:"h-full w-full text-center content-center"},_hoisted_2$6={class:"va-h3"},_sfc_main$6={__name:"DeleteBlog",props:["params"],setup(l){const{init:e}=useToast(),{t:o}=useI18n(),s=ref(!1),i=l,g=inject("ondeleted"),x=async()=>{try{const{data:k}=await axios.delete(`/pages/${i.params.data.id}`);k.status===200?(g(i.params.data),s.value=!1,e({message:o("login.successMessage"),color:"success"})):console.error("Error deleting data:",k.message)}catch(k){console.error("Error deleting data:",k)}};return(k,m)=>{const $=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$6,[createVNode(unref(VaButton),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:m[0]||(m[0]=v=>s.value=!0)}),createVNode($,{modelValue:s.value,"onUpdate:modelValue":m[1]||(m[1]=v=>s.value=v),"ok-text":unref(o)("modals.apply"),"cancel-text":unref(o)("modals.cancel"),onClose:m[2]||(m[2]=v=>s.value=!1),onOk:x,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$6,toDisplayString(unref(o)("modals.title")),1),createBaseVNode("p",null,toDisplayString(unref(o)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$5={class:"h-full w-full text-center content-center"},_hoisted_2$5={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},_sfc_main$5={__name:"EditBlog",props:["params"],setup(l){const{init:e}=useToast(),o=l,s=ref(!1),i=inject("onupdated"),g=ref([]),{t:x,locale:k}=useI18n(),m=reactive({StructureID:"",Name:"",NameRus:"",NumberPage:"",Comment:"",id:o.params.data.id}),$=async()=>{try{const w=await axios.get("/structure");g.value=w.data.map(D=>({value:D.id,text:k.value==="uz"?D.Name:D.NameRus}));const V=await axios.get(`pages/${o.params.data.id}`);m.StructureID=+V.data.StructureID,m.Name=V.data.Name,m.ShortName=V.data.ShortName,m.NumberPage=V.data.NumberPage,m.Comment=V.data.Comment}catch(w){console.error("Error fetching graphics data:",w)}},v=async()=>{try{const{data:w}=await axios.put("/pages",m);w.status===200?(i(o.params.node,w.unit),s.value=!1,e({message:x("login.successMessage"),color:"success"})):console.error("Error saving data:",w.message)}catch(w){console.error("Error saving data:",w)}};return watch(()=>m.StructureID,w=>{}),(w,V)=>{const D=resolveComponent("VaSelect"),C=resolveComponent("VaTextarea"),h=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$5,[createVNode(unref(VaButton),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:V[0]||(V[0]=c=>(s.value=!0,$))}),createVNode(h,{modelValue:s.value,"onUpdate:modelValue":V[6]||(V[6]=c=>s.value=c),"ok-text":unref(x)("modals.apply"),"cancel-text":unref(x)("modals.cancel"),onOk:v,onClose:V[7]||(V[7]=c=>s.value=!1),"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",{class:"va-h3",onVnodeMounted:$},toDisplayString(unref(x)("modals.editFactory")),513),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$5,[createVNode(D,{modelValue:m.StructureID,"onUpdate:modelValue":V[1]||(V[1]=c=>m.StructureID=c),"value-by":"value",class:"mb-1",label:unref(x)("form.structureName"),options:g.value,clearable:""},null,8,["modelValue","label","options"])]),createVNode(unref(VaInput),{class:"w-full",modelValue:m.NumberPage,"onUpdate:modelValue":V[2]||(V[2]=c=>m.NumberPage=c),type:"number",rules:[c=>c&&c.length>0||unref(x)("validation.requiredField")],label:unref(x)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:m.Name,"onUpdate:modelValue":V[3]||(V[3]=c=>m.Name=c),rules:[c=>c&&c.length>0||unref(x)("validation.requiredField")],label:unref(x)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:m.NameRus,"onUpdate:modelValue":V[4]||(V[4]=c=>m.NameRus=c),rules:[c=>c&&c.length>0||unref(x)("validation.requiredField")],label:unref(x)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode(C,{class:"w-full",modelValue:m.Comment,"onUpdate:modelValue":V[5]||(V[5]=c=>m.Comment=c),"max-length":"125",label:unref(x)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$4={class:"h-full w-full"},_hoisted_2$4={class:"va-h3 mb-4"},_sfc_main$4={__name:"AddForDocuments",props:["params"],setup(l){const{t:e}=useI18n(),{init:o}=useToast(),s=l,i=inject("onupdated"),g=ref(!1),x=ref([]),k=ref([]),m={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},$=async()=>{g.value=!0,k.value=[];try{const{data:C}=await axios.get(`/addfordoc/${s.params.data.NumberPage}`);x.value=w(C.tree),k.value=v(C.selected??[])}catch(C){console.error(C),o({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function v(C){return C.flat(3)}function w(C){const h=[];return C.forEach(c=>{var p;const P=c.key,E=c.title,B=parseInt(P.split("-")[1]);(p=c.children)==null||p.forEach(N=>{var f;const r=N.title,a=N.key,n=parseInt(a.split("-")[2]);(f=N.children)==null||f.forEach(y=>{var S;const d=y.title,u=y.key,I=parseInt(u.split("-")[3]);(S=y.children)!=null&&S.length&&y.children.forEach(_=>{h.push({rowId:_.ParameterID??`param-${_.key}`,sexName:E,sexId:B,pageName:r,pageId:n,groupName:d,groupId:I,paramName:_.title,ParameterID:_.ParameterID})})})})}),h}const V=({selectedRowKeys:C})=>{k.value=C},D=async()=>{const C=x.value.filter(B=>k.value.includes(B.rowId)),h=[...new Set(C.map(B=>B.sexId))],c=h.map(B=>{const p=C.filter(N=>N.sexId===B).map(N=>N.pageId);return[...new Set(p)]}),P=h.map(B=>{const p=C.filter(r=>r.sexId===B);return[...new Set(p.map(r=>r.pageId))].map(r=>{const a=p.filter(n=>n.pageId===r).map(n=>n.groupId);return[...new Set(a)]})}),E=h.map(B=>{const p=C.filter(r=>r.sexId===B);return[...new Set(p.map(r=>r.pageId))].map(r=>{const a=p.filter(f=>f.pageId===r);return[...new Set(a.map(f=>f.groupId))].map(f=>a.filter(d=>d.groupId===f).map(d=>d.ParameterID).filter(d=>d))})});try{const{data:B}=await axios.post("/addfordoc",{doc_id:s.params.data.NumberPage,FactoryStructureID:h,NumberPageBlogs:c,GroupBlogs:P,ParameterBlogs:E});if(console.log(B),B.status===200)i==null||i(),g.value=!1,o({message:e("login.successMessage"),color:"success"});else throw new Error(B.message||"Unknown error")}catch(B){console.error(B),o({message:e("errors.saveFailed"),color:"danger"})}};return(C,h)=>(openBlock(),createElementBlock("main",_hoisted_1$4,[createVNode(unref(VaButton),{icon:"design_services",round:"",preset:"primary",onClick:$}),createVNode(unref(VaModal),{modelValue:g.value,"onUpdate:modelValue":h[0]||(h[0]=c=>g.value=c),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:D,onClose:h[1]||(h[1]=c=>g.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$4,toDisplayString(unref(e)("modals.editFactory")),1),createTextVNode(toDisplayString(s.params.data.NumberPage)+" ",1),x.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":x.value,"key-expr":"rowId","selected-row-keys":k.value,onSelectionChanged:V,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:m},{default:withCtx(()=>[createVNode(unref(DxSelection),{mode:"multiple","show-check-boxes-mode":"always"}),createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name")},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"])]))}},_hoisted_1$3={class:"flex gap-4"},_hoisted_2$3={class:"calculator"},_hoisted_3$3={class:"answer"},_hoisted_4$3={class:"display"},_hoisted_5$1={class:"flex-1 min-w-[420px]"},_hoisted_6$1={class:"rounded border p-2 mb-3"},_hoisted_7={class:"flex flex-wrap items-center gap-2 mb-2"},_hoisted_8={class:"flex items-center gap-2"},_hoisted_9={class:"text-xs text-gray-500 ml-2"},_hoisted_10={class:"mb-3 flex flex-wrap gap-2"},_hoisted_11={key:0,class:"mb-3 flex flex-wrap gap-2"},_hoisted_12={key:1,class:"mb-3 flex flex-wrap gap-2"},_hoisted_13={class:"border rounded p-2 min-h-[160px]"},_hoisted_14={key:0,class:"flex flex-wrap gap-2"},_hoisted_15={key:1,class:"text-gray-500 text-sm"},_sfc_main$3={__name:"FormulaModal",props:{parameter:{type:[Number,String],required:!0},modelValue:{type:Boolean,default:!1},docId:{type:[Number],required:!0}},emits:["update:modelValue","save"],setup(__props,{emit:__emit}){const{locale,t}=useI18n(),props=__props,emit=__emit,openLocal=computed({get:()=>props.modelValue,set:l=>emit("update:modelValue",l)}),{init}=useToast(),items=ref([]),aggOptions=[{value:"RAW",label:"Asosiy"},{value:"HOUR",label:"Soatlik"},{value:"SHIFT",label:"Smenalik"},{value:"DAY",label:"Kunlik"},{value:"WEEK",label:"Haftalik"},{value:"MONTH",label:"Oylik"},{value:"YEAR",label:"Yillik"}],funcOptions=[{text:"Qiymat (joriy)",value:"VALUE"},{text:"O‘rtacha",value:"AVG"},{text:"Yig‘indi",value:"SUM"},{text:"Min",value:"MIN"},{text:"Max",value:"MAX"}],scopeOptions=[{text:"Joriy davr",value:"CURRENT"},{text:"Oldingi davr(lar)",value:"PREV"},{text:"Sirpanma oynaviy",value:"ROLLING"}],applyMode=ref("global"),agg=reactive({agg:"DAY",func:"VALUE",scope:"CURRENT",n:1}),aggSummary=computed(()=>{var o,s;const l=((o=aggOptions.find(i=>i.value===agg.agg))==null?void 0:o.label)??agg.agg,e=((s=funcOptions.find(i=>i.value===agg.func))==null?void 0:s.text)??agg.func;return agg.scope==="CURRENT"?`${l}, ${e}, joriy davr`:agg.scope==="PREV"?`${l}, ${e}, oldingi ${agg.n} davr`:`${l}, ${e}, oxirgi ${agg.n} davr (rolling)`});function appendParam(l){var m,$;const e=typeof agg.func=="object"?agg.func.value:agg.func,o=typeof agg.scope=="object"?agg.scope.value:agg.scope,s=[`Pid=${l.id}`,`agg=${agg.agg}`,`func=${e}`,`scope=${o}`];agg.scope!=="CURRENT"&&s.push(`n=${Number(agg.n)||1}`);const i=s.join("|");result.Calculate.push(i);const g=((m=aggOptions.find(v=>v.value===agg.agg))==null?void 0:m.label)||agg.agg,x=(($=funcOptions.find(v=>v.value===e))==null?void 0:$.text)||e;let k="joriy";o==="PREV"&&(k=`oldingi ${agg.n}`),o==="ROLLING"&&(k=`oxirgi ${agg.n}`),current.value+=`[${l.name||l.id}] ⟨${g} • ${x} • ${k}⟩`}const sel=reactive({sex:0,page:0,group:0}),pages=computed(()=>{var l,e;return((e=(l=items.value)==null?void 0:l[sel.sex])==null?void 0:e.pages)??[]}),groups=computed(()=>{var l,e;return((e=(l=pages.value)==null?void 0:l[sel.page])==null?void 0:e.groups)??[]}),parameters=computed(()=>{var l,e;return((e=(l=groups.value)==null?void 0:l[sel.group])==null?void 0:e.parameters)??[]}),logList=ref(""),current=ref(""),answer=ref(""),operatorClicked=ref(!0),result=reactive({Calculate:[],Comment:""});function anim(l){anime.timeline({targets:`#${l}`,duration:220,easing:"easeInOutCubic"}).add({backgroundColor:"#c1e3ff"}).add({backgroundColor:"#f4faff"})}function append(l){operatorClicked.value&&(current.value="",operatorClicked.value=!1),anim(typeof l=="string"?`n${l}`:"nX"),result.Calculate.push(String(l)),current.value+=String(l)}function addOp(l,e){anim(e),operatorClicked.value||(logList.value+=`${current.value} ${l} `,current.value="",operatorClicked.value=!0,result.Calculate.push(l))}const clear=()=>{addOp("","clear"),logList.value="",current.value="",answer.value="",result.Calculate=[],operatorClicked.value=!1},sign=()=>addOp("±","sign"),percent=()=>addOp("%","percent"),dot=()=>{current.value.includes(".")||append(".")},plus=()=>addOp("+","plus"),minus=()=>addOp("-","minus"),times=()=>addOp("*","times"),divide=()=>addOp("/","divide"),equal=()=>{addOp("=","equal");const expr=result.Calculate.map(l=>l.startsWith("Pid=")||l.startsWith("Static=")?"1":l).join("");try{answer.value=eval(expr)}catch{answer.value="Error"}};function selectSex(l){sel.sex=l,sel.page=0,sel.group=0}function selectPage(l){sel.page=l,sel.group=0}function selectGroup(l){sel.group=l}console.log(props);const loadedOnce=ref(!1),loading=ref(!1);async function loadTree(){var l;if(!loading.value){loading.value=!0;try{const e=((l=props.parameter)==null?void 0:l.id)??props.parameter,{data:o}=await axios.get(`/calculator-structure/${e}`);items.value=Array.isArray(o.items)?o.items:[],loadedOnce.value=!0}catch(e){console.error(e),init({message:"Strukturani yuklashda xatolik",color:"danger"})}finally{loading.value=!1}}}async function emitSave(){var e,o,s,i;const l={page_id_blog:props.parameter.id,doc_id:props.docId,param_id:(e=props.parameter)==null?void 0:e.ParameterID,sex_id:(o=props.parameter)==null?void 0:o.sexId,page_id:(s=props.parameter)==null?void 0:s.pageId,group_id:(i=props.parameter)==null?void 0:i.groupId,tokens:[...result.Calculate],comment:result.Comment||null};try{const{data:g}=await axios.post("/svodkaFormula",l);g.status===200?(loadTree(),init({message:t("login.successMessage"),color:"success"})):console.error("Error saving data:",g.message)}catch(g){console.error("Error saving data:",g)}try{const{data:g}=await axios.get(`/calculator-structure/${props.parameter.id}`);items.value=Array.isArray(g.items)?g.items:[]}catch(g){console.error(g),init({message:"Strukturani yuklashda xatolik",color:"danger"})}emit("save",l),openLocal.value=!1}return onMounted(loadTree),watch(openLocal,async l=>{l&&!loadedOnce.value&&await loadTree()}),watch(()=>{var l;return[props.docId,((l=props.parameter)==null?void 0:l.id)??props.parameter]},()=>{loadedOnce.value=!1}),(l,e)=>(openBlock(),createBlock(unref(VaModal),{modelValue:openLocal.value,"onUpdate:modelValue":e[18]||(e[18]=o=>openLocal.value=o),fullscreen:"",title:"Yangi formula yaratish","ok-text":"Tasdiqlash","cancel-text":"Bekor qilish",onOk:emitSave,"close-button":""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,toDisplayString(answer.value),1),createBaseVNode("div",_hoisted_4$3,toDisplayString(logList.value+current.value),1),createBaseVNode("div",{onClick:clear,id:"clear",class:"btn operator"},"C"),createBaseVNode("div",{onClick:sign,id:"sign",class:"btn operator"},"+/-"),createBaseVNode("div",{onClick:percent,id:"percent",class:"btn operator"},"%"),createBaseVNode("div",{onClick:divide,id:"divide",class:"btn operator"},"/"),createBaseVNode("div",{onClick:e[0]||(e[0]=o=>append("7")),id:"n7",class:"btn"},"7"),createBaseVNode("div",{onClick:e[1]||(e[1]=o=>append("8")),id:"n8",class:"btn"},"8"),createBaseVNode("div",{onClick:e[2]||(e[2]=o=>append("9")),id:"n9",class:"btn"},"9"),createBaseVNode("div",{onClick:times,id:"times",class:"btn operator"},"*"),createBaseVNode("div",{onClick:e[3]||(e[3]=o=>append("4")),id:"n4",class:"btn"},"4"),createBaseVNode("div",{onClick:e[4]||(e[4]=o=>append("5")),id:"n5",class:"btn"},"5"),createBaseVNode("div",{onClick:e[5]||(e[5]=o=>append("6")),id:"n6",class:"btn"},"6"),createBaseVNode("div",{onClick:minus,id:"minus",class:"btn operator"},"-"),createBaseVNode("div",{onClick:e[6]||(e[6]=o=>append("1")),id:"n1",class:"btn"},"1"),createBaseVNode("div",{onClick:e[7]||(e[7]=o=>append("2")),id:"n2",class:"btn"},"2"),createBaseVNode("div",{onClick:e[8]||(e[8]=o=>append("3")),id:"n3",class:"btn"},"3"),createBaseVNode("div",{onClick:plus,id:"plus",class:"btn operator"},"+"),createBaseVNode("div",{onClick:e[9]||(e[9]=o=>append("0")),id:"n0",class:"zero"},"0"),createBaseVNode("div",{onClick:dot,id:"dot",class:"btn"},"."),createBaseVNode("div",{onClick:equal,id:"equal",class:"btn operator"},"="),createBaseVNode("div",{onClick:e[10]||(e[10]=o=>append("(")),id:"lb",class:"btn p-4"},"("),createBaseVNode("div",{onClick:e[11]||(e[11]=o=>append(")")),id:"rb",class:"btn p-4"},")")]),createBaseVNode("div",_hoisted_5$1,[e[26]||(e[26]=createBaseVNode("div",{class:"mb-2 text-xs text-gray-500"},"Sex → Sahifa → Guruh",-1)),createBaseVNode("div",_hoisted_6$1,[e[25]||(e[25]=createBaseVNode("div",{class:"mb-2 text-xs text-gray-500"},"Agregatsiya va oynaviy qoida",-1)),createBaseVNode("div",_hoisted_7,[e[19]||(e[19]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Davr:",-1)),(openBlock(),createElementBlock(Fragment,null,renderList(aggOptions,o=>createVNode(unref(VaButton),{key:o.value,size:"small",color:o.value===agg.agg?"primary":"secondary",onClick:s=>agg.agg=o.value},{default:withCtx(()=>[createTextVNode(toDisplayString(o.label),1)]),_:2},1032,["color","onClick"])),64)),e[20]||(e[20]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Funktsiya:",-1)),createVNode(unref(VaSelect),{modelValue:agg.func,"onUpdate:modelValue":e[12]||(e[12]=o=>agg.func=o),options:funcOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),e[21]||(e[21]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Qamrov:",-1)),createVNode(unref(VaSelect),{modelValue:agg.scope,"onUpdate:modelValue":e[13]||(e[13]=o=>agg.scope=o),options:scopeOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),agg.scope!=="CURRENT"?(openBlock(),createBlock(unref(VaInput),{key:0,modelValue:agg.n,"onUpdate:modelValue":e[14]||(e[14]=o=>agg.n=o),modelModifiers:{number:!0},type:"number",min:"1",class:"w-20",label:agg.scope==="PREV"?"nechta orqaga":"oyna hajmi"},null,8,["modelValue","label"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_8,[e[24]||(e[24]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Qo'llash:",-1)),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="global"?"primary":"secondary",onClick:e[15]||(e[15]=o=>applyMode.value="global")},{default:withCtx(()=>e[22]||(e[22]=[createTextVNode("Global",-1)])),_:1,__:[22]},8,["color"]),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="next"?"primary":"secondary",onClick:e[16]||(e[16]=o=>applyMode.value="next")},{default:withCtx(()=>e[23]||(e[23]=[createTextVNode(" Keyingi parametr",-1)])),_:1,__:[23]},8,["color"]),createBaseVNode("span",_hoisted_9,toDisplayString(aggSummary.value),1)])]),createBaseVNode("div",_hoisted_10,[(openBlock(!0),createElementBlock(Fragment,null,renderList(items.value,(o,s)=>(openBlock(),createBlock(unref(VaButton),{key:`sex-${o.sexId}`,size:"small",color:s===sel.sex?"primary":"secondary",onClick:i=>selectSex(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(o.sexName||`Sex #${o.sexId}`),1)]),_:2},1032,["color","onClick"]))),128))]),pages.value.length?(openBlock(),createElementBlock("div",_hoisted_11,[(openBlock(!0),createElementBlock(Fragment,null,renderList(pages.value,(o,s)=>(openBlock(),createBlock(unref(VaButton),{key:`page-${o.pageId}`,size:"small",color:s===sel.page?"primary":"secondary",onClick:i=>selectPage(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(o.pageName||`Sahifa ${o.pageId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),groups.value.length?(openBlock(),createElementBlock("div",_hoisted_12,[(openBlock(!0),createElementBlock(Fragment,null,renderList(groups.value,(o,s)=>(openBlock(),createBlock(unref(VaButton),{key:`grp-${o.groupId}`,size:"small",color:s===sel.group?"primary":"secondary",onClick:i=>selectGroup(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(o.groupName||`Guruh #${o.groupId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_13,[parameters.value.length?(openBlock(),createElementBlock("div",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment,null,renderList(parameters.value,o=>(openBlock(),createBlock(unref(VaButton),{key:`param-${o.id}`,color:"warning","text-color":"black",style:{borderRadius:"0"},onClick:s=>appendParam(o)},{default:withCtx(()=>[createTextVNode(toDisplayString(o.name||o.id),1)]),_:2},1032,["onClick"]))),128))])):(openBlock(),createElementBlock("div",_hoisted_15,"Parametrlar topilmadi"))])])]),createVNode(unref(VaTextarea),{class:"w-full mt-3",modelValue:result.Comment,"onUpdate:modelValue":e[17]||(e[17]=o=>result.Comment=o),"max-length":125,label:"Izoh"},null,8,["modelValue"])]),_:1},8,["modelValue"]))}},FormulaModal=_export_sfc(_sfc_main$3,[["__scopeId","data-v-a5ab19d0"]]),_hoisted_1$2={class:"flex gap-4"},_hoisted_2$2={class:"calculator"},_hoisted_3$2={class:"answer"},_hoisted_4$2={class:"display"},_sfc_main$2={__name:"FormulaModalEdit",props:{parameter:{type:[Object,Number,String],required:!0},modelValue:{type:Boolean,default:!1},docId:{type:[Number,String],required:!0}},emits:["update:modelValue","save"],setup(l,{emit:e}){const{t:o}=useI18n(),s=l,i=e,g=computed({get:()=>s.modelValue,set:r=>i("update:modelValue",r)}),{init:x}=useToast(),k=ref([]),m=ref(!1),$=ref(!1),v=ref(!1),w=ref(null),V=ref(""),D=ref(""),C=ref(""),h=ref(!0),c=reactive({Calculate:[],Comment:""});async function P(){if(!$.value){$.value=!0;try{const r=typeof s.parameter=="object"?s.parameter.id??s.parameter.page_id_blog:s.parameter,{data:a}=await axios.get(`/calculator-structure/${r}`);k.value=Array.isArray(a.items)?a.items:[],m.value=!0}catch(r){console.error(r),x({message:"Strukturani yuklashda xatolik",color:"danger"})}finally{$.value=!1}}}function E(r){for(const a of k.value||[])for(const n of a.pages||[])for(const f of n.groups||[])for(const y of f.parameters||[])if(String(y.id)===String(r))return y.name||r;return r}function B(r=[]){var n,f,y,d,u;const a=[];for(const I of r)if(typeof I=="string"&&I.startsWith("Pid=")){const S=I.split("|"),_=(n=S.find(T=>T.startsWith("Pid=")))==null?void 0:n.split("=")[1],b=(f=S.find(T=>T.startsWith("agg=")))==null?void 0:f.split("=")[1],R=(y=S.find(T=>T.startsWith("func=")))==null?void 0:y.split("=")[1],F=(d=S.find(T=>T.startsWith("scope=")))==null?void 0:d.split("=")[1],M=(u=S.find(T=>T.startsWith("n=")))==null?void 0:u.split("=")[1],O=E(_),q=F==="PREV"?`oldingi ${M}`:F==="ROLLING"?`oxirgi ${M}`:"joriy";a.push(`[${O}] ⟨${b??""} • ${R??""} • ${q}⟩`)}else a.push(String(I));return a.join(" ")}async function p(){if(!v.value){v.value=!0;try{const r=typeof s.parameter=="object"?s.parameter.ParameterID:null;if(!r){v.value=!1;return}const{data:a}=await axios.get("/svodkaFormula/by-param",{params:{doc_id:s.docId,param_id:r}});a&&(w.value=a.id??null,c.Calculate=Array.isArray(a.tokens)?[...a.tokens]:[],c.Comment=a.comment??"",D.value="",V.value=B(c.Calculate),h.value=!0)}catch(r){console.warn("Formula topilmadi yoki yuklab bo‘lmadi",r)}finally{v.value=!1}}}async function N(){var a,n,f,y;const r={page_id_blog:typeof s.parameter=="object"?s.parameter.id:s.parameter,doc_id:s.docId,param_id:typeof s.parameter=="object"?(a=s.parameter)==null?void 0:a.ParameterID:null,sex_id:(n=s.parameter)==null?void 0:n.sexId,page_id:(f=s.parameter)==null?void 0:f.pageId,group_id:(y=s.parameter)==null?void 0:y.groupId,tokens:[...c.Calculate],comment:c.Comment||null};try{const{data:d}=await axios.post("/svodkaFormula",r);(d==null?void 0:d.status)===200?(x({message:o("login.successMessage"),color:"success"}),i("save",r),g.value=!1):(console.error("Save error:",d),x({message:o("errors.saveFailed"),color:"danger"}))}catch(d){console.error(d),x({message:o("errors.saveFailed"),color:"danger"})}}return watch(()=>s.modelValue,async r=>{r&&(await nextTick(),m.value||await P(),await p())}),watch(()=>{var r;return[((r=s.parameter)==null?void 0:r.id)??s.parameter,s.docId]},()=>{m.value=!1}),onMounted(async()=>{s.modelValue&&(await nextTick(),m.value||await P(),await p())}),(r,a)=>(openBlock(),createBlock(unref(VaModal),{modelValue:g.value,"onUpdate:modelValue":a[22]||(a[22]=n=>g.value=n),fullscreen:"",title:"Formulani tahrirlash","ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:N,"close-button":""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,toDisplayString(C.value),1),createBaseVNode("div",_hoisted_4$2,toDisplayString(V.value+D.value),1),createBaseVNode("div",{onClick:a[0]||(a[0]=(...n)=>r.clear&&r.clear(...n)),id:"clear",class:"btn operator"},"C"),createBaseVNode("div",{onClick:a[1]||(a[1]=(...n)=>r.sign&&r.sign(...n)),id:"sign",class:"btn operator"},"+/-"),createBaseVNode("div",{onClick:a[2]||(a[2]=(...n)=>r.percent&&r.percent(...n)),id:"percent",class:"btn operator"},"%"),createBaseVNode("div",{onClick:a[3]||(a[3]=(...n)=>r.divide&&r.divide(...n)),id:"divide",class:"btn operator"},"/"),createBaseVNode("div",{onClick:a[4]||(a[4]=n=>r.append("7")),id:"n7",class:"btn"},"7"),createBaseVNode("div",{onClick:a[5]||(a[5]=n=>r.append("8")),id:"n8",class:"btn"},"8"),createBaseVNode("div",{onClick:a[6]||(a[6]=n=>r.append("9")),id:"n9",class:"btn"},"9"),createBaseVNode("div",{onClick:a[7]||(a[7]=(...n)=>r.times&&r.times(...n)),id:"times",class:"btn operator"},"*"),createBaseVNode("div",{onClick:a[8]||(a[8]=n=>r.append("4")),id:"n4",class:"btn"},"4"),createBaseVNode("div",{onClick:a[9]||(a[9]=n=>r.append("5")),id:"n5",class:"btn"},"5"),createBaseVNode("div",{onClick:a[10]||(a[10]=n=>r.append("6")),id:"n6",class:"btn"},"6"),createBaseVNode("div",{onClick:a[11]||(a[11]=(...n)=>r.minus&&r.minus(...n)),id:"minus",class:"btn operator"},"-"),createBaseVNode("div",{onClick:a[12]||(a[12]=n=>r.append("1")),id:"n1",class:"btn"},"1"),createBaseVNode("div",{onClick:a[13]||(a[13]=n=>r.append("2")),id:"n2",class:"btn"},"2"),createBaseVNode("div",{onClick:a[14]||(a[14]=n=>r.append("3")),id:"n3",class:"btn"},"3"),createBaseVNode("div",{onClick:a[15]||(a[15]=(...n)=>r.plus&&r.plus(...n)),id:"plus",class:"btn operator"},"+"),createBaseVNode("div",{onClick:a[16]||(a[16]=n=>r.append("0")),id:"n0",class:"zero"},"0"),createBaseVNode("div",{onClick:a[17]||(a[17]=(...n)=>r.dot&&r.dot(...n)),id:"dot",class:"btn"},"."),createBaseVNode("div",{onClick:a[18]||(a[18]=(...n)=>r.equal&&r.equal(...n)),id:"equal",class:"btn operator"},"="),createBaseVNode("div",{onClick:a[19]||(a[19]=n=>r.append("(")),id:"lb",class:"btn p-4"},"("),createBaseVNode("div",{onClick:a[20]||(a[20]=n=>r.append(")")),id:"rb",class:"btn p-4"},")")]),a[23]||(a[23]=createBaseVNode("div",{class:"flex-1 min-w-[420px]"},null,-1))]),createVNode(unref(VaTextarea),{class:"w-full mt-3",modelValue:c.Comment,"onUpdate:modelValue":a[21]||(a[21]=n=>c.Comment=n),"max-length":125,label:"Izoh"},null,8,["modelValue"])]),_:1},8,["modelValue"]))}},FormulaModalEdit=_export_sfc(_sfc_main$2,[["__scopeId","data-v-a1bc748d"]]),_hoisted_1$1={class:"h-full w-full"},_hoisted_2$1={class:"va-h3 mb-4"},_hoisted_3$1={class:"flex items-center justify-between w-full"},_hoisted_4$1={class:"flex items-center w-5/6"},_hoisted_5={key:0,class:"text-green-600"},_hoisted_6={class:"flex justify-between items-center w-1/6"},_sfc_main$1={__name:"ParamsControl",props:["params"],setup(l){const{t:e}=useI18n(),{init:o}=useToast(),s=l,i=inject("onupdated"),g=ref(!1),x=ref([]),k=ref([]),m={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},$=ref(!1),v=ref(!1),w=ref(null),V=ref("");function D(p,N){w.value={...p,id:N},V.value="",$.value=!0}async function C(p,N){w.value={...p,id:N},v.value=!0}const h=async()=>{g.value=!0,k.value=[];try{const{data:p}=await axios.get(`/addfordocSelect/${s.params.data.NumberPage}`);x.value=P(p.tree),k.value=c(p.selected)}catch(p){console.error(p),o({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function c(p){return Array.isArray(p)?p.flat(5).filter(Boolean):[]}function P(p){const N=[];return Array.isArray(p)&&p.forEach(r=>{var f;const a=parseInt(String(r.key).split("-")[1]),n=r.title;(f=r.children)==null||f.forEach(y=>{var I;const d=parseInt(String(y.key).split("-")[2]),u=y.title;(I=y.children)==null||I.forEach(S=>{var R;const _=parseInt(String(S.key).split("-")[3]),b=S.title;(R=S.children)==null||R.forEach(F=>{N.push({rowId:F.ParameterID??`param-${F.key}`,sexName:n,sexId:a,pageName:u,pageId:d,groupName:b,groupId:_,paramName:F.title,ParameterID:F.ParameterID})})})})}),N}const E=({selectedRowKeys:p})=>{k.value=p},B=async()=>{const p=x.value.filter(f=>k.value.includes(f.rowId)),N=[...new Set(p.map(f=>f.sexId))],r=N.map(f=>{const y=p.filter(d=>d.sexId===f).map(d=>d.pageId);return[...new Set(y)]}),a=N.map(f=>{const y=p.filter(u=>u.sexId===f);return[...new Set(y.map(u=>u.pageId))].map(u=>{const I=y.filter(S=>S.pageId===u).map(S=>S.groupId);return[...new Set(I)]})}),n=N.map(f=>{const y=p.filter(u=>u.sexId===f);return[...new Set(y.map(u=>u.pageId))].map(u=>{const I=y.filter(_=>_.pageId===u);return[...new Set(I.map(_=>_.groupId))].map(_=>I.filter(R=>R.groupId===_).map(R=>R.ParameterID).filter(Boolean))})});try{const{data:f}=await axios.post("/addfordoc",{doc_id:s.params.data.id,FactoryStructureID:N,NumberPageBlogs:r,GroupBlogs:a,ParameterBlogs:n});if(f.status===200)i==null||i(),g.value=!1,o({message:e("login.successMessage"),color:"success"});else throw new Error(f.message||"Unknown error")}catch(f){console.error(f),o({message:e("errors.saveFailed"),color:"danger"})}};return(p,N)=>{const r=resolveComponent("VaIcon");return openBlock(),createElementBlock("main",_hoisted_1$1,[createVNode(unref(VaButton),{icon:"star",round:"",preset:"primary",onClick:h}),createVNode(unref(VaModal),{modelValue:g.value,"onUpdate:modelValue":N[0]||(N[0]=a=>g.value=a),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:B,onClose:N[1]||(N[1]=a=>g.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$1,toDisplayString(unref(e)("modals.editFactory")),1),createTextVNode(toDisplayString(s.params.data)+" ",1),x.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":x.value,"key-expr":"rowId","selected-row-keys":k.value,onSelectionChanged:E,"repaint-changes-only":!0,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:m},{paramCell:withCtx(({data:a})=>[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[k.value.includes(a.data.rowId)?(openBlock(),createElementBlock("span",_hoisted_5,"✅")):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(a.data.paramName),1)]),createBaseVNode("div",_hoisted_6,[createVNode(unref(VaButton),{round:"",color:"info",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:n=>D(a.data,s.params.data.NumberPage)},{default:withCtx(()=>[createVNode(r,{name:"calculate",size:"16px"})]),_:2},1032,["onClick"]),createVNode(unref(VaButton),{round:"",color:"primary",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:n=>C(a.data,s.params.data.NumberPage)},{default:withCtx(()=>[createVNode(r,{name:"edit",size:"16px"})]),_:2},1032,["onClick"]),createVNode(unref(VaButton),{round:"",color:"danger",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:n=>p.deleteFormula(a.data)},{default:withCtx(()=>[createVNode(r,{name:"delete",size:"16px"})]),_:2},1032,["onClick"])])])]),default:withCtx(()=>[createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name"),"cell-template":"paramCell","min-width":320,"allow-sorting":!1},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"]),v.value?(openBlock(),createBlock(FormulaModalEdit,{key:0,modelValue:v.value,"onUpdate:modelValue":N[2]||(N[2]=a=>v.value=a),parameter:w.value,formula:V.value,onSave:p.handleFormulaSave,onClose:p.handleFormulaClose},null,8,["modelValue","parameter","formula","onSave","onClose"])):createCommentVNode("",!0),$.value?(openBlock(),createBlock(FormulaModal,{key:1,modelValue:$.value,"onUpdate:modelValue":N[3]||(N[3]=a=>$.value=a),parameter:w.value,formula:V.value,onSave:p.handleFormulaSave,onClose:p.handleFormulaClose},null,8,["modelValue","parameter","formula","onSave","onClose"])):createCommentVNode("",!0)])}}},ParamsControl=_export_sfc(_sfc_main$1,[["__scopeId","data-v-da77e45e"]]),_hoisted_1={class:"grid grid-rows-[55px,1fr]"},_hoisted_2={class:"flex justify-between"},_hoisted_3={class:"va-h3"},_hoisted_4={class:"flex-grow"},_sfc_main={__name:"NumberPage",props:{id:Number},setup(l){const{init:e}=useToast(),o=useStore(),{locale:s,t:i}=useI18n(),g=l,x=ref([]),k=ref(null),m=ref(!1),$=ref([]),v=reactive({StructureID:g.id,Name:"",NameRus:"",NumberPage:"",Comment:""}),w=computed(()=>o.state.user.roles[17]),V=d=>{var u,I;return((I=(u=w.value)==null?void 0:u.pivot)==null?void 0:I[d])==="1"},D=d=>g.id===22,C=computed(()=>V("create")),h=computed(()=>V("update")),c=computed(()=>V("delete"));computed(()=>D);function P(d){k.value.applyTransaction({remove:[d]})}function E(d,u){d.setData(u)}provide("ondeleted",P),provide("onupdated",E);const B=computed(()=>{const d=[{headerName:i("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:i("table.structure"),field:a(),flex:1},{headerName:i("table.name"),field:N(),flex:1},{headerName:i("table.numberpage"),field:"NumberPage"},{headerName:i("table.comment"),field:r()}];return g.id==22&&d.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ParamsControl}),g.id==22&&d.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$4}),h.value&&d.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$5}),c.value&&d.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$6}),d}),p={sortable:!0,filter:!0},N=()=>s.value==="uz"?"Name":"NameRus",r=()=>s.value==="uz"?"ShortName":"ShortNameRus",a=()=>s.value==="uz"?"SName":"NameRus",n=async()=>{try{const d=await axios.get(`/getRowPage/${g.id}`);x.value=Array.isArray(d.data)?d.data:d.data.items}catch(d){console.error("Error fetching data:",d)}},f=async()=>{try{const d=await axios.get("/structure");$.value=d.data.map(u=>({value:u.id,text:s.value==="uz"?u.Name:u.NameRus}))}catch(d){console.error("Error fetching graphics data:",d)}},y=async()=>{try{const{data:d}=await axios.post("/pages",v);d.status===200?(m.value=!1,v.StructureID="",v.Name="",v.NameRus="",v.NumberPage="",v.Comment="",await n(),e({message:i("login.successMessage"),color:"success"})):console.error("Error saving data:",d.message)}catch(d){console.error("Error saving data:",d)}};return onMounted(()=>{const d=localStorage.getItem("locale");d&&(s.value=d),n(),f()}),computed(()=>s.value==="uz"?"Русский":"O‘zbek"),(d,u)=>{const I=resolveComponent("VaTextarea"),S=resolveComponent("VaModal"),_=resolveComponent("ag-grid-vue");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("main",null,[createBaseVNode("div",_hoisted_2,[u[7]||(u[7]=createBaseVNode("span",{class:"flex w-full"},null,-1)),C.value?(openBlock(),createBlock(unref(VaButton),{key:0,onClick:u[0]||(u[0]=b=>(m.value=!0,f)),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):createCommentVNode("",!0)]),createVNode(S,{modelValue:m.value,"onUpdate:modelValue":u[5]||(u[5]=b=>m.value=b),"ok-text":unref(i)("buttons.save"),"cancel-text":unref(i)("buttons.cancel"),onOk:y,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_3,toDisplayString(unref(i)("modals.addPageTitle")),1),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createVNode(unref(VaInput),{class:"w-full",modelValue:v.NumberPage,"onUpdate:modelValue":u[1]||(u[1]=b=>v.NumberPage=b),type:"number",rules:[b=>b&&b.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:v.Name,"onUpdate:modelValue":u[2]||(u[2]=b=>v.Name=b),rules:[b=>b&&b.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:v.NameRus,"onUpdate:modelValue":u[3]||(u[3]=b=>v.NameRus=b),rules:[b=>b&&b.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode(I,{class:"w-full",modelValue:v.Comment,"onUpdate:modelValue":u[4]||(u[4]=b=>v.Comment=b),"max-length":"125",label:unref(i)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),createBaseVNode("main",_hoisted_4,[createVNode(_,{rowData:x.value,columnDefs:B.value,defaultColDef:p,animateRows:"true",class:"ag-theme-material h-full",onGridReady:u[6]||(u[6]=b=>k.value=b.api)},null,8,["rowData","columnDefs"])])])}}};export{_sfc_main as default};

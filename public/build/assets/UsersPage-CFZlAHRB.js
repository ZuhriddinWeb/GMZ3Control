import{u as F,r as x,c as N,E as q,f as k,g as b,h as D,j as d,k as t,z as P,l as C,i as c,t as S,n as V,d as L,K as O,o as B,V as A,m as $,I as j,J as K,G as R,a4 as T,s as W,H as z}from"./app-DfyKVEEG.js";/* empty css                   */import{a as X,b as H,D as E}from"./data-grid-D-0iJc1t.js";const J={class:"h-full w-full text-center content-center"},Y={class:"va-h3"},Q={__name:"DeleteUserModal",props:["params"],setup(_){const{init:h}=F(),f=x(!1),n=_,{t:m}=N(),w=q("ondeleted"),i=async()=>{try{const{data:u}=await V.delete(`/users/${n.params.data.id}`);u.status===200?(w(n.params.data),f.value=!1,h({message:m("login.successMessage"),color:"success"})):console.error("Error deleting data:",u.message)}catch(u){console.error("Error deleting data:",u)}};return(u,l)=>{const g=k("VaModal");return D(),b("main",J,[d(t(P),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:l[0]||(l[0]=y=>f.value=!0)}),d(g,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=y=>f.value=y),"ok-text":t(m)("modals.apply"),"cancel-text":t(m)("modals.cancel"),onClose:l[2]||(l[2]=y=>f.value=!1),onOk:i,"close-button":""},{default:C(()=>[c("h3",Y,S(t(m)("modals.title")),1),c("p",null,S(t(m)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},Z={class:"h-full w-full text-center content-center"},ee={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},ae={__name:"EditUserModal",props:["params"],setup(_){const{init:h}=F(),f=_,{locale:n,t:m}=N(),w=x(!1),i=x([]),u=x(!1),l=L({Name:"",Phone:"",Login:"",Password:"",StructureID:[]}),g=async()=>{try{const v=await V.get("/structure");i.value=v.data.map(o=>({value:o.id,text:o.Name}))}catch(v){console.error("Strukturalarni olishda xatolik:",v)}},y=async()=>{try{const v=f.params.data.id,{data:o}=await V.get(`/users/${v}`);l.Name=o.name||"",l.Phone=o.phone||"",l.Login=o.login||"",l.Password="",l.StructureID=i.value.filter(e=>(o.structure_id||[]).includes(e.value))}catch(v){console.error("Foydalanuvchini olishda xatolik:",v)}},I=async()=>{try{const v={id:f.params.data.id,...l,StructureID:l.StructureID.map(e=>e.value)},o=await V.put("/users",v);o.data.status===200?(u.value=!1,l.Name="",l.Phone="",l.Login="",l.Password="",l.StructureID=[],h({message:m("login.successMessage"),color:"success"})):console.error("Saqlashda xatolik:",o.data.message)}catch(v){console.error("Saqlashda xatolik:",v)}};return O(u,async v=>{v&&(w.value||(await g(),w.value=!0),await y())}),B(()=>{const v=localStorage.getItem("locale");v&&(n.value=v)}),(v,o)=>{const e=k("VaSelect"),r=k("VaModal");return D(),b("main",Z,[d(t(P),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:o[0]||(o[0]=a=>u.value=!0)}),d(r,{modelValue:u.value,"onUpdate:modelValue":o[6]||(o[6]=a=>u.value=a),"ok-text":t(m)("modals.apply"),"cancel-text":t(m)("modals.cancel"),onOk:I,onClose:o[7]||(o[7]=a=>u.value=!1),"close-button":""},{default:C(()=>[c("h3",{class:"va-h3",onVnodeMounted:g},S(t(m)("menu.edit")),513),c("div",null,[d(t(A),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:C(()=>[c("div",ee,[d(e,{modelValue:l.StructureID,"onUpdate:modelValue":o[1]||(o[1]=a=>l.StructureID=a),label:t(m)("form.structureName"),options:i.value,multiple:"",trackBy:"value",textBy:"text"},null,8,["modelValue","label","options"])]),d(t($),{class:"w-full",modelValue:l.Name,"onUpdate:modelValue":o[2]||(o[2]=a=>l.Name=a),rules:[a=>a&&a.length>0||t(m)("form.requiredField")],label:t(m)("form.userName")},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Phone,"onUpdate:modelValue":o[3]||(o[3]=a=>l.Phone=a),rules:[a=>a&&a.length>0||t(m)("form.requiredField")],type:"tel",label:t(m)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Login,"onUpdate:modelValue":o[4]||(o[4]=a=>l.Login=a),rules:[a=>a&&a.length>0||t(m)("form.requiredField")],label:t(m)("form.login")},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Password,"onUpdate:modelValue":o[5]||(o[5]=a=>l.Password=a),rules:[a=>a&&a.length>0||t(m)("form.requiredField")],label:t(m)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},te={class:"h-full w-full text-center content-center"},le={class:"va-h3"},oe={class:"va-table-responsive"},se={class:"va-table va-table--clickable w-full"},re={key:0},ne={key:1},de={key:2},ue={__name:"RolesComponent",props:["params"],setup(_){const h=_,f=x(!1);q("onupdated");const n=x([]),{init:m}=F(),{locale:w,t:i}=N(),u=L({id:h.params.data.id,userName:h.params.data.name}),l=(o,e)=>{o[e]=!o[e],console.log(`${e} for ${o.name} changed to ${o[e]}`)},g=o=>o?"success":"danger";async function y(){V.get(`/user_role/${h.params.data.id}`).then(o=>{o.data.forEach(e=>{const r=n.value.find(a=>a.id==e.role_id);r!=null&&(r.view=e.view,r.create=e.create,r.update=e.update,r.delete=e.delete)})})}async function I(){try{const o=await V.get("/role");n.value=Array.isArray(o.data)?o.data:o.data.items,n.value.forEach(e=>{e.id=e.id,e.view=e.view||!1,e.create=e.create||!1,e.update=e.update||!1,e.delete=e.delete||!1})}catch(o){console.error("Error fetching data:",o)}}const v=async()=>{try{const o=n.value.map(r=>({id:r.id,name:r.name,view:r.view,create:r.create,edit:r.update,delete:r.delete})),{data:e}=await V.post("/user_role",{...u,roles:o});e.status===200?(f.value=!1,m({message:i("login.successMessage"),color:"success"})):console.error("Error saving data:",e.message)}catch(o){console.error("Error saving data:",o)}};return O(f,async o=>{o&&(await I(),y())}),(o,e)=>{const r=k("VaSwitch"),a=k("VaModal");return D(),b("main",te,[d(t(P),{round:"",icon:"settings",preset:"primary",class:"mt-1",onClick:e[0]||(e[0]=s=>f.value=!0)}),d(a,{"max-width":"45%",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),"ok-text":t(i)("modals.apply"),"cancel-text":t(i)("modals.cancel"),onOk:v,onClose:e[2]||(e[2]=s=>f.value=!1),"close-button":""},{default:C(()=>[c("h3",null,[c("span",le,S(t(i)("table.user"))+" : "+S(u.userName),1)]),c("div",null,[c("div",oe,[c("table",se,[e[3]||(e[3]=c("thead",null,[c("tr",null,[c("th",null,"Nomi"),c("th",null,"Ruxsat"),c("th",null,"Yaratish"),c("th",null,"O'zgartirish"),c("th",null,"O'chirish")])],-1)),c("tbody",null,[(D(!0),b(j,null,K(n.value,s=>(D(),b("tr",{key:s.id},[c("td",null,S(t(i)(`${s.name}`)),1),c("td",null,[d(r,{"model-value":s.view,onChange:()=>l(s,"view"),color:g(s.view)},null,8,["model-value","onChange","color"])]),s.view?(D(),b("td",re,[d(r,{"model-value":s.create,onChange:()=>l(s,"create"),color:g(s.create)},null,8,["model-value","onChange","color"])])):R("",!0),s.view?(D(),b("td",ne,[d(r,{"model-value":s.update,onChange:()=>l(s,"update"),color:g(s.update)},null,8,["model-value","onChange","color"])])):R("",!0),s.view?(D(),b("td",de,[d(r,{"model-value":s.delete,onChange:()=>l(s,"delete"),color:g(s.delete)},null,8,["model-value","onChange","color"])])):R("",!0)]))),128))])])])])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ce={class:"h-full w-full text-center content-center"},ie={class:"va-h3"},me={__name:"RestartPassword",props:["params"],setup(_){const h=_,{t:f}=N(),n=x(!1),m=q("onupdated"),w=async()=>{try{const{data:i}=await V.get(`/restart-password/${h.params.data.id}`);i.status===200?(m(h.params.node,i.unit),n.value=!1):console.error("Error deleting data:",i.message)}catch(i){console.error("Error deleting data:",i)}};return(i,u)=>{const l=k("VaButton"),g=k("VaModal");return D(),b("main",ce,[d(l,{round:"",icon:"restart_alt",preset:"primary",class:"mt-1",onClick:u[0]||(u[0]=y=>n.value=!0)}),d(g,{modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=y=>n.value=y),"ok-text":t(f)("modals.apply"),"cancel-text":t(f)("modals.cancel"),onClose:u[2]||(u[2]=y=>n.value=!1),onOk:w,"close-button":""},{default:C(()=>[c("h3",ie,S(t(f)("modals.restart")),1),c("p",null,S(t(f)("modals.messageRestart")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},pe={class:"h-full w-full text-center content-center"},fe={class:"flex-grow mt-8"},ve={__name:"CreateDocument",props:["params"],setup(_){const h=_,f=x(!1),{locale:n,t:m}=N(),w=x([]),i=x([]),u=x({id:[],parameters:[]}),l=async()=>{f.value=!0,await g()},g=async()=>{try{const r=(await V.get(`/getUserData/${h.params.data.id}`)).data[0];r&&(u.value.id=r.FactoryStructureID||[],u.value.parameters=r.ParametersID||[],i.value=[],u.value.id.forEach((a,s)=>{(u.value.parameters[s]||[]).forEach(U=>{const M=w.value.find(p=>p.FactoryStructureID===a&&p.ParametersID===U);M&&i.value.push(M.id)})}),console.log("Foydalanuvchi ma'lumotlariga ko'ra tanlangan row keys:",i.value))}catch(e){console.error("Foydalanuvchi ma’lumotlarini olishda xatolik:",e)}},y=async()=>{try{const e=await V.get("/paramsgraph");w.value=e.data}catch(e){console.error("Ma’lumotlarni olishda xatolik:",e)}},I=async()=>{try{const e={id:u.value.id,parameters:u.value.parameters,user_id:h.params.data.id},r=await V.post("/documents",e);r.status===200?(console.log("Ma'lumotlar muvaffaqiyatli saqlandi:",r.data),alert("Ma'lumotlar muvaffaqiyatli saqlandi!")):(console.error("Ma'lumotlarni saqlashda xatolik yuz berdi:",r),alert("Ma'lumotlarni saqlashda xatolik yuz berdi!"))}catch(e){console.error("Xatolik yuz berdi:",e),alert("Xatolik yuz berdi. Ma'lumotlarni saqlash amalga oshmadi.")}},v=({selectedRowKeys:e})=>{i.value=e,console.log("Tanlangan row keys:",i.value),o()},o=()=>{const e={};i.value.forEach(r=>{const a=w.value.find(s=>s.id===r);a&&(e[a.FactoryStructureID]||(e[a.FactoryStructureID]={id:a.FactoryStructureID,parameters:[]}),e[a.FactoryStructureID].parameters.push(a.ParametersID))}),u.value={id:Object.keys(e).map(Number),parameters:Object.values(e).map(r=>r.parameters)}};return B(()=>{const e=localStorage.getItem("locale");e&&(n.value=e)}),O(f,async e=>{e&&(await y(),await g())}),(e,r)=>(D(),b("div",pe,[d(t(P),{round:"",icon:"history_edu",preset:"primary",class:"mt-1",onClick:l}),d(t(T),{"max-width":"45%",modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=a=>f.value=a),"ok-text":t(m)("modals.apply"),"cancel-text":t(m)("modals.cancel"),onOk:I,onClose:r[1]||(r[1]=a=>f.value=!1),"close-button":""},{default:C(()=>[r[2]||(r[2]=c("h3",null,[c("span",{class:"va-h3"},"Ruxsatlar")],-1)),c("main",fe,[d(t(X),{"data-source":w.value,showBorders:"true",rowAlternationEnabled:"true",selectedRowKeys:i.value,onSelectionChanged:v,columnAutoWidth:"true",showColumnLines:"true",showRowLines:"true",wordWrapEnabled:"true",pager:{visible:!0,showPageSizeSelector:!0,allowedPageSizes:[5,10,20],showInfo:!0},keyExpr:"id"},{default:C(()=>[d(t(H),{mode:"multiple",showCheckBoxesMode:"always"}),d(t(E),{dataField:"FName",caption:"Sex nomi",groupIndex:"0"}),d(t(E),{dataField:"FactoryStructureID",caption:"",width:"50"}),d(t(E),{dataField:"ParametersID",caption:"Parameter Id si"}),d(t(E),{dataField:"PName",caption:"Parameter nomi"})]),_:1},8,["data-source","selectedRowKeys"])])]),_:1},8,["modelValue","ok-text","cancel-text"])]))}},ge={class:"grid grid-rows-[55px,1fr]"},he={class:"flex justify-between"},we={class:"va-h3"},ye={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},xe={class:"flex-grow"},_e={__name:"UsersPage",setup(_){const{init:h}=F(),{locale:f,t:n}=N(),m=x([]),w=x(null),i=x(!1),u=x([]),l=L({Name:"",Phone:"",Login:"",Password:"",StructureID:[]});function g(a){w.value.applyTransaction({remove:[a]})}function y(a,s){a.setData(s)}z("ondeleted",g),z("onupdated",y);const I=W(()=>[{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:n("table.userName"),field:"name",flex:1},{headerName:n("table.login"),field:"login",flex:1},{headerName:n("table.phone"),field:"phone"},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ve},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ae},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ue},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:me},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:Q}]),v={sortable:!0,filter:!0},o=async()=>{try{const a=await V.get("/users");m.value=Array.isArray(a.data)?a.data:a.data.items}catch(a){console.error("Error fetching data:",a)}},e=async()=>{try{const a=await V.get("/structure");u.value=a.data.map(s=>({value:s.id,text:s.Name}))}catch(a){console.error("Error fetching graphics data:",a)}},r=async()=>{try{const{data:a}=await V.post("/users",l);a.status===200?(i.value=!1,l.Name="",l.Phone="",l.Login="",l.Password="",l.StructureID=[],await o(),h({message:n("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}};return B(()=>{const a=localStorage.getItem("locale");a&&(f.value=a),o(),e()}),(a,s)=>{const G=k("VaSelect"),U=k("VaModal"),M=k("ag-grid-vue");return D(),b("div",ge,[c("main",null,[c("div",he,[s[8]||(s[8]=c("span",{class:"flex w-full"},null,-1)),d(t(P),{onClick:s[0]||(s[0]=p=>i.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})]),d(U,{modelValue:i.value,"onUpdate:modelValue":s[6]||(s[6]=p=>i.value=p),"ok-text":t(n)("buttons.save"),"cancel-text":t(n)("buttons.cancel"),onOk:r,"close-button":""},{default:C(()=>[c("h3",we,S(t(n)("modals.addUserTitle")),1),c("div",null,[d(t(A),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:C(()=>[c("div",ye,[d(G,{modelValue:l.StructureID,"onUpdate:modelValue":s[1]||(s[1]=p=>l.StructureID=p),label:t(n)("form.structureName"),options:u.value,multiple:""},null,8,["modelValue","label","options"])]),d(t($),{class:"w-full",modelValue:l.Name,"onUpdate:modelValue":s[2]||(s[2]=p=>l.Name=p),rules:[p=>p&&p.length>0||t(n)("form.requiredField")],label:t(n)("form.userName")},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Phone,"onUpdate:modelValue":s[3]||(s[3]=p=>l.Phone=p),rules:[p=>p&&p.length>0||t(n)("form.requiredField")],type:"tel",label:t(n)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Login,"onUpdate:modelValue":s[4]||(s[4]=p=>l.Login=p),rules:[p=>p&&p.length>0||t(n)("form.requiredField")],label:t(n)("form.login")},null,8,["modelValue","rules","label"]),d(t($),{class:"w-full",modelValue:l.Password,"onUpdate:modelValue":s[5]||(s[5]=p=>l.Password=p),rules:[p=>p&&p.length>0||t(n)("form.requiredField")],label:t(n)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),c("main",xe,[d(M,{rowData:m.value,columnDefs:I.value,defaultColDef:v,animateRows:"true",class:"ag-theme-material h-full",onGridReady:s[7]||(s[7]=p=>w.value=p.api)},null,8,["rowData","columnDefs"])])])}}};export{_e as default};

import{b as Ve,c as ye,r,F as n,d as H,x as K,K as De,o as xe,N as Ne,f as w,g as F,h as z,i as b,k as c,l as _,j as C,L as W,M as Ee,m,V as Ie,n as Te,D as j,I as Fe,J as _e,B as ke,t as Re,O as Se}from"./app-db6918d0.js";/* empty css                   */import{_ as Me}from"./EditValue-4c676dce.js";import{f as M}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Ae={class:"grid grid-rows-[55px,1fr]"},Pe=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ue={class:"flex flex-col"},$e={class:"m-2 flex"},Oe="yyyy-MM-dd",Be=8*60,Le=19*60+59,je={__name:"ParametrValue",setup(qe){const Q=Ve(),{t:o,locale:J}=ye(),A=r([]),i=r(null),v=r({}),P=r([]),N=r(new Date),X=r(null),E=r(null),Y=r(null),U=r(null);r(null);const p=r(null),Z=n.state.user.id,ee=n.state.user.structure_id,f=r(null);r([]);const ae=r([]),I=r([]),te=r([]),le=r([]);r(0);const V=H({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:n.state.user.structure_id,SourceID:"",userId:n.state.user.id}),d=H({id:"",Comment:"",Value:"",userId:n.state.user.id}),$=r([{headerName:o("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0,cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=v.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=v.value)==null?void 0:a[e.data.id])&&((t=v.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"}},{headerName:o("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:o("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:o("table.parameters"),field:K(()=>J.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:o("table.graphictimes"),headerClass:"header-center",children:[{headerName:o("table.startingTime"),field:"STime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:o("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:o("table.interval"),headerClass:"header-center",children:[{headerName:o("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:o("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:o("table.value"),field:"Value",width:150,editable:e=>(console.log("params.data:",e.data),e.data&&e.data.WithFormula!=="1"),suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=v.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=v.value)==null?void 0:a[e.data.id])&&((t=v.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:o("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),se=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?f.value>1?f.value-=1:f.value=I.value.length:f.value<I.value.length?f.value+=1:f.value=1)},re=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&i.navigateToNextCell({key:e.key}))},ne=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&re(e)})};function oe(){const e=U.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const O=async()=>{console.log(n.state.user.structure_id);try{const e=await m.get("/changes"),a=await m.get(`/pages/${n.state.user.structure_id}`);I.value=a.data;const t=await m.get(`/paramWithId/${ee}`);P.value=e.data.map(l=>({value:l.Change,text:l.Change})),ae.value=t.data.map(l=>({value:l.Pid,text:l.PName}));const u=await m.get("/source");te.value=u.data.map(l=>({value:l.id,text:l.Name}));const g=await m.get("/graphictimes");le.value=g.data.map(l=>({value:l.id,text:l.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},ue={sortable:!0,filter:!0,resizable:!0},ie=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",B={columnDefs:$.value,suppressScrollOnNewData:!0,getRowClass:ie,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},de=e=>{console.log("Updated Data:",e)},ce=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},L=()=>{const e=ce();return e>=Be&&e<=Le?1:2},me=()=>{Q.push("/vparamsget")};V.Change=L(),K(()=>L());async function k(e){n.state.newValue=e;const a=V.Change,t=M(N.value,Oe);n.state.ValueDay=t,new Date().getHours();try{const[u,g]=await m.all([m.get(`/get-params-for-user/${n.state.user.structure_id}/${a}/${t}/${e}`),m.get(`/vparams-value/${n.state.user.structure_id}/${t}/${a}`)]),l=u.data,x=g.data;l.forEach((h,s)=>{const q=x.find(G=>G.TimeID==h.GTid&&G.ParametersID==h.ParametersID);q&&(l[s]={...h,...q})}),A.value=l}catch(u){console.error("Error fetching data:",u)}}const fe=async e=>{const{data:a,colDef:t,newValue:u,oldValue:g}=e;if(u!==g)try{await ge(a);const l=e.rowIndex,x=i.value.getDisplayedRowCount();if(i.value&&i.value.ensureIndexVisible(l,"bottom"),l<x-1){i.value.stopEditing();const h=t.field==="Value"?"Value":"Comment";i.value.setFocusedCell(l+1,h)}}catch(l){console.error("Error saving data",l)}},ge=async e=>{console.log(N.value);const a=V.Change,t=n.state.ValueDay;try{const u=await m.post("/vparams",{...e,userId:Z,change:a,daySelect:t});return he(),k(n.state.newValue),u}catch(u){console.error("Error saving data",u)}},he=()=>{i.value&&i.value.clearFocusedCell()},ve=()=>{T.value&&i.value&&(i.value.stopEditing(),T.value=!1)};let y=null,D=null,T=r(!1);const pe=e=>{const{column:a}=e;if(a){const t=a.getColId();t==="Value"||t==="Comment"?(S(),T.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(ve,6e4)):R()}},we=e=>{const{column:a}=e;if(a){const t=a.getColId();(t==="Value"||t==="Comment")&&(S(),T.value=!1,p.value&&(clearTimeout(p.value),p.value=null))}},R=()=>{y||(n.state.newValue=n.state.newValue||1,y=setInterval(()=>k(n.state.newValue),6e4)),D||(D=setInterval(O,6e4))},Ce=async e=>{try{const{data:a}=await m.post("/vparamsEdit",d);a.status===200?(X.value=!1,d.id="",d.Comment="",d.Value="",d.userId="",e.setData(a.updatedRowData),B.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},S=()=>{y&&(clearInterval(y),y=null),D&&(clearInterval(D),D=null)},be=e=>{i.value=e.api,e.api.addEventListener("cellFocused",pe),e.api.addEventListener("cellBlurred",we),R()};return De(f,e=>{k(e)}),xe(()=>{O(),R(),ne()}),Ne(()=>{S()}),(e,a)=>{const t=w("VaTextarea"),u=w("VaModal"),g=w("VaDateInput"),l=w("VaSelect"),x=w("VaTab"),h=w("ag-grid-vue");return F(),z("div",Ae,[b("main",null,[c(u,{modelValue:E.value,"onUpdate:modelValue":a[2]||(a[2]=s=>E.value=s),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=s=>Ce(Y.value)),"close-button":""},{default:_(()=>[Pe,b("div",null,[c(C(Ie),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:_(()=>[c(C(Te),{class:"w-full",modelValue:d.Value,"onUpdate:modelValue":a[0]||(a[0]=s=>d.Value=s),rules:[s=>s&&s.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),c(t,{class:"w-full",modelValue:d.Comment,"onUpdate:modelValue":a[1]||(a[1]=s=>d.Comment=s),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",Ue,[b("div",$e,[c(g,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=s=>N.value=s),class:"mr-2",label:"Day"},null,8,["modelValue"]),c(l,{modelValue:V.Change,"onUpdate:modelValue":a[5]||(a[5]=s=>V.Change=s),"value-by":"value",label:C(o)("menu.changes"),options:P.value,clearable:""},null,8,["modelValue","label","options"]),c(C(j),{onClick:oe,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),c(C(j),{onClick:me,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),b("div",{ref_key:"gridContainer",ref:U,class:"ag-grid-container h-full"},[c(C(Se),{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=s=>f.value=s),stateful:"",grow:"",onKeydown:se,tabindex:"0"},{tabs:_(()=>[(F(!0),z(Fe,null,_e(I.value,s=>(F(),W(x,{key:s.id,name:s.id},{default:_(()=>[ke(Re(s.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),c(h,{rowData:A.value,columnDefs:$.value,defaultColDef:ue,gridOptions:B,animateRows:"true",class:"ag-theme-material h-full",onGridReady:be,onCellValueChanged:fe,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),E.value?(F(),W(Me,{key:0,showModalEdit:E.value,resultEdit:d,onUpdate:de},null,8,["showModalEdit","resultEdit"])):Ee("",!0)])])}}};export{je as default};

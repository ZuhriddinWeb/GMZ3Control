import{C as $,Q as G,u as J,c as Q,r as p,s as x,b as Z,K as W,o as X,D as Y,n as C,R as ee,f as te,g as w,h as k,i as l,I as ae,J as le,j as f,l as se,k as g,m as ne,S as oe,T as re,G as ie,z as j,t as v}from"./app-r41OqZAH.js";/* empty css                   */import{V as ue}from"./VueShiftCalendar-VKOGW-JE.js";$.register(...G);const de={class:"grid grid-rows-[55px,1fr] bg-stone-100"},me={class:"flex justify-between w-full mt-6 px-4"},ce={class:"flex flex-col w-full"},pe={class:"w-full"},fe={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-1 my-6 shadow-sm border border-slate-200 mt-16 p-4"},ge=["onClick"],ve={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},ye={class:"flex justify-between"},be={class:"flex flex-col w-9/12"},_e={class:"mb-2 text-slate-800 font-semibold flex items-center p-2"},he=["innerHTML"],xe={class:"p-2"},Ce={class:"grid grid-cols-[min-content,auto] gap-x-2 gap-y-1 font-semibold m-2"},we={class:"text-green-600"},ke={class:"text-red-600"},Ie={class:"text-blue-600"},De={class:"text-teal-600"},Ve={class:"text-purple-600"},Te={class:"flex flex-col justify-between"},Re={class:"w-[200] mt-20 mr-2"},Be={__name:"OperatorsCountInputValueCard",setup(Se){const{init:Fe}=J(),{locale:y,t:I}=Q(),r=p({smena:null,day:null}),B=x(()=>route.query.type);let D=null,V=null;const b=Z(),d=p([]);p(null);const T=p(null);function E(a){b.push({name:"OperatorDetail",params:{id:a}})}function M(a){T.value=a,_()}function P(a){b.push({name:"OperatorDetail",params:{id:a},query:{type:"inputed"}})}function L(a){b.push({name:"OperatorDetail",params:{id:a},query:{type:"not_inputed"}})}const O=x(()=>r.value.day?`${r.value.day} - ${r.value.smena}`:"");function U(a){const o=(y.value==="ru"?a.NameRus:a.Name).split(" "),e=[];for(let s=0;s<o.length;s+=3)e.push(o.slice(s,s+3).join(" "));return e.join("<br>")}W(r,async a=>{a.day&&a.smena&&(d.value.forEach(t=>{t.loading=!0}),await _())},{deep:!0}),x(()=>B.value==="inputed"?allData.value.filter(a=>a.Value!==null):B.value==="not_inputed"?allData.value.filter(a=>a.Value===null):allData.value);const R=p(0),S=p(0);async function _(){const a=r.value.day,t=r.value.smena;if(!(!a||!t)){if(R.value=0,S.value=0,T.value){const{data:o}=await C.get(`/getRowPageResult/${T.value}`,{params:{day:a,smena:t}}),e=o.reduce((s,n)=>(s.total+=n.multiplied_parameter_count,s.filled+=n.kiritilgan,s.formula+=n.multiplied_formula_count,s.manual+=n.multiplied_manual_count,s),{total:0,filled:0,formula:0,manual:0});R.value=e.formula,S.value=e.manual}else{let o=0,e=0;const{data:s}=await C.get("/structure");for(const n of s){const u=await C.get(`/getRowPageResult/${n.id}`,{params:{day:a,smena:t}}),h=u.data.reduce((i,c)=>i+c.multiplied_parameter_count,0),N=u.data.reduce((i,c)=>i+c.kiritilgan,0),z=u.data.reduce((i,c)=>i+c.multiplied_formula_count,0),A=u.data.reduce((i,c)=>i+c.multiplied_manual_count,0),K=h-N;o+=h,e+=N,R.value+=z,S.value+=A;const m=d.value.find(i=>i.id===n.id);m&&(m.loading=!0,m.filled=N,m.notFilled=K,m.formula=z,m.manual=A,m.loading=!1)}H(e,o)}await oe(),q()}}function q(){const a=document.getElementById("barChart");if(!a)return;D&&D.destroy();const t=d.value.map(s=>y.value==="ru"?s.NameRus:s.Name),o=d.value.map(s=>s.filled),e=d.value.map(s=>s.notFilled);D=new $(a,{type:"bar",data:{labels:t,datasets:[{label:I("To‘ldirilgan"),data:o,backgroundColor:"rgba(34,197,94,0.6)"},{label:I("To‘ldirilmagan"),data:e,backgroundColor:"rgba(239,68,68,0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:I("Bo‘limlar bo‘yicha parametrlar holati")},legend:{position:"top"}},scales:{x:{ticks:{autoSkip:!1,maxRotation:90,minRotation:45}},y:{beginAtZero:!0}}}})}function H(a,t){const o=document.getElementById("pieChart");o&&(V&&V.destroy(),V=new $(o,{type:"pie",data:{labels:["Kiritilgan","Kiritilmagan"],datasets:[{data:[a,t-a],backgroundColor:["#10b981","#ef4444"]}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},title:{display:!0,text:"Umumiy parametrlar"}}}}))}let F=null;return X(async()=>{document.body.style.transform="scale(0.9)",document.body.style.transformOrigin="top left",document.body.style.width="111.11%";const a=localStorage.getItem("locale");a&&(y.value=a);const t=new Date,o=t.getHours(),e=t.toISOString().split("T")[0],s=o>=8&&o<20?1:2;(!r.value.day||!r.value.smena)&&(r.value={day:e,smena:s});try{const n=Y.state.user.structure_id;if(Array.isArray(n)&&n.length===1){const u=n[0];b.push({name:"OperatorDetail",params:{id:u}})}else if(Array.isArray(n)&&n.length>1){const u=await C.get(`/structures/${n.join(",")}`);d.value=u.data.map(h=>({...h,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(n){console.error("Error fetching data:",n)}await _(),F=setInterval(()=>{_()},6e5)}),x(()=>y.value==="uz"?"Русский":"O‘zbek"),ee(()=>{F&&clearInterval(F)}),(a,t)=>{const o=te("VaProgressCircle");return k(),w("div",de,[l("div",me,[l("div",ce,[l("div",pe,[l("div",fe,[(k(!0),w(ae,null,le(d.value,(e,s)=>(k(),w("div",{onClick:n=>M(e.id),key:s,class:re(["relative p-1 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(k(),w("div",ve,[f(o,{indeterminate:"",size:"medium"})])):ie("",!0),l("div",ye,[l("div",be,[l("div",null,[l("h5",_e,[l("span",{class:"block flex-grow leading-none",innerHTML:U(e)},null,8,he)])]),l("div",null,[l("div",xe,[f(g(j),{onClick:n=>E(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),f(g(j),{onClick:n=>P(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),f(g(j),{onClick:n=>L(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])])])]),l("div",Ce,[t[2]||(t[2]=l("span",{class:"text-green-600 material-symbols-outlined text-lg mr-3"},"edit",-1)),l("span",we,v(e.filled),1),t[3]||(t[3]=l("span",{class:"text-red-600 material-symbols-outlined text-lg mr-3"},"warning",-1)),l("span",ke,v(e.notFilled),1),t[4]||(t[4]=l("span",{class:"text-blue-600 material-symbols-outlined text-lg mr-3"},"support_agent",-1)),l("span",Ie,v(e.manual),1),t[5]||(t[5]=l("span",{class:"text-teal-600 material-symbols-outlined text-lg mr-3"},"function",-1)),l("span",De,v(e.formula),1),t[6]||(t[6]=l("span",{class:"text-purple-600 material-symbols-outlined text-lg mr-3"},"%",-1)),l("span",Ve,v(e.filled+e.notFilled>0?Math.round(e.filled/(e.filled+e.notFilled)*100):0),1)])])],10,ge))),128))])]),t[7]||(t[7]=l("div",{class:"p-6 bg-white border-sm border-slate-200 shadow-lg mt-2 mx-3 rounded-lg"},[l("div",{style:{height:"280px"}},[l("canvas",{id:"barChart"})])],-1))]),l("div",Te,[l("div",Re,[f(g(ue),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),class:"w-full mr-2 shadow-lg"},{default:se(()=>[f(g(ne),{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),t[8]||(t[8]=l("div",{class:"w-full mr-2 mt-80 flex justify-center"},[l("canvas",{id:"pieChart",class:"w-[350px] h-[350px]"})],-1))])])])}}};export{Be as default};

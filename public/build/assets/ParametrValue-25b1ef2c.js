import{_ as j,g as v,h as w,i as l,v as Re,L as be,r as n,M as Be,s as M,o as $e,N as Ce,O as Pe,P as Ae,G as we,k as h,t as q,I as ce,J as fe,Q as ue,R as Le,b as Ue,c as ze,D as V,d as Ve,K as pe,S as Oe,f as ie,l as O,j as T,F as ke,m as N,V as qe,n as xe,z as Se,y as je,T as Ge}from"./app-23ff0182.js";/* empty css                   */import{_ as He}from"./EditValue-8c96a2e6.js";import{f as de}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Ke={},We={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-3 h-3"};function Ye(x,c){return v(),w("svg",We,c[0]||(c[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"},null,-1)]))}const De=j(Ke,[["render",Ye]]),Qe={},Je={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-3 h-3"};function Xe(x,c){return v(),w("svg",Je,c[0]||(c[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"},null,-1)]))}const Ne=j(Qe,[["render",Xe]]),Ze={},et={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-[16px]"};function tt(x,c){return v(),w("svg",et,c[0]||(c[0]=[l("circle",{cx:"12",cy:"12",r:"4",stroke:"currentColor","stroke-width":"1.5",fill:"currentColor"},null,-1),l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"},null,-1)]))}const at=j(Ze,[["render",tt]]),lt={},nt={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-[13px]"};function st(x,c){return v(),w("svg",nt,c[0]||(c[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"},null,-1)]))}const rt=j(lt,[["render",st]]),ot={class:"shift-calendar-container"},ut={class:"shift-calendar-nav"},it={class:"shift-calendar__title"},dt={class:"shift-calendar__title"},ct={class:"shift-calendar-main"},ft={class:"shift-calendar-weeks"},mt={class:"shift-calendar-days"},ht={key:0,class:"shift-calendar-days__container"},vt=["disabled","onClick"],gt=["disabled","onClick"],pt=Re({__name:"VueShiftCalendar",props:be({firstShift:{default:null},lastShift:{default:null},withSlot:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:be(["change"],["update:modelValue"]),setup(x,{emit:c}){var f,Y,S,Q;const $=n(null),m=n(null),p=x,G=c,i=Be(x,"modelValue"),_=n({day:((f=i.value)==null?void 0:f.day)||null,smena:((Y=i.value)==null?void 0:Y.smena)||null}),C=n(new Date(((S=i.value)==null?void 0:S.day)||new Date).getFullYear()),o=n(new Date(((Q=i.value)==null?void 0:Q.day)||new Date).getMonth()),H=["Du","Se","Cho","Pa","Ju","Sha","Ya"],me=M(()=>new Date(C.value,o.value+1,0).getDate()),E=M(()=>{const a=new Date(C.value,o.value,1).getDay();return a===0?6:a-1}),K=M(()=>{let a=[];for(let s=0;s<E.value;s++)a.push({day:0,date:""});for(let s=1;s<=me.value;s++){const y=`${C.value}-${String(o.value+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`;a.push({day:s,date:y})}return a}),F=a=>{o.value+=a,o.value<0?(o.value=11,C.value--):o.value>11&&(o.value=0,C.value++)},k=a=>{C.value+=a},W=(a,s)=>{i.value&&(i.value.day=a,i.value.smena=s),_.value.day=a,_.value.smena=s,G("change",{day:a,smena:s})};return $e(async()=>{if(await Ce(),$.value){const a=$.value.getBoundingClientRect();m.value=a.height}}),Pe(async()=>{if(await Ce(),$.value){const a=$.value.getBoundingClientRect();m.value=a.height}}),(a,s)=>(v(),w("main",ot,[p.withSlot?(v(),w("div",{key:0,ref_key:"slotContentRef",ref:$},[Ae(a.$slots,"default",{},void 0,!0)],512)):we("",!0),l("div",{class:ue([{"shift-calendar-with-slot":p.withSlot},"shift-calendar"]),style:Le({top:`${m.value}px`})},[l("div",ut,[l("main",null,[l("button",{onClick:s[0]||(s[0]=y=>F(-1)),class:"shift-calendar__button shift-calendar-nav__button"},[h(De)]),l("button",{onClick:s[1]||(s[1]=y=>F(1)),class:"shift-calendar__button shift-calendar-nav__button"},[h(Ne)]),l("span",it,q(new Date(C.value,o.value).toLocaleString("ru",{month:"long"})),1)]),l("main",null,[l("span",dt,q(new Date(C.value,o.value).toLocaleString("ru",{year:"numeric"})),1),l("button",{onClick:s[2]||(s[2]=y=>k(-1)),class:"shift-calendar__button shift-calendar-nav__button"},[h(De)]),l("button",{onClick:s[3]||(s[3]=y=>k(1)),class:"shift-calendar__button shift-calendar-nav__button"},[h(Ne)])])]),l("table",ct,[l("thead",null,[l("tr",ft,[(v(),w(ce,null,fe(H,y=>l("td",{key:y},q(y),1)),64))])]),l("tbody",mt,[(v(!0),w(ce,null,fe(Math.ceil(K.value.length/7),(y,R)=>(v(),w("tr",{key:R},[(v(!0),w(ce,null,fe(K.value.slice(R*7,R*7+7),(d,he)=>{var B,J,X,P,Z,ee,A,te,ae,D,le,ne,se,re;return v(),w("td",{key:he},[d.day?(v(),w("div",ht,[l("span",{class:ue(["shift-calendar-days__day",{"shift-calendar-days__day-disabled":(((B=p.lastShift)==null?void 0:B.day)??0)<d.date||(((J=p.firstShift)==null?void 0:J.day)||0)>d.date}])},q(d.day),3),l("button",{disabled:(((X=p.lastShift)==null?void 0:X.day)??0)<d.date||(((P=p.firstShift)==null?void 0:P.day)||0)>d.date||((Z=p.firstShift)==null?void 0:Z.smena)==2&&(((ee=p.firstShift)==null?void 0:ee.day)??0)==d.date,class:ue([{"shift-calendar-day__active":(((A=_.value)==null?void 0:A.day)??0)===d.date&&(((te=_.value)==null?void 0:te.smena)??0)==1},"shift-calendar-days__day-button shift-calendar__button"]),onClick:I=>d.day!==0&&W(d.date,1)},[h(at)],10,vt),l("button",{disabled:(((ae=p.lastShift)==null?void 0:ae.day)??0)<d.date||(((D=p.firstShift)==null?void 0:D.day)||0)>d.date||((le=p.lastShift)==null?void 0:le.smena)==1&&(((ne=p.lastShift)==null?void 0:ne.day)??0)==d.date,class:ue([{"shift-calendar-night__active":(((se=_.value)==null?void 0:se.day)??0)===d.date&&(((re=_.value)==null?void 0:re.smena)??0)==2},"shift-calendar-days__night-button shift-calendar__button"]),onClick:I=>d.day!==0&&W(d.date,2)},[h(rt)],10,gt)])):we("",!0)])}),128))]))),128))])])],6)]))}});const wt=j(pt,[["__scopeId","data-v-86126e2b"]]);const _t={class:"grid grid-rows-[55px,1fr]"},yt={class:"flex flex-col"},bt={class:"m-2 flex pt-3"},Ct={class:"flex justify-end"},Vt=8*60,kt=19*60+59,It={__name:"ParametrValue",props:{id:Number},setup(x){const c=x,$=Ue(),{t:m,locale:p}=ze(),G=n([]),i=n(null),_=n({}),C=n([]),o=n({smena:null,day:null}),H=M(()=>o.value.day?`${o.value.day} - ${o.value.smena}`:""),me=n(null),E=n(null),K=n(null),F=n(null);n(null);const k=n(null),W=V.state.user.id;V.state.user.structure_id;const f=n("1");n([]);const Y=n([]),S=n([]);n([]),n([]),n(0);const Q=Ve({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:V.state.user.structure_id,SourceID:"",userId:V.state.user.id}),a=Ve({id:"",Comment:"",Value:"",userId:V.state.user.id}),s=n([{headerName:m("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0,cellClassRules:{"cell-green":e=>{var t;return e.data&&e.data.Value===((t=_.value)==null?void 0:t[e.data.id])},"cell-yellow":e=>{var t,u;return e.data&&e.data.Value!==((t=_.value)==null?void 0:t[e.data.id])&&((u=_.value)==null?void 0:u[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"}},{headerName:m("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:m("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:m("table.parameters"),field:M(()=>p.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:m("table.graphictimes"),headerClass:"header-center",children:[{headerName:m("table.startingTime"),field:"STime",width:120,valueFormatter:e=>de(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:m("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>de(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:m("table.interval"),headerClass:"header-center",children:[{headerName:m("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:m("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:m("table.value"),field:"Value",width:150,editable:e=>e.data&&e.data.WithFormula!=="1",suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var t;return e.data&&e.data.Value===((t=_.value)==null?void 0:t[e.data.id])},"cell-yellow":e=>{var t,u;return e.data&&e.data.Value!==((t=_.value)==null?void 0:t[e.data.id])&&((u=_.value)==null?void 0:u[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:m("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]);pe(S,e=>{e.length>0&&(f.value=e[0].NumberPage)},{immediate:!0}),pe(o,e=>{console.log("Tanlangan sana yoki smena o'zgardi:",e),D(f.value)});const y=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?parseInt(f.value)>1?f.value=String(parseInt(f.value)-1):f.value=String(S.value.length):parseInt(f.value)<S.value.length?f.value=String(parseInt(f.value)+1):f.value="1")},R=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&i.navigateToNextCell({key:e.key}))},d=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&R(e)})};function he(){const e=F.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const B=async()=>{try{const e=await N.get("/changes"),t=await N.get(`/pages-select/${c.id}`);S.value=t.data;const u=await N.get(`/paramWithId/${c.id}`);C.value=e.data.map(g=>({value:g.Change,text:g.Change})),Y.value=u.data.map(g=>({value:g.Pid,text:g.PName}))}catch(e){console.error("Error fetching graphics data:",e)}},J={sortable:!0,filter:!0,resizable:!0},X=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",P={columnDefs:s.value,suppressScrollOnNewData:!0,getRowClass:X,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:t}=e.event;return t==="ArrowUp"||t==="ArrowDown"||t==="ArrowLeft"||t==="ArrowRight"?!0:e.previousCellDef}},Z=e=>{},ee=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},A=()=>{const e=ee();return e>=Vt&&e<=kt?1:2},te=()=>{$.push("/vparamsget")};Q.Change=A(),M(()=>A());const ae=()=>{const e=new Date().getHours();return e>=8&&e<20?1:2};async function D(e){try{const t=de(new Date,"yyyy-MM-dd"),u=o.value.smena,[g,U]=await N.all([N.get(`/get-params-for-user/${c.id}/${u}/${t}/${e}`),N.get(`/vparams-value/${V.state.user.structure_id}/${t}/${u}`)]),b=g.data,r=U.data;b.forEach((z,Fe)=>{const _e=r.find(ye=>ye.TimeStr==z.GTName&&ye.ParametersID==z.ParametersID);_e&&(b[Fe]={...z,..._e})}),G.value=b}catch(t){console.error("Error fetching data:",t)}}const le=async e=>{const{data:t,colDef:u,newValue:g,oldValue:U}=e;if(g!==U)try{await ne(t);const b=e.rowIndex,r=i.value.getDisplayedRowCount();if(i.value&&i.value.ensureIndexVisible(b,"bottom"),b<r-1){i.value.stopEditing();const z=u.field==="Value"?"Value":"Comment";i.value.setFocusedCell(b+1,z)}}catch(b){console.error("Error saving data",b)}},ne=async e=>{const t=o.value.smena,u=o.value.day;try{const g=await N.post("/vparams",{...e,userId:W,change:t,daySelect:u});return se(),D(V.state.newValue),g}catch(g){console.error("Error saving data",g)}},se=()=>{i.value&&i.value.clearFocusedCell()},re=()=>{oe.value&&i.value&&(i.value.stopEditing(),oe.value=!1)};let I=null,L=null,oe=n(!1);const Ie=e=>{const{column:t}=e;if(t){const u=t.getColId();u==="Value"||u==="Comment"?(ge(),oe.value=!0,k.value&&clearTimeout(k.value),k.value=setTimeout(re,6e4)):ve()}},Te=e=>{const{column:t}=e;if(t){const u=t.getColId();(u==="Value"||u==="Comment")&&(ge(),oe.value=!1,k.value&&(clearTimeout(k.value),k.value=null))}},ve=()=>{I||(V.state.newValue=V.state.newValue||1,I=setInterval(()=>D(V.state.newValue),6e4)),L||(L=setInterval(B,6e4))},Ee=async e=>{try{const{data:t}=await N.post("/vparamsEdit",a);t.status===200?(me.value=!1,a.id="",a.Comment="",a.Value="",a.userId="",e.setData(t.updatedRowData),P.api.refreshCells()):console.error("Error saving data:",t.message)}catch(t){console.error("Error saving data:",t)}},ge=()=>{I&&(clearInterval(I),I=null),L&&(clearInterval(L),L=null)},Me=e=>{i.value=e.api,e.api.addEventListener("cellFocused",Ie),e.api.addEventListener("cellBlurred",Te),ve()};return pe(f,e=>{D(e)}),$e(()=>{o.value.day=de(new Date,"yyyy-MM-dd"),o.value.smena=ae(),D(f.value),B(),ve(),d()}),Oe(()=>{ge()}),(e,t)=>{const u=ie("VaTextarea"),g=ie("VaModal"),U=ie("VaTab"),b=ie("ag-grid-vue");return v(),w("div",_t,[l("main",null,[h(g,{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=r=>E.value=r),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:t[3]||(t[3]=r=>Ee(K.value)),"close-button":""},{default:O(()=>[t[7]||(t[7]=l("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1)),l("div",null,[h(T(qe),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:O(()=>[h(T(xe),{class:"w-full",modelValue:a.Value,"onUpdate:modelValue":t[0]||(t[0]=r=>a.Value=r),rules:[r=>r&&r.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),h(u,{class:"w-full",modelValue:a.Comment,"onUpdate:modelValue":t[1]||(t[1]=r=>a.Comment=r),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),l("main",yt,[l("div",bt,[h(T(wt),{modelValue:o.value,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value=r),"with-slot":!0},{default:O(()=>[h(T(xe),{modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=r=>H.value=r),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),l("div",Ct,[h(T(Se),{onClick:he,class:"btn btn-primary items-center justify-center mt-3 ml-3 w-10",icon:"fullscreen"}),h(T(Se),{onClick:te,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})])]),l("div",{ref_key:"gridContainer",ref:F,class:"ag-grid-container h-full"},[h(T(Ge),{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=r=>f.value=r),stateful:"",grow:"",onKeydown:y,tabindex:"0"},{tabs:O(()=>[(v(!0),w(ce,null,fe(S.value,r=>(v(),ke(U,{key:r.NumberPage,name:r.NumberPage},{default:O(()=>[je(q(r.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),h(b,{rowData:G.value,columnDefs:s.value,defaultColDef:J,gridOptions:P,animateRows:"true",class:"ag-theme-material h-full",onGridReady:Me,onCellValueChanged:le},null,8,["rowData","columnDefs"])],512),E.value?(v(),ke(He,{key:0,showModalEdit:E.value,resultEdit:a,onUpdate:Z},null,8,["showModalEdit","resultEdit"])):we("",!0)])])}}};export{It as default};

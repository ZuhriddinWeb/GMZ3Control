import{c as O,a as j,u as z,r as i,s as c,d as L,o as q,f as u,g as J,h as T,i as n,j as d,F as K,G as Q,k as r,z as W,l as C,t as X,V as Y,n as f,H as _}from"./app-CXTPu4f3.js";/* empty css                   */import{_ as Z,a as ee}from"./DeleteGraphicTimesModal-6f0g7Osf.js";import{f as v}from"./format-D9pTN3Kd.js";const ae={class:"grid grid-rows-[55px,1fr]"},te={class:"flex justify-between"},le={class:"va-h3"},oe={class:"grid grid-cols-1 md:grid-cols-1 gap-1 items-end w-full"},se={class:"grid grid-cols-2 md:grid-cols-3 gap-3 items-end"},re={class:"flex-grow"},me={__name:"GraphicTimesPage",props:{id:Number},setup(y){const{locale:D,t}=O(),I=j(),{init:E}=z(),h=y,b=i([]),w=i(null),m=i(!1),k=i([]),V=i([]),x=c(()=>I.state.user.roles[8]),p=a=>{var e,s;return((s=(e=x.value)==null?void 0:e.pivot)==null?void 0:s[a])==="1"},G=c(()=>p("create")),S=c(()=>p("update")),H=c(()=>p("delete"));console.log(x);const l=L({GraphicId:h.id,ChangeId:"",Name:"",StartTime:"",EndTime:""});function R(a){w.value.applyTransaction({remove:[a]})}function $(a,e){a.setData(e)}_("ondeleted",R),_("onupdated",$);const U=c(()=>{const a=[{headerName:t("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:"ID",field:"id",width:80},{headerName:t("table.change"),field:"Change",width:120},{headerName:t("table.graphicName"),field:"GName",flex:1},{headerName:t("table.name"),field:"Name",flex:1,valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.startTime"),field:"StartTime",valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.endTime"),field:"EndTime",valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.comment"),field:"Comment",flex:1}];return S.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:Z}),H.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ee}),a}),B={sortable:!0,filter:!0},N=async()=>{try{const a=await f.get(`/getTimes/${h.id}`);b.value=Array.isArray(a.data)?a.data:a.data.items}catch(a){console.error("Error fetching data:",a)}},F=async()=>{try{const a=await f.get("/graphics"),e=await f.get("/changes");k.value=a.data.map(s=>({value:s.id,text:s.Name})),V.value=e.data.map(s=>({value:s.Change,text:s.Change}))}catch(a){console.error("Error fetching graphics data:",a)}},M=async()=>{try{const{data:a}=await f.post("/graphictimes",l);a.status===200?(m.value=!1,l.ChangeId="",l.Name="",l.StartTime="",l.EndTime="",await N(),E({message:t("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}};return q(()=>{const a=localStorage.getItem("locale");a&&(D.value=a),N(),F()}),(a,e)=>{const s=u("VaSelect"),g=u("VaTimeInput"),P=u("VaModal"),A=u("ag-grid-vue");return T(),J("div",ae,[n("main",null,[n("div",te,[e[7]||(e[7]=n("span",{class:"flex w-full"},null,-1)),G.value?(T(),K(r(W),{key:0,onClick:e[0]||(e[0]=o=>m.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):Q("",!0)]),d(P,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),"ok-text":r(t)("buttons.save"),"cancel-text":r(t)("buttons.cancel"),onOk:M,"close-button":""},{default:C(()=>[n("h3",le,X(r(t)("modals.addGraphicTimesTitle")),1),n("div",null,[d(r(Y),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:C(()=>[n("div",oe,[d(s,{modelValue:l.ChangeId,"onUpdate:modelValue":e[1]||(e[1]=o=>l.ChangeId=o),"value-by":"value",class:"mb-6",label:r(t)("form.selectChange"),options:V.value,clearable:""},null,8,["modelValue","label","options"])]),n("div",se,[d(g,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.name"),modelValue:l.Name,"onUpdate:modelValue":e[2]||(e[2]=o=>l.Name=o)},null,8,["label","modelValue"]),d(g,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.startTime"),modelValue:l.Name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.Name=o)},null,8,["label","modelValue"]),d(g,{modelValue:l.EndTime,"onUpdate:modelValue":e[4]||(e[4]=o=>l.EndTime=o),clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.endTime")},null,8,["modelValue","label"])])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),n("main",re,[d(A,{rowData:b.value,columnDefs:U.value,defaultColDef:B,animateRows:"true",class:"ag-theme-material h-full",onGridReady:e[6]||(e[6]=o=>w.value=o.api)},null,8,["rowData","columnDefs"])])])}}};export{me as default};

import{b as ue,c as ie,r as l,d as B,x as F,I as ce,o as me,J as he,f as u,g as O,h as ve,i as V,k as i,l as $,j as fe,K as ge,L as pe,m as d}from"./app-99702dc6.js";/* empty css                   */import{_ as Ce}from"./EditValue-d68a6163.js";import{f as y}from"./format-45c98358.js";const Ve={class:"grid grid-rows-[55px,1fr]"},we=V("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),be={class:"flex flex-col"},Ie={class:"m-2 flex"},_e="yyyy-MM-dd",De=8*60,xe=19*60+59,ke={__name:"ParametrValue",setup(Ee){const U=ue(),{t:o,locale:G}=ie(),N=l([]),c=l(null),x=l({}),M=l([]),w=l(new Date),H=l(null),b=l(null),L=l(null);l(null);const v=l(null),j=store.state.user.id,z=store.state.user.structure_id;l([]);const q=l([]),Q=l([]),A=l([]);l(0);const f=B({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:store.state.user.structure_id,SourceID:"",userId:store.state.user.id}),n=B({id:"",Comment:"",Value:"",userId:store.state.user.id}),k=l([{headerName:o("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center"},{headerName:o("table.change"),field:"Change",width:80,headerClass:"header-center"},{headerName:o("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center"},{headerName:o("table.parameters"),field:F(()=>G.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center"},{headerName:o("table.graphictimes"),headerClass:"header-center",children:[{headerName:o("table.startingTime"),field:"STime",width:120,valueFormatter:e=>y(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"},{headerName:o("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>y(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"}]},{headerName:o("table.interval"),headerClass:"header-center",children:[{headerName:o("table.min"),field:"Min",width:100,headerClass:"header-center"},{headerName:o("table.max"),field:"Max",width:100,headerClass:"header-center"}]},{headerName:o("table.value"),field:"Value",width:150,editable:!0,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===x.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==x.value[e.data.id]&&x.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:o("table.comment"),field:"Comment",flex:1,editable:!0,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),P=async()=>{try{const e=await d.get("/changes"),a=await d.get(`/paramWithId/${z}`);M.value=e.data.map(t=>({value:t.Change,text:t.Change})),q.value=a.data.map(t=>({value:t.Pid,text:t.PName}));const r=await d.get("/source");Q.value=r.data.map(t=>({value:t.id,text:t.Name}));const m=await d.get("/graphictimes");A.value=m.data.map(t=>({value:t.id,text:t.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},J={sortable:!0,filter:!0,resizable:!0},K=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",R={columnDefs:k.value,getRowClass:K,headerHeight:43},W=e=>{console.log("Updated Data:",e)},X=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},S=()=>{const e=X();return e>=De&&e<=xe?1:2},Y=()=>{U.push("/vparamsget")};f.Change=S(),F(()=>S());const g=async()=>{const e=f.Change,a=y(w.value,_e);new Date().getHours();try{d.all([d.get(`/get-params-for-user/${store.state.user.structure_id}/${e}/${a}`),d.get(`/vparams-value/${store.state.user.structure_id}/${a}`)]).then(d.spread(({data:r},{data:m})=>{r.forEach((t,h)=>{const _=m.find(D=>D.TimeID==t.GTid&&D.ParametersID==t.ParametersID);_&&(r[h]={...t,..._})}),N.value=r}))}catch(r){console.error("Error fetching data:",r)}},Z=async e=>{const{data:a,colDef:r,newValue:m,oldValue:t}=e;if(m!==t)try{await ee(a);const h=e.rowIndex;c.value&&c.value.ensureIndexVisible(h,"bottom")}catch(h){console.error("Error saving data",h)}},ee=async e=>{console.log(e);try{const a=await d.post("/vparams",{...e,userId:j});return ae(),g(),a}catch(a){console.error("Error saving data",a)}},ae=()=>{c.value&&c.value.clearFocusedCell()},te=()=>{I.value&&c.value&&(c.value.stopEditing(),I.value=!1,g())};let p=null,C=null,I=l(!1);const le=e=>{const{column:a}=e;if(a){const r=a.getColId();r==="Value"||r==="Comment"?(T(),I.value=!0,v.value&&clearTimeout(v.value),v.value=setTimeout(te,6e4)):E()}},re=e=>{const{column:a}=e;if(a){const r=a.getColId();(r==="Value"||r==="Comment")&&(T(),I.value=!1,v.value&&(clearTimeout(v.value),v.value=null))}},E=()=>{p||(p=setInterval(g,6e4)),C||(C=setInterval(P,6e4))},oe=async e=>{try{const{data:a}=await d.post("/vparamsEdit",n);a.status===200?(H.value=!1,n.id="",n.Comment="",n.Value="",n.userId="",e.setData(a.updatedRowData),R.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},T=()=>{p&&(clearInterval(p),p=null),C&&(clearInterval(C),C=null)},se=e=>{c.value=e.api,e.api.addEventListener("cellFocused",le),e.api.addEventListener("cellBlurred",re),E()};return ce([()=>f.Change,()=>w.value],g),me(()=>{g(),P(),E()}),he(()=>{T()}),(e,a)=>{const r=u("VaInput"),m=u("VaTextarea"),t=u("VaForm"),h=u("VaModal"),_=u("VaDateInput"),D=u("VaSelect"),ne=u("VaButton"),de=u("ag-grid-vue");return O(),ve("div",Ve,[V("main",null,[i(h,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=s=>b.value=s),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=s=>oe(L.value)),"close-button":""},{default:$(()=>[we,V("div",null,[i(t,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:$(()=>[i(r,{class:"w-full",modelValue:n.Value,"onUpdate:modelValue":a[0]||(a[0]=s=>n.Value=s),rules:[s=>s&&s.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),i(m,{class:"w-full",modelValue:n.Comment,"onUpdate:modelValue":a[1]||(a[1]=s=>n.Comment=s),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),V("main",be,[V("div",Ie,[i(_,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=s=>w.value=s),class:"mr-2",label:"Day"},null,8,["modelValue"]),i(D,{modelValue:f.Change,"onUpdate:modelValue":a[5]||(a[5]=s=>f.Change=s),"value-by":"value",label:fe(o)("menu.changes"),options:M.value,clearable:""},null,8,["modelValue","label","options"]),i(ne,{onClick:Y,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),i(de,{rowData:N.value,columnDefs:k.value,defaultColDef:J,gridOptions:R,animateRows:"true",class:"ag-theme-material h-full",onGridReady:se,onCellValueChanged:Z,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"]),b.value?(O(),ge(Ce,{key:0,showModalEdit:b.value,resultEdit:n,onUpdate:W},null,8,["showModalEdit","resultEdit"])):pe("",!0)])])}}};export{ke as default};

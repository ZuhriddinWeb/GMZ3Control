import{u as L,c as M,r as m,s as x,b as P,K as q,o as E,D as H,n as b,R as U,f as G,g as h,h as w,i as l,j as p,l as J,k as f,m as K,I as Q,J as W,S as X,G as Y,z as j,t as C}from"./app-B_t7h2fW.js";/* empty css                   */import{V as Z}from"./VueShiftCalendar-CUzObAzJ.js";const ee={class:"grid grid-rows-[55px,1fr] bg-stone-100"},te={class:"flex flex-row-reverse justify-between w-full"},ae={class:"w-[200] mt-28 mr-2"},le={class:"flex-1 w-5/6"},se={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 my-6 shadow-sm border border-slate-200 mt-24 p-4"},ne=["onClick"],oe={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},re={class:"mb-2 text-slate-800 font-semibold flex items-center"},ie=["innerHTML"],ue={class:"flex justify-between"},de={class:"flex justify-between flex-col"},ce={class:"flex justify-end"},me={class:"absolute top-2 right-2 w-20 grid grid-cols-[min-content,1fr] gap-x-2 gap-y-1 text-xl font-semibold text-right"},pe={class:"text-green-600 text-base"},fe={class:"text-red-600 text-base"},ge={class:"text-blue-600 text-base"},ve={class:"text-teal-600 text-base"},Ce={__name:"OperatorsCountInputValueCard",setup(ye){const{init:_e}=L(),{locale:k,t:xe}=M(),o=m({smena:null,day:null}),$=x(()=>route.query.type),g=P(),v=m([]);m(null);const V=m(null);function O(t){g.push({name:"OperatorDetail",params:{id:t}})}function R(t){V.value=t,y()}function z(t){g.push({name:"OperatorDetail",params:{id:t},query:{type:"inputed"}})}function F(t){g.push({name:"OperatorDetail",params:{id:t},query:{type:"not_inputed"}})}const N=x(()=>o.value.day?`${o.value.day} - ${o.value.smena}`:"");function A(t){const r=(k.value==="ru"?t.NameRus:t.Name).split(" "),e=[];for(let s=0;s<r.length;s+=2)e.push(r.slice(s,s+2).join(" "));return e.join("<br>")}q(o,async t=>{t.day&&t.smena&&(v.value.forEach(a=>{a.loading=!0}),await y())},{deep:!0}),x(()=>$.value==="inputed"?allData.value.filter(t=>t.Value!==null):$.value==="not_inputed"?allData.value.filter(t=>t.Value===null):allData.value);const D=m(0),I=m(0);async function y(){const t=o.value.day,a=o.value.smena;if(!(!t||!a))if(D.value=0,I.value=0,V.value){const{data:r}=await b.get(`/getRowPageResult/${V.value}`,{params:{day:t,smena:a}}),e=r.reduce((s,n)=>(s.total+=n.multiplied_parameter_count,s.filled+=n.kiritilgan,s.formula+=n.multiplied_formula_count,s.manual+=n.multiplied_manual_count,s),{total:0,filled:0,formula:0,manual:0});D.value=e.formula,I.value=e.manual}else{const{data:r}=await b.get("/structure");for(const e of r){const s=await b.get(`/getRowPageResult/${e.id}`,{params:{day:t,smena:a}}),n=s.data.reduce((i,d)=>i+d.multiplied_parameter_count,0),c=s.data.reduce((i,d)=>i+d.kiritilgan,0),_=s.data.reduce((i,d)=>i+d.multiplied_formula_count,0),T=s.data.reduce((i,d)=>i+d.multiplied_manual_count,0),B=n-c;D.value+=_,I.value+=T;const u=v.value.find(i=>i.id===e.id);u&&(u.loading=!0,u.filled=c,u.notFilled=B,u.formula=_,u.manual=T,u.loading=!1)}}}let S=null;return E(async()=>{const t=localStorage.getItem("locale");t&&(k.value=t);const a=new Date,r=a.getHours(),e=a.toISOString().split("T")[0],s=r>=8&&r<20?1:2;(!o.value.day||!o.value.smena)&&(o.value={day:e,smena:s});try{const n=H.state.user.structure_id;if(Array.isArray(n)&&n.length===1){const c=n[0];g.push({name:"OperatorDetail",params:{id:c}})}else if(Array.isArray(n)&&n.length>1){const c=await b.get(`/structures/${n.join(",")}`);v.value=c.data.map(_=>({..._,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(n){console.error("Error fetching data:",n)}await y(),S=setInterval(()=>{y()},6e5)}),x(()=>k.value==="uz"?"Русский":"O‘zbek"),U(()=>{S&&clearInterval(S)}),(t,a)=>{const r=G("VaProgressCircle");return w(),h("div",ee,[l("div",te,[l("div",ae,[p(f(Z),{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e),class:"w-full mr-2 shadow-sm"},{default:J(()=>[p(f(K),{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),l("div",le,[l("div",se,[(w(!0),h(Q,null,W(v.value,(e,s)=>(w(),h("div",{onClick:n=>R(e.id),key:s,class:X(["relative p-4 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(w(),h("div",oe,[p(r,{indeterminate:"",size:"medium"})])):Y("",!0),l("h5",re,[a[2]||(a[2]=l("span",{class:"material-symbols-outlined w-1"}," factory ",-1)),l("span",{class:"block flex-grow leading-none w-5/6",innerHTML:A(e)},null,8,ie)]),l("div",ue,[l("div",de,[l("div",ce,[l("div",null,[p(f(j),{onClick:n=>O(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),p(f(j),{onClick:n=>z(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),p(f(j),{onClick:n=>F(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])]),l("div",null,[l("div",me,[a[3]||(a[3]=l("span",{class:"text-green-600 material-symbols-outlined"},"edit",-1)),l("span",pe,C(e.filled),1),a[4]||(a[4]=l("span",{class:"material-symbols-outlined text-red-600"},"warning",-1)),l("span",fe,C(e.notFilled),1),a[5]||(a[5]=l("span",{class:"material-symbols-outlined text-blue-600"},"support_agent",-1)),l("span",ge,C(e.manual),1),a[6]||(a[6]=l("span",{class:"material-symbols-outlined text-teal-600"},"function",-1)),l("span",ve,C(e.formula),1)])])])])])],10,ne))),128))])])])])}}};export{Ce as default};

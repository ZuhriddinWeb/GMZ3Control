import{u as R,r as h,E as A,d as L,c as O,f as x,g as F,h as S,j as d,k as o,z as B,l as G,i as c,t as $,V as z,n as b,a as W,s as E,o as X,F as Y,G as Z,H as j}from"./app-BQLI1vby.js";/* empty css                   */import{f as P}from"./format-D9pTN3Kd.js";const ee={class:"h-full w-full text-center content-center"},ae={class:"grid grid-cols-2 md:grid-cols-2 gap-2 items-end w-full"},te={class:"grid grid-cols-2 md:grid-cols-3 gap-3 items-end"},le={__name:"EditGraphicTimesModal",props:["params"],setup(N){const{init:_}=R(),l=N,m=h(!1),T=h([]),w=h([]),y=A("onupdated"),s=L({GraphicId:"",ChangeId:"",Name:"",StartTime:"",EndTime:null,id:l.params.data.id}),{t:r}=O();function C(a){const[n,v,u]=a.split(":"),V=new Date;return V.setHours(parseInt(n,10)),V.setMinutes(parseInt(v,10)),V.setSeconds(parseInt(u,10)),V}function g(a){return a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const I={StartTime:"08:00:00.0000000",EndTime:"08:05:00.0000000"},D=C(I.StartTime),k=C(I.EndTime);g(D),g(k);const M=async()=>{try{const a=await b.get("/graphics"),n=await b.get("/changes");T.value=a.data.map(u=>({value:u.id,text:u.Name})),w.value=n.data.map(u=>({value:u.Change,text:u.Change}));const v=await b.get(`graphictimes/${l.params.data.id}`);s.GraphicId=+v.data.Gid,s.ChangeId=+v.data.Chid}catch(a){console.error("Error fetching data:",a)}},U=async()=>{try{const{data:a}=await b.put("/graphictimes",s);a.status===200?(m.value=!1,y(l.params.node,a.unit),_({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}};return(a,n)=>{const v=x("VaSelect"),u=x("VaTimeInput"),V=x("VaModal");return S(),F("main",ee,[d(o(B),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:n[0]||(n[0]=i=>m.value=!0)}),d(V,{modelValue:m.value,"onUpdate:modelValue":n[6]||(n[6]=i=>m.value=i),"ok-text":o(r)("modals.apply"),"cancel-text":o(r)("modals.cancel"),onOk:U,onClose:n[7]||(n[7]=i=>m.value=!1),"close-button":""},{default:G(()=>[c("h3",{class:"va-h3",onVnodeMounted:M},$(o(r)("modals.editFactory")),513),c("div",null,[d(o(z),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:G(()=>[c("div",ae,[d(v,{modelValue:s.GraphicId,"onUpdate:modelValue":n[1]||(n[1]=i=>s.GraphicId=i),"value-by":"value",class:"mb-6",label:o(r)("form.selectGraphic"),options:T.value,clearable:""},null,8,["modelValue","label","options"]),d(v,{modelValue:s.ChangeId,"onUpdate:modelValue":n[2]||(n[2]=i=>s.ChangeId=i),"value-by":"value",class:"mb-6",label:o(r)("form.selectChange"),options:w.value,clearable:""},null,8,["modelValue","label","options"])]),c("div",te,[d(u,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(r)("form.name"),modelValue:s.Name,"onUpdate:modelValue":n[3]||(n[3]=i=>s.Name=i)},null,8,["label","modelValue"]),d(u,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(r)("form.startTime"),modelValue:s.Name,"onUpdate:modelValue":n[4]||(n[4]=i=>s.Name=i)},null,8,["label","modelValue"]),d(u,{modelValue:s.EndTime,"onUpdate:modelValue":n[5]||(n[5]=i=>s.EndTime=i),clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(r)("form.endTime")},null,8,["modelValue","label"])])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},oe={class:"h-full w-full text-center content-center"},se={class:"va-h3"},ne={__name:"DeleteGraphicTimesModal",props:["params"],setup(N){const{init:_}=R(),{t:l}=O(),m=h(!1),T=N,w=A("ondeleted"),y=async()=>{try{const{data:s}=await b.delete(`/graphictimes/${T.params.data.id}`);s.status===200?(w(T.params.data),_({message:l("login.successMessage"),color:"success"}),m.value=!1):console.error("Error deleting data:",s.message)}catch(s){console.error("Error deleting data:",s)}};return(s,r)=>{const C=x("VaModal");return S(),F("main",oe,[d(o(B),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:r[0]||(r[0]=g=>m.value=!0)}),d(C,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=g=>m.value=g),"ok-text":o(l)("modals.apply"),"cancel-text":o(l)("modals.cancel"),onClose:r[2]||(r[2]=g=>m.value=!1),onOk:y,"close-button":""},{default:G(()=>[c("h3",se,$(o(l)("modals.title")),1),c("p",null,$(o(l)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},re={class:"grid grid-rows-[55px,1fr]"},de={class:"flex justify-between"},ie={class:"va-h3"},ce={class:"grid grid-cols-1 md:grid-cols-1 gap-1 items-end w-full"},me={class:"grid grid-cols-2 md:grid-cols-3 gap-3 items-end"},ue={class:"flex-grow"},ve={__name:"GraphicTimesPage",props:{id:Number},setup(N){const{locale:_,t:l}=O(),m=W(),{init:T}=R(),w=N,y=h([]),s=h(null),r=h(!1),C=h([]),g=h([]),I=E(()=>m.state.user.roles[8]),D=t=>{var e,f;return((f=(e=I.value)==null?void 0:e.pivot)==null?void 0:f[t])==="1"},k=E(()=>D("create")),M=E(()=>D("update")),U=E(()=>D("delete"));console.log(I);const a=L({GraphicId:w.id,ChangeId:"",Name:"",StartTime:"",EndTime:""});function n(t){s.value.applyTransaction({remove:[t]})}function v(t,e){t.setData(e)}j("ondeleted",n),j("onupdated",v);const u=E(()=>{const t=[{headerName:l("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:"ID",field:"id",width:80},{headerName:l("table.change"),field:"Change",width:120},{headerName:l("table.graphicName"),field:"GName",flex:1},{headerName:l("table.name"),field:"Name",flex:1,valueFormatter:e=>P(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:l("table.startTime"),field:"StartTime",valueFormatter:e=>P(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:l("table.endTime"),field:"EndTime",valueFormatter:e=>P(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:l("table.comment"),field:"Comment",flex:1}];return M.value&&t.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:le}),U.value&&t.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ne}),t}),V={sortable:!0,filter:!0},i=async()=>{try{const t=await b.get(`/getTimes/${w.id}`);y.value=Array.isArray(t.data)?t.data:t.data.items}catch(t){console.error("Error fetching data:",t)}},q=async()=>{try{const t=await b.get("/graphics"),e=await b.get("/changes");C.value=t.data.map(f=>({value:f.id,text:f.Name})),g.value=e.data.map(f=>({value:f.Change,text:f.Change}))}catch(t){console.error("Error fetching graphics data:",t)}},J=async()=>{try{const{data:t}=await b.post("/graphictimes",a);t.status===200?(r.value=!1,a.ChangeId="",a.Name="",a.StartTime="",a.EndTime="",await i(),T({message:l("login.successMessage"),color:"success"})):console.error("Error saving data:",t.message)}catch(t){console.error("Error saving data:",t)}};return X(()=>{const t=localStorage.getItem("locale");t&&(_.value=t),i(),q()}),(t,e)=>{const f=x("VaSelect"),H=x("VaTimeInput"),K=x("VaModal"),Q=x("ag-grid-vue");return S(),F("div",re,[c("main",null,[c("div",de,[e[7]||(e[7]=c("span",{class:"flex w-full"},null,-1)),k.value?(S(),Y(o(B),{key:0,onClick:e[0]||(e[0]=p=>r.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):Z("",!0)]),d(K,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=p=>r.value=p),"ok-text":o(l)("buttons.save"),"cancel-text":o(l)("buttons.cancel"),onOk:J,"close-button":""},{default:G(()=>[c("h3",ie,$(o(l)("modals.addGraphicTimesTitle")),1),c("div",null,[d(o(z),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:G(()=>[c("div",ce,[d(f,{modelValue:a.ChangeId,"onUpdate:modelValue":e[1]||(e[1]=p=>a.ChangeId=p),"value-by":"value",class:"mb-6",label:o(l)("form.selectChange"),options:g.value,clearable:""},null,8,["modelValue","label","options"])]),c("div",me,[d(H,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(l)("form.name"),modelValue:a.Name,"onUpdate:modelValue":e[2]||(e[2]=p=>a.Name=p)},null,8,["label","modelValue"]),d(H,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(l)("form.startTime"),modelValue:a.Name,"onUpdate:modelValue":e[3]||(e[3]=p=>a.Name=p)},null,8,["label","modelValue"]),d(H,{modelValue:a.EndTime,"onUpdate:modelValue":e[4]||(e[4]=p=>a.EndTime=p),clearable:"","clearable-icon":"cancel",color:"textPrimary",label:o(l)("form.endTime")},null,8,["modelValue","label"])])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),c("main",ue,[d(Q,{rowData:y.value,columnDefs:u.value,defaultColDef:V,animateRows:"true",class:"ag-theme-material h-full",onGridReady:e[6]||(e[6]=p=>s.value=p.api)},null,8,["rowData","columnDefs"])])])}}};export{ve as default};

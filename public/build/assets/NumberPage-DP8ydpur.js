import{u as j,c as L,r as S,E as Q,f as F,g as H,h as G,j as n,k as e,z as J,l as M,i as V,t as O,n as P,d as X,K as ae,V as Y,m as q,F as Z,G as ee,L as te,a as le,s as E,o as oe,H as W}from"./app-BO2GkehY.js";/* empty css                   */import{D as se,a as re,b as A}from"./data-grid-C_8yCrHw.js";const ne={class:"h-full w-full text-center content-center"},ue={class:"va-h3"},de={__name:"DeleteBlog",props:["params"],setup(R){const{init:v}=j(),{t:w}=L(),c=S(!1),r=R,b=Q("ondeleted"),u=async()=>{try{const{data:g}=await P.delete(`/pages/${r.params.data.id}`);g.status===200?(b(r.params.data),c.value=!1,v({message:w("login.successMessage"),color:"success"})):console.error("Error deleting data:",g.message)}catch(g){console.error("Error deleting data:",g)}};return(g,l)=>{const C=F("VaModal");return G(),H("main",ne,[n(e(J),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:l[0]||(l[0]=d=>c.value=!0)}),n(C,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=d=>c.value=d),"ok-text":e(w)("modals.apply"),"cancel-text":e(w)("modals.cancel"),onClose:l[2]||(l[2]=d=>c.value=!1),onOk:u,"close-button":""},{default:M(()=>[V("h3",ue,O(e(w)("modals.title")),1),V("p",null,O(e(w)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ce={class:"h-full w-full text-center content-center"},me={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},ie={__name:"EditBlog",props:["params"],setup(R){const{init:v}=j(),w=R,c=S(!1),r=Q("onupdated"),b=S([]),{t:u,locale:g}=L(),l=X({StructureID:"",Name:"",NameRus:"",NumberPage:"",Comment:"",id:w.params.data.id}),C=async()=>{try{const x=await P.get("/structure");b.value=x.data.map(D=>({value:D.id,text:g.value==="uz"?D.Name:D.NameRus}));const o=await P.get(`pages/${w.params.data.id}`);l.StructureID=+o.data.StructureID,l.Name=o.data.Name,l.ShortName=o.data.ShortName,l.NumberPage=o.data.NumberPage,l.Comment=o.data.Comment}catch(x){console.error("Error fetching graphics data:",x)}},d=async()=>{try{const{data:x}=await P.put("/pages",l);x.status===200?(r(w.params.node,x.unit),c.value=!1,v({message:u("login.successMessage"),color:"success"})):console.error("Error saving data:",x.message)}catch(x){console.error("Error saving data:",x)}};return ae(()=>l.StructureID,x=>{}),(x,o)=>{const D=F("VaSelect"),i=F("VaTextarea"),f=F("VaModal");return G(),H("main",ce,[n(e(J),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:o[0]||(o[0]=t=>(c.value=!0,C))}),n(f,{modelValue:c.value,"onUpdate:modelValue":o[6]||(o[6]=t=>c.value=t),"ok-text":e(u)("modals.apply"),"cancel-text":e(u)("modals.cancel"),onOk:d,onClose:o[7]||(o[7]=t=>c.value=!1),"close-button":""},{default:M(()=>[V("h3",{class:"va-h3",onVnodeMounted:C},O(e(u)("modals.editFactory")),513),V("div",null,[n(e(Y),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:M(()=>[V("div",me,[n(D,{modelValue:l.StructureID,"onUpdate:modelValue":o[1]||(o[1]=t=>l.StructureID=t),"value-by":"value",class:"mb-1",label:e(u)("form.structureName"),options:b.value,clearable:""},null,8,["modelValue","label","options"])]),n(e(q),{class:"w-full",modelValue:l.NumberPage,"onUpdate:modelValue":o[2]||(o[2]=t=>l.NumberPage=t),type:"number",rules:[t=>t&&t.length>0||e(u)("validation.requiredField")],label:e(u)("form.numberpage")},null,8,["modelValue","rules","label"]),n(e(q),{class:"w-full",modelValue:l.Name,"onUpdate:modelValue":o[3]||(o[3]=t=>l.Name=t),rules:[t=>t&&t.length>0||e(u)("validation.requiredField")],label:e(u)("form.name")},null,8,["modelValue","rules","label"]),n(e(q),{class:"w-full",modelValue:l.NameRus,"onUpdate:modelValue":o[4]||(o[4]=t=>l.NameRus=t),rules:[t=>t&&t.length>0||e(u)("validation.requiredField")],label:e(u)("form.nameRus")},null,8,["modelValue","rules","label"]),n(i,{class:"w-full",modelValue:l.Comment,"onUpdate:modelValue":o[5]||(o[5]=t=>l.Comment=t),"max-length":"125",label:e(u)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},pe={class:"h-full w-full"},ge={class:"va-h3 mb-4"},fe={__name:"AddForDocuments",props:["params"],setup(R){const{t:v}=L(),{init:w}=j(),c=R,r=Q("onupdated"),b=S(!1),u=S([]),g=S([]),l={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},C=async()=>{b.value=!0,g.value=[];try{const{data:i}=await P.get(`/addfordoc/${c.params.data.id}`);u.value=x(i.tree),g.value=d(i.selected??[])}catch(i){console.error(i),w({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function d(i){return i.flat(3)}function x(i){const f=[];return i.forEach(t=>{var h;const T=t.key,z=t.title,p=parseInt(T.split("-")[1]);(h=t.children)==null||h.forEach(y=>{var I;const N=y.title,_=y.key,k=parseInt(_.split("-")[2]);(I=y.children)==null||I.forEach($=>{var K;const a=$.title,s=$.key,U=parseInt(s.split("-")[3]);(K=$.children)!=null&&K.length&&$.children.forEach(B=>{f.push({rowId:B.ParameterID??`param-${B.key}`,sexName:z,sexId:p,pageName:N,pageId:k,groupName:a,groupId:U,paramName:B.title,ParameterID:B.ParameterID})})})})}),f}const o=({selectedRowKeys:i})=>{g.value=i},D=async()=>{const i=u.value.filter(p=>g.value.includes(p.rowId)),f=[...new Set(i.map(p=>p.sexId))],t=f.map(p=>{const h=i.filter(y=>y.sexId===p).map(y=>y.pageId);return[...new Set(h)]}),T=f.map(p=>{const h=i.filter(N=>N.sexId===p);return[...new Set(h.map(N=>N.pageId))].map(N=>{const _=h.filter(k=>k.pageId===N).map(k=>k.groupId);return[...new Set(_)]})}),z=f.map(p=>{const h=i.filter(N=>N.sexId===p);return[...new Set(h.map(N=>N.pageId))].map(N=>{const _=h.filter(I=>I.pageId===N);return[...new Set(_.map(I=>I.groupId))].map(I=>_.filter(a=>a.groupId===I).map(a=>a.ParameterID).filter(a=>a))})});try{const{data:p}=await P.post("/addfordoc",{doc_id:c.params.data.id,FactoryStructureID:f,NumberPageBlogs:t,GroupBlogs:T,ParameterBlogs:z});if(p.status===200)r==null||r(),b.value=!1,w({message:v("login.successMessage"),color:"success"});else throw new Error(p.message||"Unknown error")}catch(p){console.error(p),w({message:v("errors.saveFailed"),color:"danger"})}};return(i,f)=>(G(),H("main",pe,[n(e(J),{icon:"design_services",round:"",preset:"primary",onClick:C}),n(e(te),{modelValue:b.value,"onUpdate:modelValue":f[0]||(f[0]=t=>b.value=t),"ok-text":e(v)("modals.apply"),"cancel-text":e(v)("modals.cancel"),onOk:D,onClose:f[1]||(f[1]=t=>b.value=!1),"close-button":"","max-width":"1000px"},{default:M(()=>[V("h3",ge,O(e(v)("modals.editFactory")),1),u.value.length?(G(),Z(e(se),{key:0,"data-source":u.value,"key-expr":"rowId","selected-row-keys":g.value,onSelectionChanged:o,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:l},{default:M(()=>[n(e(re),{mode:"multiple","show-check-boxes-mode":"always"}),n(e(A),{"data-field":"sexName",caption:e(v)("form.structureName"),"group-index":0},null,8,["caption"]),n(e(A),{"data-field":"pageName",caption:e(v)("form.numberpage"),"group-index":1},null,8,["caption"]),n(e(A),{"data-field":"groupName",caption:e(v)("menu.groups"),"group-index":2},null,8,["caption"]),n(e(A),{"data-field":"paramName",caption:e(v)("form.name")},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):ee("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"])]))}},ve={class:"grid grid-rows-[55px,1fr]"},we={class:"flex justify-between"},be={class:"va-h3"},xe={class:"flex-grow"},ye={__name:"NumberPage",props:{id:Number},setup(R){const{init:v}=j(),w=le(),{locale:c,t:r}=L(),b=R,u=S([]),g=S(null),l=S(!1),C=S([]),d=X({StructureID:b.id,Name:"",NameRus:"",NumberPage:"",Comment:""}),x=E(()=>w.state.user.roles[17]),o=a=>{var s,U;return((U=(s=x.value)==null?void 0:s.pivot)==null?void 0:U[a])==="1"},D=a=>b.id===22,i=E(()=>o("create")),f=E(()=>o("update")),t=E(()=>o("delete"));E(()=>D);function T(a){g.value.applyTransaction({remove:[a]})}function z(a,s){a.setData(s)}W("ondeleted",T),W("onupdated",z);const p=E(()=>{const a=[{headerName:r("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:r("table.structure"),field:_(),flex:1},{headerName:r("table.name"),field:y(),flex:1},{headerName:r("table.numberpage"),field:"NumberPage"},{headerName:r("table.comment"),field:N()}];return b.id==22&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:fe}),f.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ie}),t.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:de}),a}),h={sortable:!0,filter:!0},y=()=>c.value==="uz"?"Name":"NameRus",N=()=>c.value==="uz"?"ShortName":"ShortNameRus",_=()=>c.value==="uz"?"SName":"NameRus",k=async()=>{try{const a=await P.get(`/getRowPage/${b.id}`);u.value=Array.isArray(a.data)?a.data:a.data.items}catch(a){console.error("Error fetching data:",a)}},I=async()=>{try{const a=await P.get("/structure");C.value=a.data.map(s=>({value:s.id,text:c.value==="uz"?s.Name:s.NameRus}))}catch(a){console.error("Error fetching graphics data:",a)}},$=async()=>{try{const{data:a}=await P.post("/pages",d);a.status===200?(l.value=!1,d.StructureID="",d.Name="",d.NameRus="",d.NumberPage="",d.Comment="",await k(),v({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}};return oe(()=>{const a=localStorage.getItem("locale");a&&(c.value=a),k(),I()}),E(()=>c.value==="uz"?"Русский":"O‘zbek"),(a,s)=>{const U=F("VaTextarea"),K=F("VaModal"),B=F("ag-grid-vue");return G(),H("div",ve,[V("main",null,[V("div",we,[s[7]||(s[7]=V("span",{class:"flex w-full"},null,-1)),i.value?(G(),Z(e(J),{key:0,onClick:s[0]||(s[0]=m=>(l.value=!0,I)),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):ee("",!0)]),n(K,{modelValue:l.value,"onUpdate:modelValue":s[5]||(s[5]=m=>l.value=m),"ok-text":e(r)("buttons.save"),"cancel-text":e(r)("buttons.cancel"),onOk:$,"close-button":""},{default:M(()=>[V("h3",be,O(e(r)("modals.addPageTitle")),1),V("div",null,[n(e(Y),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:M(()=>[n(e(q),{class:"w-full",modelValue:d.NumberPage,"onUpdate:modelValue":s[1]||(s[1]=m=>d.NumberPage=m),type:"number",rules:[m=>m&&m.length>0||e(r)("validation.requiredField")],label:e(r)("form.numberpage")},null,8,["modelValue","rules","label"]),n(e(q),{class:"w-full",modelValue:d.Name,"onUpdate:modelValue":s[2]||(s[2]=m=>d.Name=m),rules:[m=>m&&m.length>0||e(r)("validation.requiredField")],label:e(r)("form.name")},null,8,["modelValue","rules","label"]),n(e(q),{class:"w-full",modelValue:d.NameRus,"onUpdate:modelValue":s[3]||(s[3]=m=>d.NameRus=m),rules:[m=>m&&m.length>0||e(r)("validation.requiredField")],label:e(r)("form.nameRus")},null,8,["modelValue","rules","label"]),n(U,{class:"w-full",modelValue:d.Comment,"onUpdate:modelValue":s[4]||(s[4]=m=>d.Comment=m),"max-length":"125",label:e(r)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),V("main",xe,[n(B,{rowData:u.value,columnDefs:p.value,defaultColDef:h,animateRows:"true",class:"ag-theme-material h-full",onGridReady:s[6]||(s[6]=m=>g.value=m.api)},null,8,["rowData","columnDefs"])])])}}};export{ye as default};

import{b as ce,c as me,r as o,d as F,x as O,I as he,o as ve,J as fe,f as u,g as U,h as ge,i as b,k as i,l as $,j as pe,K as Ce,L as Ve,m as d}from"./app-8751e0f6.js";/* empty css                   */import{_ as we}from"./EditValue-0eb17ed3.js";import{f as N}from"./format-45c98358.js";const be={class:"grid grid-rows-[55px,1fr]"},Ie=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),_e={class:"flex flex-col"},De={class:"m-2 flex"},xe="yyyy-MM-dd",Ee=8*60,Te=19*60+59,Se={__name:"ParametrValue",setup(ye){const G=ce(),{t:r,locale:H}=me(),v=o([]),c=o(null),E=o({}),M=o([]),I=o(new Date),L=o(null),g=o(null),P=o(null);o(null);const f=o(null),j=store.state.user.id,z=store.state.user.structure_id;o([]);const q=o([]),Q=o([]),A=o([]);o(0);const p=F({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:store.state.user.structure_id,SourceID:"",userId:store.state.user.id}),n=F({id:"",Comment:"",Value:"",userId:store.state.user.id}),R=o([{headerName:r("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center"},{headerName:r("table.change"),field:"Change",width:80,headerClass:"header-center"},{headerName:r("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center"},{headerName:r("table.parameters"),field:O(()=>H.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center"},{headerName:r("table.graphictimes"),headerClass:"header-center",children:[{headerName:r("table.startingTime"),field:"STime",width:120,valueFormatter:e=>N(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"},{headerName:r("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>N(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"}]},{headerName:r("table.interval"),headerClass:"header-center",children:[{headerName:r("table.min"),field:"Min",width:100,headerClass:"header-center"},{headerName:r("table.max"),field:"Max",width:100,headerClass:"header-center"}]},{headerName:r("table.value"),field:"Value",width:150,editable:!0,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===E.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==E.value[e.data.id]&&E.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:r("table.comment"),field:"Comment",flex:1,editable:!0,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),S=async()=>{try{const e=await d.get("/changes"),a=await d.get(`/paramWithId/${z}`);M.value=e.data.map(t=>({value:t.Change,text:t.Change})),q.value=a.data.map(t=>({value:t.Pid,text:t.PName}));const l=await d.get("/source");Q.value=l.data.map(t=>({value:t.id,text:t.Name}));const m=await d.get("/graphictimes");A.value=m.data.map(t=>({value:t.id,text:t.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},J={sortable:!0,filter:!0,resizable:!0},K=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",k={columnDefs:R.value,getRowClass:K,headerHeight:43},W=e=>{const{colDef:a,data:l}=e;a.field==="Value"&&l.Value&&X(e)},X=e=>{console.log(e),v.value={...e.data},P.value=e.node,n.id=v.value.id,n.Value=v.value.Value,n.Comment=v.value.Comment,g.value=!0},Y=e=>{console.log("Updated Data:",e)},Z=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},B=()=>{const e=Z();return e>=Ee&&e<=Te?1:2},ee=()=>{G.push("/vparamsget")};p.Change=B(),O(()=>B());const C=async()=>{const e=p.Change,a=N(I.value,xe);new Date().getHours();try{d.all([d.get(`/get-params-for-user/${store.state.user.structure_id}/${e}/${a}`),d.get(`/vparams/${store.state.user.structure_id}`)]).then(d.spread(({data:l},{data:m})=>{l.forEach((t,h)=>{const D=m.find(x=>x.TimeID==t.GTid&&x.ParametersID==t.ParametersID);D&&(l[h]={...t,...D})}),v.value=l}))}catch(l){console.error("Error fetching data:",l)}},ae=async e=>{const{data:a,colDef:l,newValue:m,oldValue:t}=e;if(m!==t)try{await te(a);const h=e.rowIndex;c.value&&c.value.ensureIndexVisible(h,"bottom")}catch(h){console.error("Error saving data",h)}},te=async e=>{console.log(e);try{const a=await d.post("/vparams",{...e,userId:j});return le(),C(),a}catch(a){console.error("Error saving data",a)}},le=()=>{c.value&&c.value.clearFocusedCell()},oe=()=>{_.value&&c.value&&(c.value.stopEditing(),_.value=!1,C())};let V=null,w=null,_=o(!1);const re=e=>{const{column:a}=e;if(a){const l=a.getColId();l==="Value"||l==="Comment"?(y(),_.value=!0,f.value&&clearTimeout(f.value),f.value=setTimeout(oe,6e4)):T()}},ne=e=>{const{column:a}=e;if(a){const l=a.getColId();(l==="Value"||l==="Comment")&&(y(),_.value=!1,f.value&&(clearTimeout(f.value),f.value=null))}},T=()=>{V||(V=setInterval(C,6e4)),w||(w=setInterval(S,6e4))},se=async e=>{try{const{data:a}=await d.post("/vparamsEdit",n);a.status===200?(L.value=!1,n.id="",n.Comment="",n.Value="",n.userId="",e.setData(a.updatedRowData),k.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},y=()=>{V&&(clearInterval(V),V=null),w&&(clearInterval(w),w=null)},de=e=>{c.value=e.api,e.api.addEventListener("cellFocused",re),e.api.addEventListener("cellBlurred",ne),T()};return he([()=>p.Change,()=>I.value],C),ve(()=>{C(),S(),T()}),fe(()=>{y()}),(e,a)=>{const l=u("VaInput"),m=u("VaTextarea"),t=u("VaForm"),h=u("VaModal"),D=u("VaDateInput"),x=u("VaSelect"),ue=u("VaButton"),ie=u("ag-grid-vue");return U(),ge("div",be,[b("main",null,[i(h,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=s=>g.value=s),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=s=>se(P.value)),"close-button":""},{default:$(()=>[Ie,b("div",null,[i(t,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:$(()=>[i(l,{class:"w-full",modelValue:n.Value,"onUpdate:modelValue":a[0]||(a[0]=s=>n.Value=s),rules:[s=>s&&s.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),i(m,{class:"w-full",modelValue:n.Comment,"onUpdate:modelValue":a[1]||(a[1]=s=>n.Comment=s),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",_e,[b("div",De,[i(D,{modelValue:I.value,"onUpdate:modelValue":a[4]||(a[4]=s=>I.value=s),class:"mr-2",label:"Day"},null,8,["modelValue"]),i(x,{modelValue:p.Change,"onUpdate:modelValue":a[5]||(a[5]=s=>p.Change=s),"value-by":"value",label:pe(r)("menu.changes"),options:M.value,clearable:""},null,8,["modelValue","label","options"]),i(ue,{onClick:ee,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),i(ie,{rowData:v.value,columnDefs:R.value,defaultColDef:J,gridOptions:k,animateRows:"true",class:"ag-theme-material h-full",onGridReady:de,onCellValueChanged:ae,onCellDoubleClicked:W},null,8,["rowData","columnDefs"]),g.value?(U(),Ce(we,{key:0,showModalEdit:g.value,resultEdit:n,onUpdate:Y},null,8,["showModalEdit","resultEdit"])):Ve("",!0)])])}}};export{Se as default};

import{u as q,c as H,s as D,b as E,r as c,o as P,D as J,n as g,R as U,g as I,h as j,i as a,I as G,J as K,j as F,k as N,z as R,t as _}from"./app-U9sfK_em.js";/* empty css                   */const Q={class:"grid grid-rows-[55px,1fr] bg-stone-100"},W={class:"flex justify-between"},X={class:"w-4/6"},Y={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 my-6 shadow-sm border border-slate-200 mt-24 p-4"},Z=["onClick"],tt={class:"mb-2 text-slate-800 font-semibold flex items-center"},et=["innerHTML"],at={class:"flex justify-between"},st={class:"flex justify-between flex-col"},lt={class:"flex justify-end"},ot={class:"absolute top-2 right-2 w-24 grid grid-cols-[min-content,1fr] gap-x-2 gap-y-1 text-xl font-semibold text-right"},nt={class:"text-green-600 text-base"},rt={class:"text-red-600 text-base"},it={class:"text-blue-600 text-base"},ut={class:"text-teal-600 text-base"},gt={__name:"OperatorsCountInputValueCard",setup(dt){const{init:ct}=q(),{locale:m,t:mt}=H(),T=D(()=>route.query.type),p=E(),v=c([]);c(null);const y=c(null);function $(e){p.push({name:"OperatorDetail",params:{id:e}})}function V(e){y.value=e,h()}function z(e){p.push({name:"OperatorDetail",params:{id:e},query:{type:"inputed"}})}function A(e){p.push({name:"OperatorDetail",params:{id:e},query:{type:"not_inputed"}})}function B(e){const s=(m.value==="ru"?e.NameRus:e.Name).split(" "),n=[];for(let l=0;l<s.length;l+=3)n.push(s.slice(l,l+3).join(" "));return n.join("<br>")}D(()=>T.value==="inputed"?allData.value.filter(e=>e.Value!==null):T.value==="not_inputed"?allData.value.filter(e=>e.Value===null):allData.value);const x=c(0),b=c(0);async function h(){const e=new Date,t=e.toISOString().split("T")[0],s=e.getHours(),n=s>=8&&s<20?1:2;if(x.value=0,b.value=0,y.value){const{data:l}=await g.get(`/getRowPageResult/${y.value}`,{params:{day:t,smena:n}}),f=l.reduce((o,r)=>(o.total+=r.multiplied_parameter_count,o.filled+=r.kiritilgan,o.formula+=r.multiplied_formula_count,o.manual+=r.multiplied_manual_count,o),{total:0,filled:0,formula:0,manual:0});x.value=f.formula,b.value=f.manual}else{const{data:l}=await g.get("/structure"),f=[];for(const o of l){const r=await g.get(`/getRowPageResult/${o.id}`,{params:{day:t,smena:n}}),k=r.data.reduce((i,u)=>i+u.multiplied_parameter_count,0),C=r.data.reduce((i,u)=>i+u.kiritilgan,0),O=r.data.reduce((i,u)=>i+u.multiplied_formula_count,0),S=r.data.reduce((i,u)=>i+u.multiplied_manual_count,0),L=k-C;x.value+=O,b.value+=S;const d=v.value.find(i=>i.id===o.id);d&&(d.filled=C,d.notFilled=L,d.formula=O,d.manual=S);const M=k>0?C/k*100:0;f.push({name:m.value==="uz"?o.Name:o.NameRus,y:parseFloat(M.toFixed(2))})}}}let w=null;return P(async()=>{const e=localStorage.getItem("locale");e&&(m.value=e);try{const t=J.state.user.structure_id;if(Array.isArray(t)&&t.length===1){const s=t[0];p.push({name:"OperatorDetail",params:{id:s}})}else if(Array.isArray(t)&&t.length>1){const s=await g.get(`/structures/${t.join(",")}`);v.value=s.data.map(n=>({...n,filled:0,notFilled:0,formula:0,manual:0}))}else console.warn("structure_id bo'sh yoki noto'g'ri formatda")}catch(t){console.error("Error fetching data:",t)}await h(),w=setInterval(()=>{h()},6e5)}),D(()=>m.value==="uz"?"Русский":"O‘zbek"),U(()=>{w&&clearInterval(w)}),(e,t)=>(j(),I("div",Q,[a("div",W,[a("div",X,[a("div",Y,[(j(!0),I(G,null,K(v.value,(s,n)=>(j(),I("div",{onClick:l=>V(s.id),key:n,class:"relative p-4 border-2 bg-white shadow-lg border-slate-400 cursor-pointer"},[a("h5",tt,[t[0]||(t[0]=a("span",{class:"material-symbols-outlined w-1"}," factory ",-1)),a("span",{class:"block flex-grow leading-none w-5/6",innerHTML:B(s)},null,8,et)]),a("div",at,[a("div",st,[a("div",lt,[a("div",null,[F(N(R),{onClick:l=>$(s.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),F(N(R),{onClick:l=>z(s.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),F(N(R),{onClick:l=>A(s.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])]),a("div",null,[a("div",ot,[t[1]||(t[1]=a("span",{class:"text-green-600 material-symbols-outlined"},"edit",-1)),a("span",nt,_(s.filled),1),t[2]||(t[2]=a("span",{class:"material-symbols-outlined text-red-600"},"warning",-1)),a("span",rt,_(s.notFilled),1),t[3]||(t[3]=a("span",{class:"material-symbols-outlined text-blue-600"},"support_agent",-1)),a("span",it,_(s.manual),1),t[4]||(t[4]=a("span",{class:"material-symbols-outlined text-teal-600"},"function",-1)),a("span",ut,_(s.formula),1)])])])])])],8,Z))),128))])])])]))}};export{gt as default};

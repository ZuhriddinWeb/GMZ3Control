import{u as K,c as J,r as v,E as Y,f as y,g as Q,h as L,j as c,k as d,z as Z,l as M,i as I,t as q,n as D,K as ae,s as h,d as ee,L as te,a as le,o as oe,F as re,G as ue,V as ne,m as se,H as X}from"./app-DgyLyzDS.js";/* empty css                   */const de={class:"h-full w-full text-center content-center"},me={class:"va-h3"},ie={__name:"DeleteParam",props:["params"],setup(U){const{init:b}=K(),{t:s}=J(),x=v(!1),m=U,O=Y("ondeleted"),S=async()=>{try{const{data:V}=await D.delete(`/static/${m.params.data.id}`);V.status===200?(O(m.params.data),x.value=!1,b({message:s("login.successMessage"),color:"success"})):console.error("Error deleting data:",V.message)}catch(V){console.error("Error deleting data:",V)}};return(V,N)=>{const _=y("VaModal");return L(),Q("main",de,[c(d(Z),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:N[0]||(N[0]=G=>x.value=!0)}),c(_,{modelValue:x.value,"onUpdate:modelValue":N[1]||(N[1]=G=>x.value=G),"ok-text":d(s)("modals.apply"),"cancel-text":d(s)("modals.cancel"),onClose:N[2]||(N[2]=G=>x.value=!1),onOk:S,"close-button":""},{default:M(()=>[I("h3",me,q(d(s)("modals.title")),1),I("p",null,q(d(s)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ce={class:"h-full w-full text-center content-center"},pe={class:"flex gap-5 flex-wrap w-full mt-4"},fe={__name:"EditParam",props:["params"],setup(U){var B,j,T,A;const b=U,{t:s}=J(),{init:x}=K(),m=ae(),O=h(()=>{var e,t;const u=(t=(e=b==null?void 0:b.params)==null?void 0:e.data)==null?void 0:t.NumberPage;if(u!=null&&u!==""){const i=Number(u);return Number.isFinite(i)?i:null}const l=m.params.page??m.params.id,g=Number(l);return Number.isFinite(g)?g:null}),S=v(!1),V=Y("onupdated"),N=v([]),_=v([]),G=v([]),k=v([]),P=v([]),a=ee({id:((j=(B=b==null?void 0:b.params)==null?void 0:B.data)==null?void 0:j.id)??null,FactoryStructureID:null,ParameterID:null,NumberPage:O.value,GroupID:((A=(T=b==null?void 0:b.params)==null?void 0:T.data)==null?void 0:A.GroupID)??null,OrderNumber:"",Value:"",PeriodTypeId:"",PeriodStartDate:"",PeriodEndDate:"",Comment:""});function F(){S.value=!0,z()}const R=u=>{if(!u)return null;const l=new Date(u);return l.setMinutes(l.getMinutes()-l.getTimezoneOffset()),l.toISOString().split("T")[0]},r=u=>u===""||u===null||u===void 0?null:Number(u),$=u=>u==null?null:String(u);function C(u,l,g){if(l==null)return;(u.value||[]).some(t=>String(t.value)===String(l))||u.value.unshift({value:l,text:g||String(l)})}async function z(){var u,l;try{const g=((l=(u=b==null?void 0:b.params)==null?void 0:u.data)==null?void 0:l.id)??null,e=O.value,[t,i,f,p,w]=await Promise.all([D.get("/periodType"),g?D.get(`/static/${g}`):Promise.resolve({data:{}}),D.get("/structure"),D.get("/param"),D.get("/pages-select/22")]);N.value=(t.data||[]).map(n=>({value:r(n.id),text:n.name})),_.value=(f.data||[]).map(n=>({value:r(n.id),text:n.Name})),G.value=(p.data||[]).map(n=>({value:$(n.Uuid??n.id),text:n.Name})),k.value=(w.data||[]).map(n=>({value:r(n.NumberPage),text:n.Name}));const o=i.data||{};a.OrderNumber=o.OrderNumber??o.order_number??"",a.FactoryStructureID=r(o.FactoryStructureID??o.factory_structure_id),a.ParameterID=$(o.ParameterID??o.parameter_id),a.NumberPage=r(o.NumberPage??o.number_page??e),a.GroupID=o.GroupID!=null?r(o.GroupID):null,a.PeriodTypeId=o.period_type_id!=null?r(o.period_type_id):"",a.PeriodStartDate=o.period_start_date?new Date(o.period_start_date):null,a.PeriodEndDate=o.period_end_date?new Date(o.period_end_date):null,a.Comment=o.Comment??o.comment??"",await E(),C(_,a.FactoryStructureID,o.FSName),C(G,a.ParameterID,o.PName),C(k,a.NumberPage,o.PageName),C(P,a.GroupID,o.GName),C(N,a.PeriodTypeId,o.PTName),a.GroupID!=null&&!P.value.some(n=>Number(n.value)===Number(a.GroupID))&&P.value.unshift({value:Number(a.GroupID),text:o.GName||o.GNameRus||`Guruh #${a.GroupID} (old)`})}catch(g){console.error(g)}}async function W(){try{const{data:u}=await D.get("/pages-select/22");k.value=(u||[]).map(l=>({value:Number(l.NumberPage),text:l.Name}))}catch(u){console.error(u)}}async function E(){try{if(!a.NumberPage){P.value=[{value:null,text:"— Guruhsiz —"}],a.GroupID=null;return}const{data:u}=await D.get(`/getRowGroupWith/${a.NumberPage}`);P.value=[{value:null,text:"— Guruhsiz —"},...u.map(l=>({value:Number(l.id),text:l.Name}))],P.value.some(l=>l.value===a.GroupID)||(a.GroupID=null)}catch{P.value=[{value:null,text:"— Guruhsiz —"}],a.GroupID=null}}async function H(){var u,l;try{const g={id:a.id,FactoryStructureID:a.FactoryStructureID,ParameterID:a.ParameterID,NumberPage:a.NumberPage,GroupID:a.GroupID,OrderNumber:a.OrderNumber,Value:a.Value,PeriodTypeId:a.PeriodTypeId,PeriodStartDate:R(a.PeriodStartDate),PeriodEndDate:R(a.PeriodEndDate),Comment:a.Comment},e=await D.put("/static",g);if(e&&e.status>=200&&e.status<300){const t=((u=e.data)==null?void 0:u.unit)||((l=e.data)==null?void 0:l.item)||e.data;V==null||V(b.params.node,t),S.value=!1,x({message:s("login.successMessage"),color:"success"})}else x({message:s("validation.error"),color:"danger"})}catch(g){console.error(g),x({message:s("validation.error"),color:"danger"})}}return te(()=>a.NumberPage,E),(u,l)=>{const g=y("VaButton"),e=y("VaSelect"),t=y("VaInput"),i=y("VaDatePicker"),f=y("VaTextarea"),p=y("VaForm"),w=y("VaModal");return L(),Q("main",ce,[c(g,{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:F}),c(w,{modelValue:S.value,"onUpdate:modelValue":l[9]||(l[9]=o=>S.value=o),"ok-text":d(s)("modals.apply"),"cancel-text":d(s)("modals.cancel"),onOk:H,onClose:l[10]||(l[10]=o=>S.value=!1),"close-button":""},{default:M(()=>[I("h3",{class:"va-h3",onVnodeMounted:z},q(d(s)("modals.editFactory")),513),I("div",null,[c(p,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:M(()=>[c(e,{class:"w-full",modelValue:a.FactoryStructureID,"onUpdate:modelValue":[l[0]||(l[0]=o=>a.FactoryStructureID=o),W],options:_.value,"value-by":"value","text-by":"text",label:d(s)("menu.structure"),clearable:""},null,8,["modelValue","options","label"]),c(e,{class:"w-full",modelValue:a.ParameterID,"onUpdate:modelValue":l[1]||(l[1]=o=>a.ParameterID=o),options:G.value,"value-by":"value","text-by":"text",searchable:"",clearable:"",label:d(s)("menu.params")},null,8,["modelValue","options","label"]),c(e,{class:"w-full",modelValue:a.NumberPage,"onUpdate:modelValue":[l[2]||(l[2]=o=>a.NumberPage=o),E],options:k.value,"value-by":"value","text-by":"text",clearable:"",label:d(s)("table.page")},null,8,["modelValue","options","label"]),c(e,{class:"w-full",modelValue:a.GroupID,"onUpdate:modelValue":l[3]||(l[3]=o=>a.GroupID=o),options:P.value,"value-by":"value","text-by":"text",searchable:"",clearable:"",label:d(s)("menu.groups")},null,8,["modelValue","options","label"]),c(t,{class:"w-full",modelValue:a.OrderNumber,"onUpdate:modelValue":l[4]||(l[4]=o=>a.OrderNumber=o),label:d(s)("table.OrderNumber")},null,8,["modelValue","label"]),I("div",pe,[c(i,{modelValue:a.PeriodStartDate,"onUpdate:modelValue":l[5]||(l[5]=o=>a.PeriodStartDate=o),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),c(i,{modelValue:a.PeriodEndDate,"onUpdate:modelValue":l[6]||(l[6]=o=>a.PeriodEndDate=o),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),c(e,{modelValue:a.PeriodTypeId,"onUpdate:modelValue":l[7]||(l[7]=o=>a.PeriodTypeId=o),class:"mb-6 w-full",label:d(s)("menu.paramtypes"),options:N.value,"value-by":"value","text-by":"text",clearable:""},null,8,["modelValue","label","options"]),c(f,{class:"w-full",modelValue:a.Comment,"onUpdate:modelValue":l[8]||(l[8]=o=>a.Comment=o),"max-length":"125",label:d(s)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},be={class:"grid grid-rows-[55px,1fr]"},ge={class:"flex justify-between"},ve={class:"flex gap-5 flex-wrap w-full mt-4"},De={class:"flex-grow"},Pe={__name:"StaticParametrs",props:{id:{type:Number,required:!0},groupId:{type:[Number,String,null],default:null}},setup(U){const b=le(),s=U,{init:x}=K(),{t:m}=J(),O=v([]),S=v(null),V=v(!1),N=v([]);v([]);const _=v([]),G=v([]),k=v([]),P=v([]);v([]);const a=h(()=>b.state.user.roles[10]),F=e=>{var t,i;return((i=(t=a.value)==null?void 0:t.pivot)==null?void 0:i[e])==="1"};h(()=>Number(s.id));const R=h(()=>{if(s.groupId===null||s.groupId===void 0||s.groupId===""||s.groupId==="null")return null;const e=Number(s.groupId);return Number.isFinite(e)&&e!==0?e:null}),r=ee({FactoryStructureID:"",ParameterID:"",Value:"",NumberPage:s.id,GroupID:R.value,OrderNumber:"",PeriodTypeId:"",PeriodStartDate:null,PeriodEndDate:null,Comment:""}),$=h(()=>F("create")),C=h(()=>F("update")),z=h(()=>F("delete"));function W(e){S.value.applyTransaction({remove:[e]})}function E(e,t){e.setData(t)}X("ondeleted",W),X("onupdated",E);const H=h(()=>{const e=[{headerName:m("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:m("table.id"),field:"Uuid",hide:!0,flex:1},{headerName:m("table.name"),field:"PName",flex:1},{headerName:m("menu.paramtypes"),field:"PTName"},{headerName:m("menu.units"),field:"UName"},{headerName:m("table.OrderNumber"),field:"OrderNumber"},{headerName:m("table.startingDay"),field:"period_start_date"},{headerName:m("table.endingDay"),field:"period_end_date"},{headerName:m("table.comment"),field:"Comment",flex:1}];return C.value&&e.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:fe}),z.value&&e.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ie}),e}),B={sortable:!0,filter:!0};console.log(s);const j=e=>e==null||e===""||e==="null"||Number(e)===0,T=async()=>{const{data:e}=await D.get(`/staticCard/${s.id}`);let t=Array.isArray(e)?e:e.items||[];s.groupId===null||s.groupId===void 0?t=t.filter(f=>j(f.GroupID??f.group_id)):t=t.filter(f=>Number(f.GroupID??f.group_id)===Number(s.groupId));const i=f=>{const p=f.OrderNumber??f.order_number??f.order,w=Number(p);return Number.isFinite(w)?w:1/0};t.sort((f,p)=>{const w=i(f)-i(p);return w!==0?w:String(f.PName??f.Name??"").localeCompare(String(p.PName??p.Name??""),void 0,{numeric:!0})}),O.value=t},A=async()=>{try{const e=await D.get("/param"),t=await D.get("/periodType"),i=await D.get("/structure"),f=await D.get("/pages-svodka/22");_.value=e.data.map(p=>({value:p.Uuid,text:p.Name})),G.value=i.data.map(p=>({value:p.id,text:p.Name})),N.value=t.data.map(p=>({value:p.id,text:p.name})),k.value=f.data.map(p=>({value:p.NumberPage,text:p.Name})),r.NumberPage&&await u()}catch(e){console.error("Error fetching graphics data:",e)}},u=async()=>{try{const e=s.id||r.NumberPage;if(!e){P.value=[],r.GroupID=null;return}const{data:t}=await D.get(`/getRowGroupWith/${e}`);P.value=[{value:null,text:"— Guruhsiz —"},...t.map(i=>({value:i.id,text:i.Name}))],P.value.some(i=>i.value===r.GroupID)||(r.GroupID=null)}catch{P.value=[{value:null,text:"— Guruhsiz —"}],r.GroupID=null}},l=e=>{if(!e)return null;const t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().split("T")[0]},g=async()=>{try{const e={...r,PeriodStartDate:l(r.PeriodStartDate),PeriodEndDate:l(r.PeriodEndDate)},{data:t}=await D.post("/static",e);t.status===200?(V.value=!1,r.FactoryStructureID="",r.ParameterID="",r.Value="",r.Comment="",r.OrderNumber="",r.NumberPage="",r.PeriodTypeId="",r.PeriodStartDate=null,r.PeriodEndDate=null,await T(),x({message:m("login.successMessage"),color:"success"})):console.error("Error saving data:",t.message)}catch(e){console.error("Error saving data:",e)}};return oe(()=>{T(),r.NumberPage=s.id,u()}),te(()=>s.groupId,T),(e,t)=>{const i=y("VaSelect"),f=y("VaDatePicker"),p=y("VaTextarea"),w=y("VaModal"),o=y("ag-grid-vue");return L(),Q("div",be,[I("main",null,[I("div",ge,[t[10]||(t[10]=I("span",{class:"flex w-full"},null,-1)),$.value?(L(),re(d(Z),{key:0,onClick:t[0]||(t[0]=n=>V.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):ue("",!0)]),c(w,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=n=>V.value=n),"ok-text":d(m)("modals.apply"),"cancel-text":d(m)("modals.cancel"),onOk:g,"close-button":""},{default:M(()=>[I("h3",{class:"va-h3",onVnodeMounted:A},q(d(m)("modals.addParamsTitle")),513),I("div",null,[c(d(ne),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:M(()=>[c(i,{modelValue:r.FactoryStructureID,"onUpdate:modelValue":[t[1]||(t[1]=n=>r.FactoryStructureID=n),e.getPages],"value-by":"value",class:"mb-1 w-full",label:d(m)("menu.structure"),options:G.value,clearable:""},null,8,["modelValue","onUpdate:modelValue","label","options"]),c(i,{modelValue:r.ParameterID,"onUpdate:modelValue":t[2]||(t[2]=n=>r.ParameterID=n),"value-by":"value",class:"mb-1 w-full",label:d(m)("menu.params"),options:_.value,searchable:"",clearable:""},null,8,["modelValue","label","options"]),c(d(se),{class:"w-full",modelValue:r.OrderNumber,"onUpdate:modelValue":t[3]||(t[3]=n=>r.OrderNumber=n),rules:[n=>n&&n.length>0||d(m)("validation.required")],label:d(m)("table.OrderNumber")},null,8,["modelValue","rules","label"]),I("div",ve,[c(f,{modelValue:r.PeriodStartDate,"onUpdate:modelValue":t[4]||(t[4]=n=>r.PeriodStartDate=n),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),c(f,{modelValue:r.PeriodEndDate,"onUpdate:modelValue":t[5]||(t[5]=n=>r.PeriodEndDate=n),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),c(i,{modelValue:r.PeriodTypeId,"onUpdate:modelValue":t[6]||(t[6]=n=>r.PeriodTypeId=n),"value-by":"value",class:"mb-6 w-full",label:d(m)("menu.paramtypes"),options:N.value,clearable:""},null,8,["modelValue","label","options"]),c(p,{class:"w-full",modelValue:r.Comment,"onUpdate:modelValue":t[7]||(t[7]=n=>r.Comment=n),"max-length":"125",label:d(m)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),I("main",De,[c(o,{rowData:O.value,columnDefs:H.value,defaultColDef:B,animateRows:"true",class:"ag-theme-material h-full",onGridReady:t[9]||(t[9]=n=>S.value=n.api)},null,8,["rowData","columnDefs"])])])}}};export{Pe as default};

import{b as ce,c as me,r as o,d as F,x as $,I as ve,o as fe,J as he,f as c,g as j,h as ge,i as d,k as n,l as _,j as pe,K as Ve,L as Ce,m}from"./app-726a9268.js";/* empty css                   */import{_ as we}from"./EditValue-7fd1e581.js";import{f as be}from"./format-45c98358.js";const Ie={class:"grid grid-rows-[55px,1fr]"},xe={class:"flex justify-between"},ye=d("span",{class:"flex w-full"},null,-1),_e=d("h3",{class:"va-h3"}," Qiymatlarni kiritish ",-1),De={class:"grid grid-cols-1 md:grid-cols-1 gap-1 items-end w-full"},Ee=d("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ne={class:"flex flex-col"},Te={class:"m-2 flex"},ke="yyyy-MM-dd",Me=8*60,Se=19*60+59,Oe={__name:"ParametrGetValue",setup(Be){const q=ce(),{t:i,locale:z}=me(),f=o([]),v=o(null),D=o({}),k=o([]),x=o(new Date),C=o(null),w=o(null),M=o(null);o(null);const h=o(null),L=store.state.user.id,E=store.state.user.structure_id;o([]);const S=o([]),Q=o([]),A=o([]);o(0);const l=F({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",SourceID:"",BlogsID:E[0],userId:store.state.user.id}),r=F({id:"",Comment:"",Value:"",userId:store.state.user.id}),B=o([{headerName:i("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center"},{headerName:i("table.parameters"),field:$(()=>z.value==="ru"?"NameRus":"Name"),flex:1,headerClass:"header-center"},{headerName:i("table.interval"),headerClass:"header-center",children:[{headerName:i("table.min"),field:"Min",width:100,headerClass:"header-center"},{headerName:i("table.max"),field:"Max",width:100,headerClass:"header-center"}]},{headerName:i("table.value"),field:"Value",width:150,editable:!0,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===D.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==D.value[e.data.id]&&D.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:i("table.comment"),field:"Comment",flex:1,editable:!0,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),R=async()=>{try{const e=await m.get("/changes"),a=await m.get(`/paramWithId/${E}`);k.value=e.data.map(s=>({value:s.Change,text:s.Change})),S.value=a.data.map(s=>({value:s.Pid,text:s.PName}));const u=await m.get("/source");Q.value=u.data.map(s=>({value:s.id,text:s.Name}));const p=await m.get("/graphictimes");A.value=p.data.map(s=>({value:s.id,text:s.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},H={sortable:!0,filter:!0,resizable:!0},J=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",U={columnDefs:B.value,getRowClass:J,headerHeight:43},K=e=>{const{colDef:a,data:u}=e;a.field==="Value"&&u.Value&&W(e)},W=e=>{console.log(e),f.value={...e.data},M.value=e.node,r.id=f.value.id,r.Value=f.value.Value,r.Comment=f.value.Comment,w.value=!0},X=e=>{console.log("Updated Data:",e)},Y=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},P=()=>{const e=Y();return e>=Me&&e<=Se?1:2},Z=()=>{q.push("/vparams")};l.Change=P(),$(()=>P());const g=async()=>{l.Change,be(x.value,ke);try{const e=await m.get(`/vparamsGetValue/${store.state.user.structure_id}`);f.value=Array.isArray(e.data)?e.data:e.data.items}catch(e){console.error("Error fetching data:",e)}},ee=async e=>{const{data:a,colDef:u,newValue:p,oldValue:s}=e;if(p!==s)try{await ae(a);const V=e.rowIndex;v.value&&v.value.ensureIndexVisible(V,"bottom")}catch(V){console.error("Error saving data",V)}},ae=async e=>{try{const a=await m.post("/vparams",{...e,userId:L,structureID:E});return te(),g(),a}catch(a){console.error("Error saving data",a)}},te=()=>{v.value&&v.value.clearFocusedCell()},le=()=>{y.value&&v.value&&(v.value.stopEditing(),y.value=!1,g())};let b=null,I=null,y=o(!1);const oe=e=>{const{column:a}=e;if(a){const u=a.getColId();u==="Value"||u==="Comment"?(T(),y.value=!0,h.value&&clearTimeout(h.value),h.value=setTimeout(le,6e4)):N()}},se=e=>{const{column:a}=e;if(a){const u=a.getColId();(u==="Value"||u==="Comment")&&(T(),y.value=!1,h.value&&(clearTimeout(h.value),h.value=null))}},N=()=>{b||(b=setInterval(g,6e4)),I||(I=setInterval(R,6e4))},ne=async()=>{try{const{data:e}=await m.post("/vparams",{...l});e.status===200?(C.value=!1,l.ParametersID="",l.Name="",l.ShortName="",l.Comment="",l.Value="",l.BlogsID="",await g(),window.location.reload()):console.error("Error saving data:",e.message)}catch(e){console.error("Error saving data:",e)}},re=async e=>{try{const{data:a}=await m.post("/vparamsEdit",r);a.status===200?(C.value=!1,r.id="",r.Comment="",r.Value="",r.userId="",e.setData(a.updatedRowData),U.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},T=()=>{b&&(clearInterval(b),b=null),I&&(clearInterval(I),I=null)},ue=e=>{v.value=e.api,e.api.addEventListener("cellFocused",oe),e.api.addEventListener("cellBlurred",se),N()};return ve([()=>l.Change,()=>x.value],g),fe(()=>{g(),R(),N()}),he(()=>{T()}),(e,a)=>{const u=c("VaButton"),p=c("VaSelect"),s=c("VaInput"),V=c("VaTextarea"),G=c("VaForm"),O=c("VaModal"),de=c("VaDateInput"),ie=c("ag-grid-vue");return j(),ge("div",Ie,[d("main",null,[d("div",xe,[ye,n(u,{onClick:a[0]||(a[0]=t=>C.value=!0),class:"w-14 h-12 mt-3 mr-1",icon:"add"})]),n(O,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=t=>C.value=t),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:ne,"close-button":""},{default:_(()=>[_e,d("div",null,[n(G,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:_(()=>[d("div",De,[n(p,{modelValue:l.ParametersID,"onUpdate:modelValue":a[1]||(a[1]=t=>l.ParametersID=t),"value-by":"value",class:"mb-1",label:"Parametr turini tanlang",options:S.value,clearable:""},null,8,["modelValue","options"])]),n(s,{class:"w-full",modelValue:l.Value,"onUpdate:modelValue":a[2]||(a[2]=t=>l.Value=t),rules:[t=>t&&t.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),n(V,{class:"w-full",modelValue:l.Comment,"onUpdate:modelValue":a[3]||(a[3]=t=>l.Comment=t),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"]),n(O,{modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=t=>w.value=t),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[8]||(a[8]=t=>re(M.value)),"close-button":""},{default:_(()=>[Ee,d("div",null,[n(G,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:_(()=>[n(s,{class:"w-full",modelValue:r.Value,"onUpdate:modelValue":a[5]||(a[5]=t=>r.Value=t),rules:[t=>t&&t.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),n(V,{class:"w-full",modelValue:r.Comment,"onUpdate:modelValue":a[6]||(a[6]=t=>r.Comment=t),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),d("main",Ne,[d("div",Te,[n(de,{modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=t=>x.value=t),class:"mr-2",label:"Day"},null,8,["modelValue"]),n(p,{modelValue:l.Change,"onUpdate:modelValue":a[10]||(a[10]=t=>l.Change=t),"value-by":"value",label:pe(i)("menu.changes"),options:k.value,clearable:""},null,8,["modelValue","label","options"]),n(u,{onClick:Z,class:"btn btn-primary mt-3 ml-3",icon:"grade"})]),n(ie,{rowData:f.value,columnDefs:B.value,defaultColDef:H,gridOptions:U,animateRows:"true",class:"ag-theme-material h-full",onGridReady:ue,onCellValueChanged:ee,onCellDoubleClicked:K},null,8,["rowData","columnDefs"]),w.value?(j(),Ve(we,{key:0,showModalEdit:w.value,resultEdit:r,onUpdate:X},null,8,["showModalEdit","resultEdit"])):Ce("",!0)])])}}};export{Oe as default};

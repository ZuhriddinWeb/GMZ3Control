import{b as Ce,c as Ve,r as s,F as o,d as G,x as H,I as ye,o as xe,M as De,f as p,g as E,h as K,i as b,k as m,l as T,j as w,L as z,N as Ne,m as d,V as Ie,n as Ee,D as j,J as Te,K as Fe,O as _e,B as ke,t as Re}from"./app-95fb3b1c.js";/* empty css                   */import{_ as Se}from"./EditValue-cf03d4fd.js";import{f as M}from"./format-45c98358.js";const Me={class:"grid grid-rows-[55px,1fr]"},Pe=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ae={class:"flex flex-col"},Ue={class:"m-2 flex"},Be="yyyy-MM-dd",Le=8*60,Oe=19*60+59,ze={__name:"ParametrValue",setup($e){const W=Ce(),{t:n,locale:Q}=Ve(),P=s([]),u=s(null),F=s({}),A=s([]),_=s(new Date),J=s(null),x=s(null),X=s(null),U=s(null);s(null);const v=s(null),Y=o.state.user.id,Z=o.state.user.structure_id,f=s(null);s([]);const ee=s([]),D=s([]),ae=s([]),te=s([]);s(0);const N=G({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:o.state.user.structure_id,SourceID:"",userId:o.state.user.id}),c=G({id:"",Comment:"",Value:"",userId:o.state.user.id}),B=s([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:H(()=>Q.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:e=>(console.log("params.data:",e.data),e.data&&e.data.WithFormula!=="1"),suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=F.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,r;return e.data&&e.data.Value!==((a=F.value)==null?void 0:a[e.data.id])&&((r=F.value)==null?void 0:r[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),le=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?f.value>1?f.value-=1:f.value=D.value.length:f.value<D.value.length?f.value+=1:f.value=1)},se=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&u.navigateToNextCell({key:e.key}))},re=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&se(e)})};function ne(){const e=U.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const L=async()=>{try{const e=await d.get("/changes"),a=await d.get("/pages");D.value=a.data;const r=await d.get(`/paramWithId/${Z}`);A.value=e.data.map(l=>({value:l.Change,text:l.Change})),ee.value=r.data.map(l=>({value:l.Pid,text:l.PName}));const i=await d.get("/source");ae.value=i.data.map(l=>({value:l.id,text:l.Name}));const g=await d.get("/graphictimes");te.value=g.data.map(l=>({value:l.id,text:l.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},oe={sortable:!0,filter:!0,resizable:!0},ue=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",O={columnDefs:B.value,getRowClass:ue,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},ie=e=>{console.log("Updated Data:",e)},de=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},$=()=>{const e=de();return e>=Le&&e<=Oe?1:2},ce=()=>{W.push("/vparamsget")};N.Change=$(),H(()=>$());async function k(e){o.state.newValue=e;const a=N.Change,r=M(_.value,Be);new Date().getHours();try{d.all([d.get(`/get-params-for-user/${o.state.user.structure_id}/${a}/${r}/${e}`),d.get(`/vparams-value/${o.state.user.structure_id}/${r}`)]).then(d.spread(({data:i},{data:g})=>{i.forEach((h,y)=>{const t=g.find(q=>q.TimeID==h.GTid&&q.ParametersID==h.ParametersID);t&&(i[y]={...h,...t})});const l=g.map(h=>h.ParametersID);P.value=i}))}catch(i){console.error("Error fetching data:",i)}}const me=async e=>{const{data:a,colDef:r,newValue:i,oldValue:g}=e;if(i!==g)try{await fe(a);const l=e.rowIndex,h=u.value.getDisplayedRowCount();if(u.value&&u.value.ensureIndexVisible(l,"bottom"),l<h-1){u.value.stopEditing();const y=r.field==="Value"?"Value":"Comment";u.value.setFocusedCell(l+1,y)}}catch(l){console.error("Error saving data",l)}},fe=async e=>{try{const a=await d.post("/vparams",{...e,userId:Y});return he(),k(o.state.newValue),a}catch(a){console.error("Error saving data",a)}},he=()=>{u.value&&u.value.clearFocusedCell()},ge=()=>{I.value&&u.value&&(u.value.stopEditing(),I.value=!1)};let C=null,V=null,I=s(!1);const ve=e=>{const{column:a}=e;if(a){const r=a.getColId();r==="Value"||r==="Comment"?(S(),I.value=!0,v.value&&clearTimeout(v.value),v.value=setTimeout(ge,6e4)):R()}},pe=e=>{const{column:a}=e;if(a){const r=a.getColId();(r==="Value"||r==="Comment")&&(S(),I.value=!1,v.value&&(clearTimeout(v.value),v.value=null))}},R=()=>{C||(o.state.newValue=o.state.newValue||1,C=setInterval(()=>k(o.state.newValue),6e4)),V||(V=setInterval(L,6e4))},we=async e=>{try{const{data:a}=await d.post("/vparamsEdit",c);a.status===200?(J.value=!1,c.id="",c.Comment="",c.Value="",c.userId="",e.setData(a.updatedRowData),O.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},S=()=>{C&&(clearInterval(C),C=null),V&&(clearInterval(V),V=null)},be=e=>{u.value=e.api,e.api.addEventListener("cellFocused",ve),e.api.addEventListener("cellBlurred",pe),R()};return ye(f,e=>{k(e)}),xe(()=>{L(),R(),re()}),De(()=>{S()}),(e,a)=>{const r=p("VaTextarea"),i=p("VaModal"),g=p("VaDateInput"),l=p("VaSelect"),h=p("VaTab"),y=p("ag-grid-vue");return E(),K("div",Me,[b("main",null,[m(i,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=t=>x.value=t),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=t=>we(X.value)),"close-button":""},{default:T(()=>[Pe,b("div",null,[m(w(Ie),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:T(()=>[m(w(Ee),{class:"w-full",modelValue:c.Value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.Value=t),rules:[t=>t&&t.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),m(r,{class:"w-full",modelValue:c.Comment,"onUpdate:modelValue":a[1]||(a[1]=t=>c.Comment=t),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",Ae,[b("div",Ue,[m(g,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=t=>_.value=t),class:"mr-2",label:"Day"},null,8,["modelValue"]),m(l,{modelValue:N.Change,"onUpdate:modelValue":a[5]||(a[5]=t=>N.Change=t),"value-by":"value",label:w(n)("menu.changes"),options:A.value,clearable:""},null,8,["modelValue","label","options"]),m(w(j),{onClick:ne,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),m(w(j),{onClick:ce,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),b("div",{ref_key:"gridContainer",ref:U,class:"ag-grid-container h-full"},[m(w(_e),{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=t=>f.value=t),stateful:"",grow:"",onKeydown:le,tabindex:"0"},{tabs:T(()=>[(E(!0),K(Te,null,Fe(D.value,t=>(E(),z(h,{key:t.id,name:t.id},{default:T(()=>[ke(Re(t.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),m(y,{rowData:P.value,columnDefs:B.value,defaultColDef:oe,gridOptions:O,animateRows:"true",class:"ag-theme-material h-full",onGridReady:be,onCellValueChanged:me,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),x.value?(E(),z(Se,{key:0,showModalEdit:x.value,resultEdit:c,onUpdate:ie},null,8,["showModalEdit","resultEdit"])):Ne("",!0)])])}}};export{ze as default};

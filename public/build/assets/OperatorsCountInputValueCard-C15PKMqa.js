import{C as j,R as U,u as q,c as H,r as p,s as x,b as G,K as J,o as K,D as Z,n as w,S as Q,f as W,g as C,h as k,i as s,I as X,J as Y,j as f,l as ee,k as g,m as te,T as ae,U as le,G as se,z as F,t as v}from"./app-B7cg6xP4.js";/* empty css                   */import{V as oe}from"./VueShiftCalendar-BlCSmnhb.js";j.register(...U);const ne={class:"grid grid-rows-[55px,1fr] bg-stone-100"},re={class:"flex justify-between w-full mt-6 px-4"},ie={class:"flex flex-col w-full"},ue={class:"w-full"},de={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 my-6 shadow-sm border border-slate-200 mt-16 p-4"},me=["onClick"],ce={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},pe={class:"flex justify-between"},fe={class:"flex flex-col w-9/12"},ge={class:"mb-2 text-slate-800 font-semibold flex items-center p-2"},ve=["innerHTML"],ye={class:"p-2"},_e={class:"grid grid-cols-[min-content,auto] gap-x-2 gap-y-1 font-semibold m-2"},be={class:"text-green-600"},he={class:"text-red-600"},xe={class:"text-blue-600"},we={class:"text-teal-600"},Ce={class:"text-purple-600"},ke={class:"w-[200] mt-20 mr-2"},Se={__name:"OperatorsCountInputValueCard",setup(De){const{init:Ve}=q(),{locale:y,t:D}=H(),r=p({smena:null,day:null}),N=x(()=>route.query.type);let V=null;const _=G(),u=p([]);p(null);const I=p(null);function B(t){_.push({name:"OperatorDetail",params:{id:t}})}function z(t){I.value=t,b()}function A(t){_.push({name:"OperatorDetail",params:{id:t},query:{type:"inputed"}})}function M(t){_.push({name:"OperatorDetail",params:{id:t},query:{type:"not_inputed"}})}const $=x(()=>r.value.day?`${r.value.day} - ${r.value.smena}`:"");function E(t){const n=(y.value==="ru"?t.NameRus:t.Name).split(" "),e=[];for(let l=0;l<n.length;l+=3)e.push(n.slice(l,l+3).join(" "));return e.join("<br>")}J(r,async t=>{t.day&&t.smena&&(u.value.forEach(a=>{a.loading=!0}),await b())},{deep:!0}),x(()=>N.value==="inputed"?allData.value.filter(t=>t.Value!==null):N.value==="not_inputed"?allData.value.filter(t=>t.Value===null):allData.value);const T=p(0),R=p(0);async function b(){const t=r.value.day,a=r.value.smena;if(!(!t||!a)){if(T.value=0,R.value=0,I.value){const{data:n}=await w.get(`/getRowPageResult/${I.value}`,{params:{day:t,smena:a}}),e=n.reduce((l,o)=>(l.total+=o.multiplied_parameter_count,l.filled+=o.kiritilgan,l.formula+=o.multiplied_formula_count,l.manual+=o.multiplied_manual_count,l),{total:0,filled:0,formula:0,manual:0});T.value=e.formula,R.value=e.manual}else{const{data:n}=await w.get("/structure");for(const e of n){const l=await w.get(`/getRowPageResult/${e.id}`,{params:{day:t,smena:a}}),o=l.data.reduce((i,m)=>i+m.multiplied_parameter_count,0),c=l.data.reduce((i,m)=>i+m.kiritilgan,0),h=l.data.reduce((i,m)=>i+m.multiplied_formula_count,0),O=l.data.reduce((i,m)=>i+m.multiplied_manual_count,0),P=o-c;T.value+=h,R.value+=O;const d=u.value.find(i=>i.id===e.id);d&&(d.loading=!0,d.filled=c,d.notFilled=P,d.formula=h,d.manual=O,d.loading=!1)}}await ae(),L()}}function L(){const t=document.getElementById("barChart");if(!t)return;V&&V.destroy();const a=u.value.map(l=>y.value==="ru"?l.NameRus:l.Name),n=u.value.map(l=>l.filled),e=u.value.map(l=>l.notFilled);V=new j(t,{type:"bar",data:{labels:a,datasets:[{label:D("To‘ldirilgan"),data:n,backgroundColor:"rgba(34,197,94,0.6)"},{label:D("To‘ldirilmagan"),data:e,backgroundColor:"rgba(239,68,68,0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:D("Bo‘limlar bo‘yicha parametrlar holati")},legend:{position:"top"}},scales:{x:{ticks:{autoSkip:!1,maxRotation:90,minRotation:45}},y:{beginAtZero:!0}}}})}let S=null;return K(async()=>{document.body.style.transform="scale(0.9)",document.body.style.transformOrigin="top left",document.body.style.width="111.11%";const t=localStorage.getItem("locale");t&&(y.value=t);const a=new Date,n=a.getHours(),e=a.toISOString().split("T")[0],l=n>=8&&n<20?1:2;(!r.value.day||!r.value.smena)&&(r.value={day:e,smena:l});try{const o=Z.state.user.structure_id;if(Array.isArray(o)&&o.length===1){const c=o[0];_.push({name:"OperatorDetail",params:{id:c}})}else if(Array.isArray(o)&&o.length>1){const c=await w.get(`/structures/${o.join(",")}`);u.value=c.data.map(h=>({...h,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(o){console.error("Error fetching data:",o)}await b(),S=setInterval(()=>{b()},6e5)}),x(()=>y.value==="uz"?"Русский":"O‘zbek"),Q(()=>{S&&clearInterval(S)}),(t,a)=>{const n=W("VaProgressCircle");return k(),C("div",ne,[s("div",re,[s("div",ie,[s("div",ue,[s("div",de,[(k(!0),C(X,null,Y(u.value,(e,l)=>(k(),C("div",{onClick:o=>z(e.id),key:l,class:le(["relative p-1 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(k(),C("div",ce,[f(n,{indeterminate:"",size:"medium"})])):se("",!0),s("div",pe,[s("div",fe,[s("div",null,[s("h5",ge,[s("span",{class:"block flex-grow leading-none",innerHTML:E(e)},null,8,ve)])]),s("div",null,[s("div",ye,[f(g(F),{onClick:o=>B(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),f(g(F),{onClick:o=>A(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),f(g(F),{onClick:o=>M(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])])])]),s("div",_e,[a[2]||(a[2]=s("span",{class:"text-green-600 material-symbols-outlined text-lg mr-3"},"edit",-1)),s("span",be,v(e.filled),1),a[3]||(a[3]=s("span",{class:"text-red-600 material-symbols-outlined text-lg mr-3"},"warning",-1)),s("span",he,v(e.notFilled),1),a[4]||(a[4]=s("span",{class:"text-blue-600 material-symbols-outlined text-lg mr-3"},"support_agent",-1)),s("span",xe,v(e.manual),1),a[5]||(a[5]=s("span",{class:"text-teal-600 material-symbols-outlined text-lg mr-3"},"function",-1)),s("span",we,v(e.formula),1),a[6]||(a[6]=s("span",{class:"text-purple-600 material-symbols-outlined text-lg mr-3"},"%",-1)),s("span",Ce,v(e.filled+e.notFilled>0?Math.round(e.filled/(e.filled+e.notFilled)*100):0),1)])])],10,me))),128))])]),a[7]||(a[7]=s("div",{class:"p-6 bg-white border border-slate-200 shadow-lg mt-2 mx-3 rounded-lg"},[s("div",{style:{height:"300px"}},[s("canvas",{id:"barChart"})])],-1))]),s("div",ke,[f(g(oe),{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),class:"w-full mr-2 shadow-lg"},{default:ee(()=>[f(g(te),{modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])])])])}}};export{Se as default};

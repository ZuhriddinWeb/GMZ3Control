import{u as H,c as K,r as V,E as X,f as P,g as J,h as z,j as m,k as s,z as Y,l as $,i as y,t as A,n as N,K as ae,s as U,d as Z,a as te,o as le,L as oe,F as re,G as ne,V as se,m as ue,H as Q}from"./app-DyjZBxuG.js";/* empty css                   */const de={class:"h-full w-full text-center content-center"},me={class:"va-h3"},ie={__name:"DeleteParam",props:["params"],setup(R){const{init:u}=H(),{t:d}=K(),x=V(!1),r=R,h=X("ondeleted"),I=async()=>{try{const{data:v}=await N.delete(`/static/${r.params.data.id}`);v.status===200?(h(r.params.data),x.value=!1,u({message:d("login.successMessage"),color:"success"})):console.error("Error deleting data:",v.message)}catch(v){console.error("Error deleting data:",v)}};return(v,w)=>{const S=P("VaModal");return z(),J("main",de,[m(s(Y),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:w[0]||(w[0]=t=>x.value=!0)}),m(S,{modelValue:x.value,"onUpdate:modelValue":w[1]||(w[1]=t=>x.value=t),"ok-text":s(d)("modals.apply"),"cancel-text":s(d)("modals.cancel"),onClose:w[2]||(w[2]=t=>x.value=!1),onOk:I,"close-button":""},{default:$(()=>[y("h3",me,A(s(d)("modals.title")),1),y("p",null,A(s(d)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ce={class:"h-full w-full text-center content-center"},pe={class:"flex gap-5 flex-wrap w-full mt-4"},fe={__name:"EditParam",props:["params"],setup(R){var T,F,B,q;const u=R,{t:d}=K(),{init:x}=H(),r=ae(),h=U(()=>{var p,g;const c=(g=(p=u==null?void 0:u.params)==null?void 0:p.data)==null?void 0:g.NumberPage;if(c!=null&&c!==""){const _=Number(c);return Number.isFinite(_)?_:null}const o=r.params.page??r.params.id,D=Number(o);return Number.isFinite(D)?D:null});console.log("numberPage =",h.value);const I=V(!1),v=X("onupdated"),w=V([]),S=V([]),t=Z({id:((F=(T=u==null?void 0:u.params)==null?void 0:T.data)==null?void 0:F.id)??null,Value:"",OrderNumber:"",GroupID:((q=(B=u==null?void 0:u.params)==null?void 0:B.data)==null?void 0:q.GroupID)??null,PeriodTypeId:"",PeriodStartDate:"",PeriodEndDate:"",Comment:"",NumberPage:h.value});function L(){I.value=!0,l()}const C=c=>{if(!c)return null;const o=new Date(c);return o.setMinutes(o.getMinutes()-o.getTimezoneOffset()),o.toISOString().split("T")[0]};async function l(){var c,o,D,p,g,_;try{const G=((o=(c=u==null?void 0:u.params)==null?void 0:c.data)==null?void 0:o.id)??null,O=h.value,M=N.get("/periodType"),e=G?N.get(`/static/${G}`):Promise.resolve({data:{}}),a=O?N.get(`/getRowGroupWith/${O}`):Promise.resolve({data:[]}),[f,E,b]=await Promise.all([M,e,a]);w.value=(f.data||[]).map(k=>({value:Number(k.id),text:k.name}));const i=E.data||{},j=i.GroupID??i.group_id??i.groupId??((p=(D=u==null?void 0:u.params)==null?void 0:D.data)==null?void 0:p.GroupID)??null,n=i.OrderNumber??i.order_number??i.order??((_=(g=u==null?void 0:u.params)==null?void 0:g.data)==null?void 0:_.OrderNumber)??"";t.Value=i.value??"",t.OrderNumber=n??"",t.GroupID=j!=null?Number(j):null,t.PeriodTypeId=i.period_type_id!=null?Number(i.period_type_id):"",t.PeriodStartDate=i.period_start_date?new Date(i.period_start_date):null,t.PeriodEndDate=i.period_end_date?new Date(i.period_end_date):null,t.Comment=i.Comment??i.comment??"",t.NumberPage=O;const ee=b.data||[];if(S.value=ee.map(k=>({value:Number(k.id),text:k.Name})),t.GroupID!=null&&!S.value.some(k=>k.value===Number(t.GroupID))){const k=i.GroupName??i.group_name??`Guruh #${t.GroupID}`;S.value.unshift({value:Number(t.GroupID),text:`${k} (old)`})}}catch(G){console.error(G)}}async function W(){var c,o;try{const D={id:t.id,Value:t.Value,OrderNumber:t.OrderNumber,GroupID:t.GroupID,PeriodTypeId:t.PeriodTypeId,PeriodStartDate:C(t.PeriodStartDate),PeriodEndDate:C(t.PeriodEndDate),Comment:t.Comment,NumberPage:h.value},p=await N.put("/static",D);if(p&&p.status>=200&&p.status<300){const g=((c=p.data)==null?void 0:c.unit)||((o=p.data)==null?void 0:o.item)||p.data;v==null||v(u.params.node,g),I.value=!1,x({message:d("login.successMessage"),color:"success"})}else x({message:d("validation.error"),color:"danger"})}catch(D){console.error(D),x({message:d("validation.error"),color:"danger"})}}return(c,o)=>{const D=P("VaButton"),p=P("VaInput"),g=P("VaSelect"),_=P("VaDatePicker"),G=P("VaTextarea"),O=P("VaForm"),M=P("VaModal");return z(),J("main",ce,[m(D,{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:L}),m(M,{modelValue:I.value,"onUpdate:modelValue":o[6]||(o[6]=e=>I.value=e),"ok-text":s(d)("modals.apply"),"cancel-text":s(d)("modals.cancel"),onOk:W,onClose:o[7]||(o[7]=e=>I.value=!1),"close-button":""},{default:$(()=>[y("h3",{class:"va-h3",onVnodeMounted:l},A(s(d)("modals.editFactory")),513),y("div",null,[m(O,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:$(()=>[m(p,{class:"w-full",modelValue:t.OrderNumber,"onUpdate:modelValue":o[0]||(o[0]=e=>t.OrderNumber=e),label:s(d)("table.OrderNumber")},null,8,["modelValue","label"]),m(g,{class:"w-full",modelValue:t.GroupID,"onUpdate:modelValue":o[1]||(o[1]=e=>t.GroupID=e),options:S.value,"value-by":"value","text-by":"text","track-by":"value",label:s(d)("menu.groups"),searchable:"",clearable:""},null,8,["modelValue","options","label"]),y("div",pe,[m(_,{modelValue:t.PeriodStartDate,"onUpdate:modelValue":o[2]||(o[2]=e=>t.PeriodStartDate=e),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),m(_,{modelValue:t.PeriodEndDate,"onUpdate:modelValue":o[3]||(o[3]=e=>t.PeriodEndDate=e),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),m(g,{modelValue:t.PeriodTypeId,"onUpdate:modelValue":o[4]||(o[4]=e=>t.PeriodTypeId=e),class:"mb-6 w-full",label:s(d)("menu.paramtypes"),options:w.value,"value-by":"value",clearable:""},null,8,["modelValue","label","options"]),m(G,{class:"w-full",modelValue:t.Comment,"onUpdate:modelValue":o[5]||(o[5]=e=>t.Comment=e),"max-length":"125",label:s(d)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},be={class:"grid grid-rows-[55px,1fr]"},ve={class:"flex justify-between"},ge={class:"flex gap-5 flex-wrap w-full mt-4"},Ve={class:"flex-grow"},we={__name:"StaticParametrs",props:{id:Number},setup(R){const u=te(),d=R,{init:x}=H(),{t:r}=K(),h=V([]),I=V(null),v=V(!1),w=V([]);V([]);const S=V([]),t=V([]),L=V([]),C=V([]);V([]);const l=Z({FactoryStructureID:"",ParameterID:"",Value:"",NumberPage:d.id,GroupID:"",OrderNumber:"",PeriodTypeId:"",PeriodStartDate:null,PeriodEndDate:null,Comment:""}),W=U(()=>u.state.user.roles[10]),T=e=>{var a,f;return((f=(a=W.value)==null?void 0:a.pivot)==null?void 0:f[e])==="1"},F=U(()=>T("create")),B=U(()=>T("update")),q=U(()=>T("delete"));function c(e){I.value.applyTransaction({remove:[e]})}function o(e,a){e.setData(a)}Q("ondeleted",c),Q("onupdated",o);const D=U(()=>{const e=[{headerName:r("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:r("table.id"),field:"Uuid",hide:!0,flex:1},{headerName:r("table.name"),field:"PName",flex:1},{headerName:r("menu.paramtypes"),field:"PTName"},{headerName:r("menu.units"),field:"UName"},{headerName:r("table.value"),field:"value"},{headerName:r("table.startingDay"),field:"period_start_date"},{headerName:r("table.endingDay"),field:"period_end_date"},{headerName:r("table.comment"),field:"Comment",flex:1}];return B.value&&e.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:fe}),q.value&&e.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ie}),e}),p={sortable:!0,filter:!0};console.log(d.id);const g=async()=>{const{data:e}=await N.get(`/staticCard/${d.id}`);h.value=Array.isArray(e)?e:e.items},_=async()=>{try{const e=await N.get("/param"),a=await N.get("/periodType"),f=await N.get("/structure"),E=await N.get("/pages-svodka/22");S.value=e.data.map(b=>({value:b.Uuid,text:b.Name})),t.value=f.data.map(b=>({value:b.id,text:b.Name})),w.value=a.data.map(b=>({value:b.id,text:b.name})),L.value=E.data.map(b=>({value:b.NumberPage,text:b.Name})),l.NumberPage&&await G()}catch(e){console.error("Error fetching graphics data:",e)}},G=async()=>{try{const e=d.id||l.NumberPage;if(!e){C.value=[],l.GroupID=null;return}const{data:a}=await N.get(`/getRowGroupWith/${e}`);C.value=a.map(f=>({value:f.id,text:f.Name})),C.value.some(f=>f.value===l.GroupID)||(l.GroupID=null)}catch(e){C.value=[],l.GroupID=null,console.error("Error fetching groups:",e)}},O=e=>{if(!e)return null;const a=new Date(e);return a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a.toISOString().split("T")[0]},M=async()=>{try{const e={...l,PeriodStartDate:O(l.PeriodStartDate),PeriodEndDate:O(l.PeriodEndDate)},{data:a}=await N.post("/static",e);a.status===200?(v.value=!1,l.FactoryStructureID="",l.ParameterID="",l.Value="",l.Comment="",l.OrderNumber="",l.NumberPage="",l.PeriodTypeId="",l.PeriodStartDate=null,l.PeriodEndDate=null,await g(),x({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(e){console.error("Error saving data:",e)}};return le(()=>{g(),l.NumberPage=d.id,G()}),oe(()=>d.id,g),(e,a)=>{const f=P("VaSelect"),E=P("VaDatePicker"),b=P("VaTextarea"),i=P("VaModal"),j=P("ag-grid-vue");return z(),J("div",be,[y("main",null,[y("div",ve,[a[11]||(a[11]=y("span",{class:"flex w-full"},null,-1)),F.value?(z(),re(s(Y),{key:0,onClick:a[0]||(a[0]=n=>v.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):ne("",!0)]),m(i,{modelValue:v.value,"onUpdate:modelValue":a[9]||(a[9]=n=>v.value=n),"ok-text":s(r)("modals.apply"),"cancel-text":s(r)("modals.cancel"),onOk:M,"close-button":""},{default:$(()=>[y("h3",{class:"va-h3",onVnodeMounted:_},A(s(r)("modals.addParamsTitle")),513),y("div",null,[m(s(se),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:$(()=>[m(f,{modelValue:l.FactoryStructureID,"onUpdate:modelValue":[a[1]||(a[1]=n=>l.FactoryStructureID=n),e.getPages],"value-by":"value",class:"mb-1 w-full",label:s(r)("menu.structure"),options:t.value,clearable:""},null,8,["modelValue","onUpdate:modelValue","label","options"]),m(f,{modelValue:l.ParameterID,"onUpdate:modelValue":a[2]||(a[2]=n=>l.ParameterID=n),"value-by":"value",class:"mb-1 w-full",label:s(r)("menu.params"),options:S.value,searchable:"",clearable:""},null,8,["modelValue","label","options"]),m(f,{modelValue:l.GroupID,"onUpdate:modelValue":a[3]||(a[3]=n=>l.GroupID=n),"value-by":"value",class:"mb-1 w-full",label:s(r)("menu.groups"),options:C.value,searchable:""},null,8,["modelValue","label","options"]),m(s(ue),{class:"w-full",modelValue:l.OrderNumber,"onUpdate:modelValue":a[4]||(a[4]=n=>l.OrderNumber=n),rules:[n=>n&&n.length>0||s(r)("validation.required")],label:s(r)("table.OrderNumber")},null,8,["modelValue","rules","label"]),y("div",ge,[m(E,{modelValue:l.PeriodStartDate,"onUpdate:modelValue":a[5]||(a[5]=n=>l.PeriodStartDate=n),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),m(E,{modelValue:l.PeriodEndDate,"onUpdate:modelValue":a[6]||(a[6]=n=>l.PeriodEndDate=n),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),m(f,{modelValue:l.PeriodTypeId,"onUpdate:modelValue":a[7]||(a[7]=n=>l.PeriodTypeId=n),"value-by":"value",class:"mb-6 w-full",label:s(r)("menu.paramtypes"),options:w.value,clearable:""},null,8,["modelValue","label","options"]),m(b,{class:"w-full",modelValue:l.Comment,"onUpdate:modelValue":a[8]||(a[8]=n=>l.Comment=n),"max-length":"125",label:s(r)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),y("main",Ve,[m(j,{rowData:h.value,columnDefs:D.value,defaultColDef:p,animateRows:"true",class:"ag-theme-material h-full",onGridReady:a[10]||(a[10]=n=>I.value=n.api)},null,8,["rowData","columnDefs"])])])}}};export{we as default};

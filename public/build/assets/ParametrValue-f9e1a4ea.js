import{b as he,c as pe,r as s,F as u,d as H,x as z,I as be,o as Ce,J as Ve,f as h,g as D,h as L,i as b,k as m,l as E,j as p,K as j,L as we,m as i,V as xe,n as Ne,D as K,M as Ie,N as De,O as Ee,B as ye,t as _e}from"./app-d9ae6f7d.js";/* empty css                   */import{_ as Te}from"./EditValue-f116b4e5.js";import{f as k}from"./format-45c98358.js";const Fe={class:"grid grid-rows-[55px,1fr]"},Re=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),ke={class:"flex flex-col"},Se={class:"m-2 flex"},Me="yyyy-MM-dd",Pe=8*60,Be=19*60+59,He={__name:"ParametrValue",setup(Oe){const Q=he(),{t:n,locale:A}=pe(),S=s([]),d=s(null),y=s({}),M=s([]),_=s(new Date),J=s(null),x=s(null),W=s(null),P=s(null);s(null);const g=s(null),X=u.state.user.id,Y=u.state.user.structure_id,T=s(null);s([]);const Z=s([]),B=s([]),ee=s([]),ae=s([]);s(0);const N=H({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:u.state.user.structure_id,SourceID:"",userId:u.state.user.id}),c=H({id:"",Comment:"",Value:"",userId:u.state.user.id}),O=s([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:z(()=>A.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>k(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>k(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:!0,suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===y.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==y.value[e.data.id]&&y.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]);function te(){const e=P.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const $=async()=>{try{const e=await i.get("/changes"),a=await i.get("/pages");B.value=a.data;const r=await i.get(`/paramWithId/${Y}`);M.value=e.data.map(t=>({value:t.Change,text:t.Change})),Z.value=r.data.map(t=>({value:t.Pid,text:t.PName}));const o=await i.get("/source");ee.value=o.data.map(t=>({value:t.id,text:t.Name}));const f=await i.get("/graphictimes");ae.value=f.data.map(t=>({value:t.id,text:t.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},le={sortable:!0,filter:!0,resizable:!0},se=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",q={columnDefs:O.value,getRowClass:se,headerHeight:27,rowHeight:30},re=e=>{console.log("Updated Data:",e)},ne=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},U=()=>{const e=ne();return e>=Pe&&e<=Be?1:2},oe=()=>{Q.push("/vparamsget")};N.Change=U(),z(()=>U());async function G(e){u.state.newValue=e;const a=N.Change,r=k(_.value,Me);new Date().getHours();try{i.all([i.get(`/get-params-for-user/${u.state.user.structure_id}/${a}/${r}/${e}`),i.get(`/vparams-value/${u.state.user.structure_id}/${r}`)]).then(i.spread(({data:o},{data:f})=>{o.forEach((t,w)=>{const v=f.find(l=>l.TimeID==t.GTid&&l.ParametersID==t.ParametersID);v&&(o[w]={...t,...v})}),S.value=o}))}catch(o){console.error("Error fetching data:",o)}}const ue=async e=>{const{data:a,colDef:r,newValue:o,oldValue:f}=e;if(o!==f)try{await ie(a);const t=e.rowIndex,w=d.value.getDisplayedRowCount();if(d.value&&d.value.ensureIndexVisible(t,"bottom"),t<w-1){d.value.stopEditing();const v=r.field==="Value"?"Value":"Comment";d.value.setFocusedCell(t+1,v)}}catch(t){console.error("Error saving data",t)}},ie=async e=>{console.log(e);try{const a=await i.post("/vparams",{...e,userId:X});return de(),a}catch(a){console.error("Error saving data",a)}},de=()=>{d.value&&d.value.clearFocusedCell()},ce=()=>{I.value&&d.value&&(d.value.stopEditing(),I.value=!1)};let C=null,V=null,I=s(!1);const me=e=>{const{column:a}=e;if(a){const r=a.getColId();r==="Value"||r==="Comment"?(R(),I.value=!0,g.value&&clearTimeout(g.value),g.value=setTimeout(ce,6e4)):F()}},fe=e=>{const{column:a}=e;if(a){const r=a.getColId();(r==="Value"||r==="Comment")&&(R(),I.value=!1,g.value&&(clearTimeout(g.value),g.value=null))}},F=()=>{C||(u.state.newValue=u.state.newValue||1,C=setInterval(()=>G(u.state.newValue),6e4)),V||(V=setInterval($,6e4))},ge=async e=>{try{const{data:a}=await i.post("/vparamsEdit",c);a.status===200?(J.value=!1,c.id="",c.Comment="",c.Value="",c.userId="",e.setData(a.updatedRowData),q.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},R=()=>{C&&(clearInterval(C),C=null),V&&(clearInterval(V),V=null)},ve=e=>{d.value=e.api,e.api.addEventListener("cellFocused",me),e.api.addEventListener("cellBlurred",fe),F()};return be(T,e=>{G(e)}),Ce(()=>{$(),F()}),Ve(()=>{R()}),(e,a)=>{const r=h("VaTextarea"),o=h("VaModal"),f=h("VaDateInput"),t=h("VaSelect"),w=h("VaTab"),v=h("ag-grid-vue");return D(),L("div",Fe,[b("main",null,[m(o,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=l=>x.value=l),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=l=>ge(W.value)),"close-button":""},{default:E(()=>[Re,b("div",null,[m(p(xe),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:E(()=>[m(p(Ne),{class:"w-full",modelValue:c.Value,"onUpdate:modelValue":a[0]||(a[0]=l=>c.Value=l),rules:[l=>l&&l.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),m(r,{class:"w-full",modelValue:c.Comment,"onUpdate:modelValue":a[1]||(a[1]=l=>c.Comment=l),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",ke,[b("div",Se,[m(f,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=l=>_.value=l),class:"mr-2",label:"Day"},null,8,["modelValue"]),m(t,{modelValue:N.Change,"onUpdate:modelValue":a[5]||(a[5]=l=>N.Change=l),"value-by":"value",label:p(n)("menu.changes"),options:M.value,clearable:""},null,8,["modelValue","label","options"]),m(p(K),{onClick:te,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),m(p(K),{onClick:oe,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),b("div",{ref_key:"gridContainer",ref:P,class:"ag-grid-container h-full"},[m(p(Ee),{modelValue:T.value,"onUpdate:modelValue":a[6]||(a[6]=l=>T.value=l),stateful:"",grow:""},{tabs:E(()=>[(D(!0),L(Ie,null,De(B.value,l=>(D(),j(w,{key:l.id,name:l.id},{default:E(()=>[ye(_e(l.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),m(v,{rowData:S.value,columnDefs:O.value,defaultColDef:le,gridOptions:q,animateRows:"true",class:"ag-theme-material h-full",onGridReady:ve,onCellValueChanged:ue,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),x.value?(D(),j(Te,{key:0,showModalEdit:x.value,resultEdit:c,onUpdate:re},null,8,["showModalEdit","resultEdit"])):we("",!0)])])}}};export{He as default};

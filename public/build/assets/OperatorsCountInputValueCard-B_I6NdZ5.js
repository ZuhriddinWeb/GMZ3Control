import{C as O,ac as G,u as J,c as Z,r as p,s as _,b as Q,K as W,o as X,D as Y,n as w,ad as ee,f as te,g as C,h as k,i as l,I as ae,J as le,ab as se,G as ne,j as f,k as g,z as j,t as v,ae as oe,l as ie,m as re,O as ue}from"./app-c0G7Ml5G.js";/* empty css                   */import{V as de}from"./VueShiftCalendar-BcMWTttv.js";O.register(...G);const ce={class:"grid grid-rows-[55px,1fr] bg-stone-100"},me={class:"flex justify-between w-full mt-6 px-4"},pe={class:"flex flex-col w-full"},fe={class:"w-full"},ge={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-1 my-6 shadow-sm border border-slate-200 mt-16 p-4"},ve=["onClick"],ye={key:0,class:"absolute inset-0 flex justify-center items-center bg-white/80 z-10 rounded"},be={class:"flex justify-between"},he={class:"flex flex-col w-9/12"},xe={class:"mb-2 text-slate-800 font-semibold flex items-center p-2"},_e=["innerHTML"],we={class:"p-2"},Ce={class:"grid grid-cols-[min-content,auto] gap-x-2 gap-y-1 font-semibold m-2"},ke={class:"text-green-600"},Ie={class:"text-red-600"},Ve={class:"text-blue-600"},De={class:"text-teal-600"},Ne={class:"text-purple-600"},Se={class:"flex flex-col justify-between"},Te={class:"w-[200] mt-20 mr-2"},Be={__name:"OperatorsCountInputValueCard",setup(Fe){const{init:Re}=J(),{locale:y,t:I}=Z(),i=p({smena:null,day:null}),$=_(()=>route.query.type);let V=null,D=null;const b=Q(),d=p([]);p(null);const N=p(null);function E(a){b.push({name:"OperatorDetail",params:{id:a}})}function M(a){N.value=a,h()}function P(a){b.push({name:"OperatorDetail",params:{id:a},query:{type:"inputed"}})}function L(a){b.push({name:"OperatorDetail",params:{id:a},query:{type:"not_inputed"}})}const B=_(()=>i.value.day?`${i.value.day} - ${i.value.smena}`:"");function U(a){const o=(y.value==="ru"?a.NameRus:a.Name).split(" "),e=[];for(let s=0;s<o.length;s+=3)e.push(o.slice(s,s+3).join(" "));return e.join("<br>")}W(i,async a=>{a.day&&a.smena&&(d.value.forEach(t=>{t.loading=!0}),await h())},{deep:!0}),_(()=>$.value==="inputed"?allData.value.filter(a=>a.Value!==null):$.value==="not_inputed"?allData.value.filter(a=>a.Value===null):allData.value);const S=p(0),T=p(0);async function h(){const a=i.value.day,t=i.value.smena;if(!(!a||!t)){if(S.value=0,T.value=0,N.value){const{data:o}=await w.get(`/getRowPageResult/${N.value}`,{params:{day:a,smena:t}}),e=o.reduce((s,n)=>(s.total+=n.multiplied_parameter_count,s.filled+=n.kiritilgan,s.formula+=n.multiplied_formula_count,s.manual+=n.multiplied_manual_count,s),{total:0,filled:0,formula:0,manual:0});S.value=e.formula,T.value=e.manual}else{let o=0,e=0;const{data:s}=await w.get("/structure");for(const n of s){const u=await w.get(`/getRowPageResult/${n.id}`,{params:{day:a,smena:t}}),x=u.data.reduce((r,m)=>r+m.multiplied_parameter_count,0),R=u.data.reduce((r,m)=>r+m.kiritilgan,0),z=u.data.reduce((r,m)=>r+m.multiplied_formula_count,0),A=u.data.reduce((r,m)=>r+m.multiplied_manual_count,0),K=x-R;o+=x,e+=R,S.value+=z,T.value+=A;const c=d.value.find(r=>r.id===n.id);c&&(c.loading=!0,c.filled=R,c.notFilled=K,c.formula=z,c.manual=A,c.loading=!1)}H(e,o)}await ue(),q()}}function q(){const a=document.getElementById("barChart");if(!a)return;V&&V.destroy();const t=d.value.map(s=>y.value==="ru"?s.NameRus:s.Name),o=d.value.map(s=>s.filled),e=d.value.map(s=>s.notFilled);V=new O(a,{type:"bar",data:{labels:t,datasets:[{label:I("To‘ldirilgan"),data:o,backgroundColor:"rgba(34,197,94,0.6)"},{label:I("To‘ldirilmagan"),data:e,backgroundColor:"rgba(239,68,68,0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:I("Bo‘limlar bo‘yicha parametrlar holati")},legend:{position:"top"}},scales:{x:{ticks:{autoSkip:!1,maxRotation:90,minRotation:45}},y:{beginAtZero:!0}}}})}function H(a,t){const o=document.getElementById("pieChart");o&&(D&&D.destroy(),D=new O(o,{type:"pie",data:{labels:["Kiritilgan","Kiritilmagan"],datasets:[{data:[a,t-a],backgroundColor:["#10b981","#ef4444"]}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},title:{display:!0,text:"Umumiy parametrlar"}}}}))}let F=null;return X(async()=>{document.body.style.transform="scale(0.9)",document.body.style.transformOrigin="top left",document.body.style.width="111.11%";const a=localStorage.getItem("locale");a&&(y.value=a);const t=new Date,o=t.getHours(),e=t.toISOString().split("T")[0],s=o>=8&&o<20?1:2;(!i.value.day||!i.value.smena)&&(i.value={day:e,smena:s});try{const n=Y.state.user.structure_id;if(Array.isArray(n)&&n.length===1){const u=n[0];b.push({name:"OperatorDetail",params:{id:u}})}else if(Array.isArray(n)&&n.length>1){const u=await w.get(`/structures/${n.join(",")}`);d.value=u.data.map(x=>({...x,filled:0,notFilled:0,formula:0,manual:0,loading:!0}))}}catch(n){console.error("Error fetching data:",n)}await h(),F=setInterval(()=>{h()},6e5)}),_(()=>y.value==="uz"?"Русский":"O‘zbek"),ee(()=>{F&&clearInterval(F)}),(a,t)=>{const o=te("VaProgressCircle");return k(),C("div",ce,[l("div",me,[l("div",pe,[l("div",fe,[l("div",ge,[(k(!0),C(ae,null,le(d.value,(e,s)=>(k(),C("div",{onClick:n=>M(e.id),key:s,class:se(["relative p-1 border-2 bg-white shadow-lg border-slate-300 cursor-pointer rounded transition-opacity duration-300",e.loading?"opacity-60 pointer-events-none":"opacity-100"])},[e.loading?(k(),C("div",ye,[f(o,{indeterminate:"",size:"medium"})])):ne("",!0),l("div",be,[l("div",he,[l("div",null,[l("h5",xe,[l("span",{class:"block flex-grow leading-none",innerHTML:U(e)},null,8,_e)])]),l("div",null,[l("div",we,[f(g(j),{onClick:n=>E(e.id),preset:"primary",icon:"va-warning",class:"mr-2 mt-8",round:"","border-color":"primary"},null,8,["onClick"]),f(g(j),{onClick:n=>P(e.id),round:"",icon:"va-check",class:"mr-2 mt-8",color:"success"},null,8,["onClick"]),f(g(j),{onClick:n=>L(e.id),round:"",icon:"clear",class:"mr-2 mt-8",color:"danger"},null,8,["onClick"])])])]),l("div",Ce,[t[2]||(t[2]=l("span",{class:"text-green-600 material-symbols-outlined text-lg mr-3"},"edit",-1)),l("span",ke,v(e.filled),1),t[3]||(t[3]=l("span",{class:"text-red-600 material-symbols-outlined text-lg mr-3"},"warning",-1)),l("span",Ie,v(e.notFilled),1),t[4]||(t[4]=l("span",{class:"text-blue-600 material-symbols-outlined text-lg mr-3"},"support_agent",-1)),l("span",Ve,v(e.manual),1),t[5]||(t[5]=l("span",{class:"text-teal-600 material-symbols-outlined text-lg mr-3"},"function",-1)),l("span",De,v(e.formula),1),t[6]||(t[6]=l("span",{class:"text-purple-600 material-symbols-outlined text-lg mr-3"},"%",-1)),l("span",Ne,v(e.filled+e.notFilled>0?Math.round(e.filled/(e.filled+e.notFilled)*100):0),1)])])],10,ve))),128))])]),t[7]||(t[7]=l("div",{class:"p-6 bg-white border-sm border-slate-200 shadow-lg mt-2 mx-3 rounded-lg"},[l("div",{style:{height:"280px"}},[l("canvas",{id:"barChart"})])],-1))]),l("div",Se,[l("div",Te,[f(g(de),{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"w-full mr-2 shadow-lg"},{default:ie(()=>[f(g(re),{modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=e=>B.value=e),label:"Smena",readonly:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),t[8]||(t[8]=oe('<div class="flex flex-col mr-2 mt-2"><div class="w-[200] mb-2 p-10 text-center shadow-lg bg-white">123</div><div class="w-[200] p-10 text-center shadow-md bg-white">123</div></div><div class="w-full flex justify-center"><canvas id="pieChart" class="w-[350px] h-[350px]"></canvas></div>',2))])])])}}};export{Be as default};

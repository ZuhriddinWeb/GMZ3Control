import{r as h,c as E,E as M,f as V,g as _,h as b,j as c,l as N,i as d,t as $,k as a,n as y,d as I,o as R,z as L,V as A,m as U,u as T,I as j,J as z,G as P,s as H,H as F}from"./app-BnZHz_BC.js";/* empty css                   */const J={class:"h-full w-full text-center content-center"},Y={class:"va-h3"},K={__name:"DeleteUserModal",props:["params"],setup(C){const v=h(!1),t=C,{t:f}=E(),x=M("ondeleted"),g=async()=>{try{const{data:o}=await y.delete(`/units/${t.params.data.id}`);o.status===200?(x(t.params.data),v.value=!1):console.error("Error deleting data:",o.message)}catch(o){console.error("Error deleting data:",o)}};return(o,s)=>{const w=V("VaButton"),m=V("VaModal");return b(),_("main",J,[c(w,{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:s[0]||(s[0]=r=>v.value=!0)}),c(m,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=r=>v.value=r),"ok-text":a(f)("modals.apply"),"cancel-text":a(f)("modals.cancel"),onClose:s[2]||(s[2]=r=>v.value=!1),onOk:g,"close-button":""},{default:N(()=>[d("h3",Y,$(a(f)("modals.title")),1),d("p",null,$(a(f)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},Q={class:"h-full w-full text-center content-center"},W={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},X={__name:"EditUserModal",setup(C){const{locale:v,t}=E();h([]),h(null);const f=h(!1),x=h([]),g=h(!1),o=I({Name:"",Phone:"",Login:"",Password:""}),s=async()=>{try{const m=await y.get("/structure");x.value=m.data.map(r=>({value:r.id,text:r.Name}))}catch(m){console.error("Error fetching graphics data:",m)}},w=async()=>{try{const{data:m}=await y.put("/users",o);m.status===200?(f.value=!1,o.Name="",o.Phone="",o.Login="",o.Password="",o.StructureID=[],await fetchData()):console.error("Error saving data:",m.message)}catch(m){console.error("Error saving data:",m)}};return R(()=>{const m=localStorage.getItem("locale");m&&(v.value=m),s()}),(m,r)=>{const k=V("VaSelect"),D=V("VaModal");return b(),_("main",Q,[c(a(L),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:r[0]||(r[0]=e=>g.value=!0)}),c(D,{modelValue:g.value,"onUpdate:modelValue":r[6]||(r[6]=e=>g.value=e),"ok-text":a(t)("modals.apply"),"cancel-text":a(t)("modals.cancel"),onOk:w,onClose:r[7]||(r[7]=e=>g.value=!1),"close-button":""},{default:N(()=>[d("h3",{class:"va-h3",onVnodeMounted:s},$(a(t)("modals.addUserTitle")),513),d("div",null,[c(a(A),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[d("div",W,[c(k,{modelValue:o.StructureID,"onUpdate:modelValue":r[1]||(r[1]=e=>o.StructureID=e),label:a(t)("form.structureName"),options:x.value,multiple:""},null,8,["modelValue","label","options"])]),c(a(U),{class:"w-full",modelValue:o.Name,"onUpdate:modelValue":r[2]||(r[2]=e=>o.Name=e),rules:[e=>e&&e.length>0||a(t)("form.requiredField")],label:a(t)("form.userName")},null,8,["modelValue","rules","label"]),c(a(U),{class:"w-full",modelValue:o.Phone,"onUpdate:modelValue":r[3]||(r[3]=e=>o.Phone=e),rules:[e=>e&&e.length>0||a(t)("form.requiredField")],type:"tel",label:a(t)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),c(a(U),{class:"w-full",modelValue:o.Login,"onUpdate:modelValue":r[4]||(r[4]=e=>o.Login=e),rules:[e=>e&&e.length>0||a(t)("form.requiredField")],label:a(t)("form.login")},null,8,["modelValue","rules","label"]),c(a(U),{class:"w-full",modelValue:o.Password,"onUpdate:modelValue":r[5]||(r[5]=e=>o.Password=e),rules:[e=>e&&e.length>0||a(t)("form.requiredField")],label:a(t)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},Z={class:"h-full w-full text-center content-center"},ee={class:"va-table-responsive"},te={class:"va-table va-table--clickable w-full"},ae={key:0},le={key:1},oe={key:2},se={__name:"RolesComponent",props:["params"],setup(C){const v=C,t=h(!1);M("onupdated");const f=h([]),{init:x}=T(),{locale:g,t:o}=E(),s=I({id:v.params.data.id,userName:v.params.data.name}),w=(e,n)=>{e[n]=!e[n],console.log(`${n} for ${e.name} changed to ${e[n]}`)},m=e=>e?"success":"danger";async function r(){y.get(`/user_role/${v.params.data.id}`).then(e=>{e.data.forEach(n=>{const l=f.value.find(u=>u.id==n.role_id);l!=null&&(l.view=n.view,l.create=n.create,l.update=n.update,l.delete=n.delete)})})}async function k(){try{const e=await y.get("/role");f.value=Array.isArray(e.data)?e.data:e.data.items,f.value.forEach(n=>{n.id=n.id,n.view=n.view||!1,n.create=n.create||!1,n.update=n.update||!1,n.delete=n.delete||!1})}catch(e){console.error("Error fetching data:",e)}}const D=async()=>{try{const e=f.value.map(l=>({id:l.id,name:l.name,view:l.view,create:l.create,edit:l.update,delete:l.delete})),{data:n}=await y.post("/user_role",{...s,roles:e});n.status===200?(t.value=!1,x({message:o("login.successMessage"),color:"success"})):console.error("Error saving data:",n.message)}catch(e){console.error("Error saving data:",e)}};return R(async()=>{await k(),r()}),(e,n)=>{const l=V("VaSwitch"),u=V("VaModal");return b(),_("main",Z,[c(a(L),{round:"",icon:"settings",preset:"primary",class:"mt-1",onClick:n[0]||(n[0]=p=>t.value=!0)}),c(u,{"max-width":"45%",modelValue:t.value,"onUpdate:modelValue":n[1]||(n[1]=p=>t.value=p),"ok-text":a(o)("modals.apply"),"cancel-text":a(o)("modals.cancel"),onOk:D,onClose:n[2]||(n[2]=p=>t.value=!1),"close-button":""},{default:N(()=>[d("h3",null,[d("span",{class:"va-h3",onVnodeMounted:k},$(a(o)("table.user"))+" : "+$(s.userName),513)]),d("div",null,[d("div",ee,[d("table",te,[n[3]||(n[3]=d("thead",null,[d("tr",null,[d("th",null,"Nomi"),d("th",null,"Ruxsat"),d("th",null,"Yaratish"),d("th",null,"O'zgartirish"),d("th",null,"O'chirish")])],-1)),d("tbody",null,[(b(!0),_(j,null,z(f.value,p=>(b(),_("tr",{key:p.id},[d("td",null,$(a(o)(`${p.name}`)),1),d("td",null,[c(l,{"model-value":p.view,onChange:()=>w(p,"view"),color:m(p.view)},null,8,["model-value","onChange","color"])]),p.view?(b(),_("td",ae,[c(l,{"model-value":p.create,onChange:()=>w(p,"create"),color:m(p.create)},null,8,["model-value","onChange","color"])])):P("",!0),p.view?(b(),_("td",le,[c(l,{"model-value":p.update,onChange:()=>w(p,"update"),color:m(p.update)},null,8,["model-value","onChange","color"])])):P("",!0),p.view?(b(),_("td",oe,[c(l,{"model-value":p.delete,onChange:()=>w(p,"delete"),color:m(p.delete)},null,8,["model-value","onChange","color"])])):P("",!0)]))),128))])])])])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ne={class:"h-full w-full text-center content-center"},re={class:"va-h3"},de={__name:"RestartPassword",props:["params"],setup(C){const v=C,{t}=E(),f=h(!1),x=M("onupdated"),g=async()=>{try{const{data:o}=await y.get(`/restart-password/${v.params.data.id}`);o.status===200?(x(v.params.node,o.unit),f.value=!1):console.error("Error deleting data:",o.message)}catch(o){console.error("Error deleting data:",o)}};return(o,s)=>{const w=V("VaButton"),m=V("VaModal");return b(),_("main",ne,[c(w,{round:"",icon:"restart_alt",preset:"primary",class:"mt-1",onClick:s[0]||(s[0]=r=>f.value=!0)}),c(m,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=r=>f.value=r),"ok-text":a(t)("modals.apply"),"cancel-text":a(t)("modals.cancel"),onClose:s[2]||(s[2]=r=>f.value=!1),onOk:g,"close-button":""},{default:N(()=>[d("h3",re,$(a(t)("modals.restart")),1),d("p",null,$(a(t)("modals.messageRestart")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ue={class:"grid grid-rows-[55px,1fr]"},ce={class:"flex justify-between"},ie={class:"va-h3"},me={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},pe={class:"flex-grow"},ge={__name:"UsersPage",setup(C){const{locale:v,t}=E(),f=h([]),x=h(null),g=h(!1),o=h([]),s=I({Name:"",Phone:"",Login:"",Password:"",StructureID:[]});function w(l){x.value.applyTransaction({remove:[l]})}function m(l,u){l.setData(u)}F("ondeleted",w),F("onupdated",m);const r=H(()=>[{headerName:t("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:t("table.userName"),field:"name",flex:1},{headerName:t("table.login"),field:"login",flex:1},{headerName:t("table.phone"),field:"phone"},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:X},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:se},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:de},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:K}]),k={sortable:!0,filter:!0},D=async()=>{try{const l=await y.get("/users");f.value=Array.isArray(l.data)?l.data:l.data.items}catch(l){console.error("Error fetching data:",l)}},e=async()=>{try{const l=await y.get("/structure");o.value=l.data.map(u=>({value:u.id,text:u.Name}))}catch(l){console.error("Error fetching graphics data:",l)}},n=async()=>{try{const{data:l}=await y.post("/users",s);l.status===200?(g.value=!1,s.Name="",s.Phone="",s.Login="",s.Password="",s.StructureID=[],await D()):console.error("Error saving data:",l.message)}catch(l){console.error("Error saving data:",l)}};return R(()=>{const l=localStorage.getItem("locale");l&&(v.value=l),D(),e()}),(l,u)=>{const p=V("VaButton"),B=V("VaSelect"),S=V("VaInput"),O=V("VaForm"),q=V("VaModal"),G=V("ag-grid-vue");return b(),_("div",ue,[d("main",null,[d("div",ce,[u[8]||(u[8]=d("span",{class:"flex w-full"},null,-1)),c(p,{onClick:u[0]||(u[0]=i=>g.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})]),c(q,{modelValue:g.value,"onUpdate:modelValue":u[6]||(u[6]=i=>g.value=i),"ok-text":a(t)("buttons.save"),"cancel-text":a(t)("buttons.cancel"),onOk:n,"close-button":""},{default:N(()=>[d("h3",ie,$(a(t)("modals.addUserTitle")),1),d("div",null,[c(O,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[d("div",me,[c(B,{modelValue:s.StructureID,"onUpdate:modelValue":u[1]||(u[1]=i=>s.StructureID=i),label:a(t)("form.structureName"),options:o.value,multiple:""},null,8,["modelValue","label","options"])]),c(S,{class:"w-full",modelValue:s.Name,"onUpdate:modelValue":u[2]||(u[2]=i=>s.Name=i),rules:[i=>i&&i.length>0||a(t)("form.requiredField")],label:a(t)("form.userName")},null,8,["modelValue","rules","label"]),c(S,{class:"w-full",modelValue:s.Phone,"onUpdate:modelValue":u[3]||(u[3]=i=>s.Phone=i),rules:[i=>i&&i.length>0||a(t)("form.requiredField")],type:"tel",label:a(t)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),c(S,{class:"w-full",modelValue:s.Login,"onUpdate:modelValue":u[4]||(u[4]=i=>s.Login=i),rules:[i=>i&&i.length>0||a(t)("form.requiredField")],label:a(t)("form.login")},null,8,["modelValue","rules","label"]),c(S,{class:"w-full",modelValue:s.Password,"onUpdate:modelValue":u[5]||(u[5]=i=>s.Password=i),rules:[i=>i&&i.length>0||a(t)("form.requiredField")],label:a(t)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),d("main",pe,[c(G,{rowData:f.value,columnDefs:r.value,defaultColDef:k,animateRows:"true",class:"ag-theme-material h-full",onGridReady:u[7]||(u[7]=i=>x.value=i.api)},null,8,["rowData","columnDefs"])])])}}};export{ge as default};

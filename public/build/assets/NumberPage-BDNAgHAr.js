import{u as useToast,c as useI18n,r as ref,E as inject,f as resolveComponent,g as createElementBlock,h as openBlock,j as createVNode,k as unref,z as VaButton,l as withCtx,i as createBaseVNode,t as toDisplayString,n as axios,d as reactive,K as watch,V as VaForm,m as VaInput,F as createBlock,G as createCommentVNode,L as VaModal,_ as _export_sfc,s as computed,o as onMounted,I as Fragment,J as renderList,x as createTextVNode,M as VaSelect,N as VaTextarea,a as useStore,H as provide}from"./app-I7GpoV4R.js";/* empty css                   */import{D as DxDataGrid,a as DxSelection,b as DxColumn}from"./data-grid-B3TV5nl6.js";import{a as anime}from"./anime.es-BNELU3II.js";const _hoisted_1$5={class:"h-full w-full text-center content-center"},_hoisted_2$5={class:"va-h3"},_sfc_main$5={__name:"DeleteBlog",props:["params"],setup(t){const{init:e}=useToast(),{t:a}=useI18n(),l=ref(!1),r=t,x=inject("ondeleted"),i=async()=>{try{const{data:g}=await axios.delete(`/pages/${r.params.data.id}`);g.status===200?(x(r.params.data),l.value=!1,e({message:a("login.successMessage"),color:"success"})):console.error("Error deleting data:",g.message)}catch(g){console.error("Error deleting data:",g)}};return(g,s)=>{const h=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$5,[createVNode(unref(VaButton),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:s[0]||(s[0]=p=>l.value=!0)}),createVNode(h,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=p=>l.value=p),"ok-text":unref(a)("modals.apply"),"cancel-text":unref(a)("modals.cancel"),onClose:s[2]||(s[2]=p=>l.value=!1),onOk:i,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$5,toDisplayString(unref(a)("modals.title")),1),createBaseVNode("p",null,toDisplayString(unref(a)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$4={class:"h-full w-full text-center content-center"},_hoisted_2$4={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},_sfc_main$4={__name:"EditBlog",props:["params"],setup(t){const{init:e}=useToast(),a=t,l=ref(!1),r=inject("onupdated"),x=ref([]),{t:i,locale:g}=useI18n(),s=reactive({StructureID:"",Name:"",NameRus:"",NumberPage:"",Comment:"",id:a.params.data.id}),h=async()=>{try{const C=await axios.get("/structure");x.value=C.data.map(S=>({value:S.id,text:g.value==="uz"?S.Name:S.NameRus}));const c=await axios.get(`pages/${a.params.data.id}`);s.StructureID=+c.data.StructureID,s.Name=c.data.Name,s.ShortName=c.data.ShortName,s.NumberPage=c.data.NumberPage,s.Comment=c.data.Comment}catch(C){console.error("Error fetching graphics data:",C)}},p=async()=>{try{const{data:C}=await axios.put("/pages",s);C.status===200?(r(a.params.node,C.unit),l.value=!1,e({message:i("login.successMessage"),color:"success"})):console.error("Error saving data:",C.message)}catch(C){console.error("Error saving data:",C)}};return watch(()=>s.StructureID,C=>{}),(C,c)=>{const S=resolveComponent("VaSelect"),N=resolveComponent("VaTextarea"),B=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$4,[createVNode(unref(VaButton),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:c[0]||(c[0]=d=>(l.value=!0,h))}),createVNode(B,{modelValue:l.value,"onUpdate:modelValue":c[6]||(c[6]=d=>l.value=d),"ok-text":unref(i)("modals.apply"),"cancel-text":unref(i)("modals.cancel"),onOk:p,onClose:c[7]||(c[7]=d=>l.value=!1),"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",{class:"va-h3",onVnodeMounted:h},toDisplayString(unref(i)("modals.editFactory")),513),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$4,[createVNode(S,{modelValue:s.StructureID,"onUpdate:modelValue":c[1]||(c[1]=d=>s.StructureID=d),"value-by":"value",class:"mb-1",label:unref(i)("form.structureName"),options:x.value,clearable:""},null,8,["modelValue","label","options"])]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.NumberPage,"onUpdate:modelValue":c[2]||(c[2]=d=>s.NumberPage=d),type:"number",rules:[d=>d&&d.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.Name,"onUpdate:modelValue":c[3]||(c[3]=d=>s.Name=d),rules:[d=>d&&d.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.NameRus,"onUpdate:modelValue":c[4]||(c[4]=d=>s.NameRus=d),rules:[d=>d&&d.length>0||unref(i)("validation.requiredField")],label:unref(i)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode(N,{class:"w-full",modelValue:s.Comment,"onUpdate:modelValue":c[5]||(c[5]=d=>s.Comment=d),"max-length":"125",label:unref(i)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$3={class:"h-full w-full"},_hoisted_2$3={class:"va-h3 mb-4"},_sfc_main$3={__name:"AddForDocuments",props:["params"],setup(t){const{t:e}=useI18n(),{init:a}=useToast(),l=t,r=inject("onupdated"),x=ref(!1),i=ref([]),g=ref([]),s={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},h=async()=>{x.value=!0,g.value=[];try{const{data:N}=await axios.get(`/addfordoc/${l.params.data.id}`);i.value=C(N.tree),g.value=p(N.selected??[])}catch(N){console.error(N),a({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function p(N){return N.flat(3)}function C(N){const B=[];return N.forEach(d=>{var f;const D=d.key,m=d.title,n=parseInt(D.split("-")[1]);(f=d.children)==null||f.forEach(_=>{var w;const b=_.title,v=_.key,k=parseInt(v.split("-")[2]);(w=_.children)==null||w.forEach(y=>{var P;const o=y.title,u=y.key,$=parseInt(u.split("-")[3]);(P=y.children)!=null&&P.length&&y.children.forEach(I=>{B.push({rowId:I.ParameterID??`param-${I.key}`,sexName:m,sexId:n,pageName:b,pageId:k,groupName:o,groupId:$,paramName:I.title,ParameterID:I.ParameterID})})})})}),B}const c=({selectedRowKeys:N})=>{g.value=N},S=async()=>{const N=i.value.filter(n=>g.value.includes(n.rowId)),B=[...new Set(N.map(n=>n.sexId))],d=B.map(n=>{const f=N.filter(_=>_.sexId===n).map(_=>_.pageId);return[...new Set(f)]}),D=B.map(n=>{const f=N.filter(b=>b.sexId===n);return[...new Set(f.map(b=>b.pageId))].map(b=>{const v=f.filter(k=>k.pageId===b).map(k=>k.groupId);return[...new Set(v)]})}),m=B.map(n=>{const f=N.filter(b=>b.sexId===n);return[...new Set(f.map(b=>b.pageId))].map(b=>{const v=f.filter(w=>w.pageId===b);return[...new Set(v.map(w=>w.groupId))].map(w=>v.filter(o=>o.groupId===w).map(o=>o.ParameterID).filter(o=>o))})});try{const{data:n}=await axios.post("/addfordoc",{doc_id:l.params.data.id,FactoryStructureID:B,NumberPageBlogs:d,GroupBlogs:D,ParameterBlogs:m});if(n.status===200)r==null||r(),x.value=!1,a({message:e("login.successMessage"),color:"success"});else throw new Error(n.message||"Unknown error")}catch(n){console.error(n),a({message:e("errors.saveFailed"),color:"danger"})}};return(N,B)=>(openBlock(),createElementBlock("main",_hoisted_1$3,[createVNode(unref(VaButton),{icon:"design_services",round:"",preset:"primary",onClick:h}),createVNode(unref(VaModal),{modelValue:x.value,"onUpdate:modelValue":B[0]||(B[0]=d=>x.value=d),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:S,onClose:B[1]||(B[1]=d=>x.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$3,toDisplayString(unref(e)("modals.editFactory")),1),i.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":i.value,"key-expr":"rowId","selected-row-keys":g.value,onSelectionChanged:c,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:s},{default:withCtx(()=>[createVNode(unref(DxSelection),{mode:"multiple","show-check-boxes-mode":"always"}),createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name")},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"])]))}},_hoisted_1$2={class:"flex gap-4"},_hoisted_2$2={class:"calculator"},_hoisted_3$2={class:"answer"},_hoisted_4$2={class:"display"},_hoisted_5$1={class:"flex-1 min-w-[420px]"},_hoisted_6={class:"mb-2 text-xs text-gray-500"},_hoisted_7={class:"rounded border p-2 mb-3"},_hoisted_8={class:"flex flex-wrap items-center gap-2 mb-2"},_hoisted_9={class:"flex items-center gap-2"},_hoisted_10={class:"text-xs text-gray-500 ml-2"},_hoisted_11={class:"mb-3 flex flex-wrap gap-2"},_hoisted_12={key:0,class:"mb-3 flex flex-wrap gap-2"},_hoisted_13={key:1,class:"mb-3 flex flex-wrap gap-2"},_hoisted_14={class:"border rounded p-2 min-h-[160px]"},_hoisted_15={key:0,class:"flex flex-wrap gap-2"},_hoisted_16={key:1,class:"text-gray-500 text-sm"},_sfc_main$2={__name:"FormulaModal",props:{parameter:{type:[Number,String],required:!0},modelValue:{type:Boolean,default:!1},docId:{type:[Number,String],required:!0}},emits:["update:modelValue","save"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,openLocal=computed({get:()=>props.modelValue,set:t=>emit("update:modelValue",t)}),{init}=useToast(),items=ref([]),aggOptions=[{value:"RAW",label:"Asosiy"},{value:"HOUR",label:"Soatlik"},{value:"SHIFT",label:"Smenalik"},{value:"DAY",label:"Kunlik"},{value:"WEEK",label:"Haftalik"},{value:"MONTH",label:"Oylik"},{value:"YEAR",label:"Yillik"}],funcOptions=[{text:"Qiymat (joriy)",value:"VALUE"},{text:"O‘rtacha",value:"AVG"},{text:"Yig‘indi",value:"SUM"},{text:"Min",value:"MIN"},{text:"Max",value:"MAX"}],scopeOptions=[{text:"Joriy davr",value:"CURRENT"},{text:"Oldingi davr(lar)",value:"PREV"},{text:"Sirpanma oynaviy",value:"ROLLING"}],applyMode=ref("global"),agg=reactive({agg:"DAY",func:"VALUE",scope:"CURRENT",n:1}),aggSummary=computed(()=>{var a,l;const t=((a=aggOptions.find(r=>r.value===agg.agg))==null?void 0:a.label)??agg.agg,e=((l=funcOptions.find(r=>r.value===agg.func))==null?void 0:l.text)??agg.func;return agg.scope==="CURRENT"?`${t}, ${e}, joriy davr`:agg.scope==="PREV"?`${t}, ${e}, oldingi ${agg.n} davr`:`${t}, ${e}, oxirgi ${agg.n} davr (rolling)`});function appendParam(t){var s,h;const e=typeof agg.func=="object"?agg.func.value:agg.func,a=typeof agg.scope=="object"?agg.scope.value:agg.scope,l=[`Pid=${t.id}`,`agg=${agg.agg}`,`func=${e}`,`scope=${a}`];agg.scope!=="CURRENT"&&l.push(`n=${Number(agg.n)||1}`);const r=l.join("|");result.Calculate.push(r);const x=((s=aggOptions.find(p=>p.value===agg.agg))==null?void 0:s.label)||agg.agg,i=((h=funcOptions.find(p=>p.value===e))==null?void 0:h.text)||e;let g="joriy";a==="PREV"&&(g=`oldingi ${agg.n}`),a==="ROLLING"&&(g=`oxirgi ${agg.n}`),current.value+=`[${t.name||t.id}] ⟨${x} • ${i} • ${g}⟩`}const sel=reactive({sex:0,page:0,group:0}),pages=computed(()=>{var t,e;return((e=(t=items.value)==null?void 0:t[sel.sex])==null?void 0:e.pages)??[]}),groups=computed(()=>{var t,e;return((e=(t=pages.value)==null?void 0:t[sel.page])==null?void 0:e.groups)??[]}),parameters=computed(()=>{var t,e;return((e=(t=groups.value)==null?void 0:t[sel.group])==null?void 0:e.parameters)??[]}),logList=ref(""),current=ref(""),answer=ref(""),operatorClicked=ref(!0),result=reactive({Calculate:[],Comment:""});function anim(t){anime.timeline({targets:`#${t}`,duration:220,easing:"easeInOutCubic"}).add({backgroundColor:"#c1e3ff"}).add({backgroundColor:"#f4faff"})}function append(t){operatorClicked.value&&(current.value="",operatorClicked.value=!1),anim(typeof t=="string"?`n${t}`:"nX"),result.Calculate.push(String(t)),current.value+=String(t)}function addOp(t,e){anim(e),operatorClicked.value||(logList.value+=`${current.value} ${t} `,current.value="",operatorClicked.value=!0,result.Calculate.push(t))}const clear=()=>{addOp("","clear"),logList.value="",current.value="",answer.value="",result.Calculate=[],operatorClicked.value=!1},sign=()=>addOp("±","sign"),percent=()=>addOp("%","percent"),dot=()=>{current.value.includes(".")||append(".")},plus=()=>addOp("+","plus"),minus=()=>addOp("-","minus"),times=()=>addOp("*","times"),divide=()=>addOp("/","divide"),equal=()=>{addOp("=","equal");const expr=result.Calculate.map(t=>t.startsWith("Pid=")||t.startsWith("Static=")?"1":t).join("");try{answer.value=eval(expr)}catch{answer.value="Error"}};function selectSex(t){sel.sex=t,sel.page=0,sel.group=0}function selectPage(t){sel.page=t,sel.group=0}function selectGroup(t){sel.group=t}async function loadTree(){try{const{data:t}=await axios.get("/calculator-structure/167");items.value=Array.isArray(t.items)?t.items:[]}catch(t){console.error(t),init({message:"Strukturani yuklashda xatolik",color:"danger"})}}async function emitSave(){var e,a,l,r;const t={page_id_blog:props.parameter.id,doc_id:props.docId,param_id:(e=props.parameter)==null?void 0:e.ParameterID,sex_id:(a=props.parameter)==null?void 0:a.sexId,page_id:(l=props.parameter)==null?void 0:l.pageId,group_id:(r=props.parameter)==null?void 0:r.groupId,tokens:[...result.Calculate],comment:result.Comment||null};await axios.post("/svodkaFormula",t),emit("save",t),openLocal.value=!1}return onMounted(loadTree),watch(()=>props.docId,loadTree),(t,e)=>(openBlock(),createBlock(unref(VaModal),{modelValue:openLocal.value,"onUpdate:modelValue":e[18]||(e[18]=a=>openLocal.value=a),fullscreen:"",title:"Yangi formula yaratish","ok-text":"Tasdiqlash","cancel-text":"Bekor qilish",onOk:emitSave,"close-button":""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,toDisplayString(answer.value),1),createBaseVNode("div",_hoisted_4$2,toDisplayString(logList.value+current.value),1),createBaseVNode("div",{onClick:clear,id:"clear",class:"btn operator"},"C"),createBaseVNode("div",{onClick:sign,id:"sign",class:"btn operator"},"+/-"),createBaseVNode("div",{onClick:percent,id:"percent",class:"btn operator"},"%"),createBaseVNode("div",{onClick:divide,id:"divide",class:"btn operator"},"/"),createBaseVNode("div",{onClick:e[0]||(e[0]=a=>append("7")),id:"n7",class:"btn"},"7"),createBaseVNode("div",{onClick:e[1]||(e[1]=a=>append("8")),id:"n8",class:"btn"},"8"),createBaseVNode("div",{onClick:e[2]||(e[2]=a=>append("9")),id:"n9",class:"btn"},"9"),createBaseVNode("div",{onClick:times,id:"times",class:"btn operator"},"*"),createBaseVNode("div",{onClick:e[3]||(e[3]=a=>append("4")),id:"n4",class:"btn"},"4"),createBaseVNode("div",{onClick:e[4]||(e[4]=a=>append("5")),id:"n5",class:"btn"},"5"),createBaseVNode("div",{onClick:e[5]||(e[5]=a=>append("6")),id:"n6",class:"btn"},"6"),createBaseVNode("div",{onClick:minus,id:"minus",class:"btn operator"},"-"),createBaseVNode("div",{onClick:e[6]||(e[6]=a=>append("1")),id:"n1",class:"btn"},"1"),createBaseVNode("div",{onClick:e[7]||(e[7]=a=>append("2")),id:"n2",class:"btn"},"2"),createBaseVNode("div",{onClick:e[8]||(e[8]=a=>append("3")),id:"n3",class:"btn"},"3"),createBaseVNode("div",{onClick:plus,id:"plus",class:"btn operator"},"+"),createBaseVNode("div",{onClick:e[9]||(e[9]=a=>append("0")),id:"n0",class:"zero"},"0"),createBaseVNode("div",{onClick:dot,id:"dot",class:"btn"},"."),createBaseVNode("div",{onClick:equal,id:"equal",class:"btn operator"},"="),createBaseVNode("div",{onClick:e[10]||(e[10]=a=>append("(")),id:"lb",class:"btn p-4"},"("),createBaseVNode("div",{onClick:e[11]||(e[11]=a=>append(")")),id:"rb",class:"btn p-4"},")")]),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("div",_hoisted_6,"Sex → Sahifa → Guruh"+toDisplayString(props),1),createBaseVNode("div",_hoisted_7,[e[25]||(e[25]=createBaseVNode("div",{class:"mb-2 text-xs text-gray-500"},"Agregatsiya va oynaviy qoida",-1)),createBaseVNode("div",_hoisted_8,[e[19]||(e[19]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Davr:",-1)),(openBlock(),createElementBlock(Fragment,null,renderList(aggOptions,a=>createVNode(unref(VaButton),{key:a.value,size:"small",color:a.value===agg.agg?"primary":"secondary",onClick:l=>agg.agg=a.value},{default:withCtx(()=>[createTextVNode(toDisplayString(a.label),1)]),_:2},1032,["color","onClick"])),64)),e[20]||(e[20]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Funktsiya:",-1)),createVNode(unref(VaSelect),{modelValue:agg.func,"onUpdate:modelValue":e[12]||(e[12]=a=>agg.func=a),options:funcOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),e[21]||(e[21]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Qamrov:",-1)),createVNode(unref(VaSelect),{modelValue:agg.scope,"onUpdate:modelValue":e[13]||(e[13]=a=>agg.scope=a),options:scopeOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),agg.scope!=="CURRENT"?(openBlock(),createBlock(unref(VaInput),{key:0,modelValue:agg.n,"onUpdate:modelValue":e[14]||(e[14]=a=>agg.n=a),modelModifiers:{number:!0},type:"number",min:"1",class:"w-20",label:agg.scope==="PREV"?"nechta orqaga":"oyna hajmi"},null,8,["modelValue","label"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_9,[e[24]||(e[24]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Qo'llash:",-1)),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="global"?"primary":"secondary",onClick:e[15]||(e[15]=a=>applyMode.value="global")},{default:withCtx(()=>e[22]||(e[22]=[createTextVNode("Global",-1)])),_:1,__:[22]},8,["color"]),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="next"?"primary":"secondary",onClick:e[16]||(e[16]=a=>applyMode.value="next")},{default:withCtx(()=>e[23]||(e[23]=[createTextVNode(" Keyingi parametr",-1)])),_:1,__:[23]},8,["color"]),createBaseVNode("span",_hoisted_10,toDisplayString(aggSummary.value),1)])]),createBaseVNode("div",_hoisted_11,[(openBlock(!0),createElementBlock(Fragment,null,renderList(items.value,(a,l)=>(openBlock(),createBlock(unref(VaButton),{key:`sex-${a.sexId}`,size:"small",color:l===sel.sex?"primary":"secondary",onClick:r=>selectSex(l)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.sexName||`Sex #${a.sexId}`),1)]),_:2},1032,["color","onClick"]))),128))]),pages.value.length?(openBlock(),createElementBlock("div",_hoisted_12,[(openBlock(!0),createElementBlock(Fragment,null,renderList(pages.value,(a,l)=>(openBlock(),createBlock(unref(VaButton),{key:`page-${a.pageId}`,size:"small",color:l===sel.page?"primary":"secondary",onClick:r=>selectPage(l)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.pageName||`Sahifa ${a.pageId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),groups.value.length?(openBlock(),createElementBlock("div",_hoisted_13,[(openBlock(!0),createElementBlock(Fragment,null,renderList(groups.value,(a,l)=>(openBlock(),createBlock(unref(VaButton),{key:`grp-${a.groupId}`,size:"small",color:l===sel.group?"primary":"secondary",onClick:r=>selectGroup(l)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.groupName||`Guruh #${a.groupId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_14,[parameters.value.length?(openBlock(),createElementBlock("div",_hoisted_15,[(openBlock(!0),createElementBlock(Fragment,null,renderList(parameters.value,a=>(openBlock(),createBlock(unref(VaButton),{key:`param-${a.id}`,color:"warning","text-color":"black",style:{borderRadius:"0"},onClick:l=>appendParam(a)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.name||a.id),1)]),_:2},1032,["onClick"]))),128))])):(openBlock(),createElementBlock("div",_hoisted_16,"Parametrlar topilmadi"))])])]),createVNode(unref(VaTextarea),{class:"w-full mt-3",modelValue:result.Comment,"onUpdate:modelValue":e[17]||(e[17]=a=>result.Comment=a),"max-length":125,label:"Izoh"},null,8,["modelValue"])]),_:1},8,["modelValue"]))}},FormulaModal=_export_sfc(_sfc_main$2,[["__scopeId","data-v-7dcde5e2"]]),_hoisted_1$1={class:"h-full w-full"},_hoisted_2$1={class:"va-h3 mb-4"},_hoisted_3$1={class:"flex items-center justify-between w-full"},_hoisted_4$1={class:"flex items-center gap-2"},_hoisted_5={key:0,class:"text-green-600"},_sfc_main$1={__name:"ParamsControl",props:["params"],setup(t){const{t:e}=useI18n(),{init:a}=useToast(),l=t,r=inject("onupdated"),x=ref(!1),i=ref([]),g=ref([]),s={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},h=ref(!1),p=ref(null),C=ref("");function c(m,n){p.value={...m,id:n},C.value="",h.value=!0}const S=async()=>{x.value=!0,g.value=[];try{const{data:m}=await axios.get(`/addfordoc/${l.params.data.id}`);i.value=B(m.tree),g.value=N(m.selected)}catch(m){console.error(m),a({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function N(m){return Array.isArray(m)?m.flat(5).filter(Boolean):[]}function B(m){const n=[];return Array.isArray(m)&&m.forEach(f=>{var v;const _=parseInt(String(f.key).split("-")[1]),b=f.title;(v=f.children)==null||v.forEach(k=>{var o;const w=parseInt(String(k.key).split("-")[2]),y=k.title;(o=k.children)==null||o.forEach(u=>{var I;const $=parseInt(String(u.key).split("-")[3]),P=u.title;(I=u.children)==null||I.forEach(V=>{n.push({rowId:V.ParameterID??`param-${V.key}`,sexName:b,sexId:_,pageName:y,pageId:w,groupName:P,groupId:$,paramName:V.title,ParameterID:V.ParameterID})})})})}),n}const d=({selectedRowKeys:m})=>{g.value=m},D=async()=>{const m=i.value.filter(v=>g.value.includes(v.rowId)),n=[...new Set(m.map(v=>v.sexId))],f=n.map(v=>{const k=m.filter(w=>w.sexId===v).map(w=>w.pageId);return[...new Set(k)]}),_=n.map(v=>{const k=m.filter(y=>y.sexId===v);return[...new Set(k.map(y=>y.pageId))].map(y=>{const o=k.filter(u=>u.pageId===y).map(u=>u.groupId);return[...new Set(o)]})}),b=n.map(v=>{const k=m.filter(y=>y.sexId===v);return[...new Set(k.map(y=>y.pageId))].map(y=>{const o=k.filter($=>$.pageId===y);return[...new Set(o.map($=>$.groupId))].map($=>o.filter(I=>I.groupId===$).map(I=>I.ParameterID).filter(Boolean))})});try{const{data:v}=await axios.post("/addfordoc",{doc_id:l.params.data.id,FactoryStructureID:n,NumberPageBlogs:f,GroupBlogs:_,ParameterBlogs:b});if(v.status===200)r==null||r(),x.value=!1,a({message:e("login.successMessage"),color:"success"});else throw new Error(v.message||"Unknown error")}catch(v){console.error(v),a({message:e("errors.saveFailed"),color:"danger"})}};return(m,n)=>(openBlock(),createElementBlock("main",_hoisted_1$1,[createVNode(unref(VaButton),{icon:"star",round:"",preset:"primary",onClick:S}),createVNode(unref(VaModal),{modelValue:x.value,"onUpdate:modelValue":n[0]||(n[0]=f=>x.value=f),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:D,onClose:n[1]||(n[1]=f=>x.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$1,toDisplayString(unref(e)("modals.editFactory")),1),i.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":i.value,"key-expr":"rowId","selected-row-keys":g.value,onSelectionChanged:d,"repaint-changes-only":!0,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:s},{paramCell:withCtx(({data:f})=>[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[g.value.includes(f.data.rowId)?(openBlock(),createElementBlock("span",_hoisted_5,"✅")):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(f.data.paramName),1)]),createVNode(unref(VaButton),{size:"small",icon:"calculate",color:"info",class:"ml-2",round:"","aria-label":unref(e)("form.createFormula"),onClick:_=>c(f.data,l.params.data.id)},null,8,["aria-label","onClick"])])]),default:withCtx(()=>[createVNode(unref(DxSelection),{mode:"multiple","show-check-boxes-mode":"always"}),createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name"),"cell-template":"paramCell","min-width":320,"allow-sorting":!1},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"]),createVNode(FormulaModal,{modelValue:h.value,"onUpdate:modelValue":n[2]||(n[2]=f=>h.value=f),parameter:p.value,formula:C.value,onSave:m.handleFormulaSave,onClose:m.handleFormulaClose},null,8,["modelValue","parameter","formula","onSave","onClose"])]))}},ParamsControl=_export_sfc(_sfc_main$1,[["__scopeId","data-v-c46fa0ea"]]),_hoisted_1={class:"grid grid-rows-[55px,1fr]"},_hoisted_2={class:"flex justify-between"},_hoisted_3={class:"va-h3"},_hoisted_4={class:"flex-grow"},_sfc_main={__name:"NumberPage",props:{id:Number},setup(t){const{init:e}=useToast(),a=useStore(),{locale:l,t:r}=useI18n(),x=t,i=ref([]),g=ref(null),s=ref(!1),h=ref([]),p=reactive({StructureID:x.id,Name:"",NameRus:"",NumberPage:"",Comment:""}),C=computed(()=>a.state.user.roles[17]),c=o=>{var u,$;return(($=(u=C.value)==null?void 0:u.pivot)==null?void 0:$[o])==="1"},S=o=>x.id===22,N=computed(()=>c("create")),B=computed(()=>c("update")),d=computed(()=>c("delete"));computed(()=>S);function D(o){g.value.applyTransaction({remove:[o]})}function m(o,u){o.setData(u)}provide("ondeleted",D),provide("onupdated",m);const n=computed(()=>{const o=[{headerName:r("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:r("table.structure"),field:v(),flex:1},{headerName:r("table.name"),field:_(),flex:1},{headerName:r("table.numberpage"),field:"NumberPage"},{headerName:r("table.comment"),field:b()}];return x.id==22&&o.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ParamsControl}),x.id==22&&o.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$3}),B.value&&o.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$4}),d.value&&o.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$5}),o}),f={sortable:!0,filter:!0},_=()=>l.value==="uz"?"Name":"NameRus",b=()=>l.value==="uz"?"ShortName":"ShortNameRus",v=()=>l.value==="uz"?"SName":"NameRus",k=async()=>{try{const o=await axios.get(`/getRowPage/${x.id}`);i.value=Array.isArray(o.data)?o.data:o.data.items}catch(o){console.error("Error fetching data:",o)}},w=async()=>{try{const o=await axios.get("/structure");h.value=o.data.map(u=>({value:u.id,text:l.value==="uz"?u.Name:u.NameRus}))}catch(o){console.error("Error fetching graphics data:",o)}},y=async()=>{try{const{data:o}=await axios.post("/pages",p);o.status===200?(s.value=!1,p.StructureID="",p.Name="",p.NameRus="",p.NumberPage="",p.Comment="",await k(),e({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",o.message)}catch(o){console.error("Error saving data:",o)}};return onMounted(()=>{const o=localStorage.getItem("locale");o&&(l.value=o),k(),w()}),computed(()=>l.value==="uz"?"Русский":"O‘zbek"),(o,u)=>{const $=resolveComponent("VaTextarea"),P=resolveComponent("VaModal"),I=resolveComponent("ag-grid-vue");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("main",null,[createBaseVNode("div",_hoisted_2,[u[7]||(u[7]=createBaseVNode("span",{class:"flex w-full"},null,-1)),N.value?(openBlock(),createBlock(unref(VaButton),{key:0,onClick:u[0]||(u[0]=V=>(s.value=!0,w)),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):createCommentVNode("",!0)]),createVNode(P,{modelValue:s.value,"onUpdate:modelValue":u[5]||(u[5]=V=>s.value=V),"ok-text":unref(r)("buttons.save"),"cancel-text":unref(r)("buttons.cancel"),onOk:y,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_3,toDisplayString(unref(r)("modals.addPageTitle")),1),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createVNode(unref(VaInput),{class:"w-full",modelValue:p.NumberPage,"onUpdate:modelValue":u[1]||(u[1]=V=>p.NumberPage=V),type:"number",rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:p.Name,"onUpdate:modelValue":u[2]||(u[2]=V=>p.Name=V),rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:p.NameRus,"onUpdate:modelValue":u[3]||(u[3]=V=>p.NameRus=V),rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode($,{class:"w-full",modelValue:p.Comment,"onUpdate:modelValue":u[4]||(u[4]=V=>p.Comment=V),"max-length":"125",label:unref(r)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),createBaseVNode("main",_hoisted_4,[createVNode(I,{rowData:i.value,columnDefs:n.value,defaultColDef:f,animateRows:"true",class:"ag-theme-material h-full",onGridReady:u[6]||(u[6]=V=>g.value=V.api)},null,8,["rowData","columnDefs"])])])}}};export{_sfc_main as default};

import{b as me,c as ce,r as o,d as O,s as $,K as ve,o as fe,S as ge,f as m,g as j,h as pe,i as d,k as n,l as D,j as he,F as Ve,G as Ce,m as c}from"./app-23ff0182.js";/* empty css                   */import{_ as we}from"./EditValue-8c96a2e6.js";import{f as be}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Ie={class:"grid grid-rows-[55px,1fr]"},xe={class:"flex justify-between"},ye={class:"grid grid-cols-1 md:grid-cols-1 gap-1 items-end w-full"},De={class:"flex flex-col"},Ee={class:"m-2 flex"},_e="yyyy-MM-dd",Ne=8*60,Te=19*60+59,Pe={__name:"ParametrGetValue",setup(ke){const q=me(),{t:i,locale:z}=ce(),f=o([]),v=o(null),E=o({}),k=o([]),x=o(new Date),C=o(null),w=o(null),M=o(null);o(null);const g=o(null),Q=store.state.user.id,_=store.state.user.structure_id;o([]);const S=o([]),A=o([]),L=o([]);o(0);const l=O({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",SourceID:"",BlogsID:_[0],userId:store.state.user.id}),r=O({id:"",Comment:"",Value:"",userId:store.state.user.id}),B=o([{headerName:i("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center"},{headerName:i("table.parameters"),field:$(()=>z.value==="ru"?"NameRus":"Name"),flex:1,headerClass:"header-center"},{headerName:i("table.interval"),headerClass:"header-center",children:[{headerName:i("table.min"),field:"Min",width:100,headerClass:"header-center"},{headerName:i("table.max"),field:"Max",width:100,headerClass:"header-center"}]},{headerName:i("table.value"),field:"Value",width:150,editable:!0,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===E.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==E.value[e.data.id]&&E.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:i("table.comment"),field:"Comment",flex:1,editable:!0,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),R=async()=>{try{const e=await c.get("/changes"),a=await c.get(`/paramWithId/${_}`);k.value=e.data.map(s=>({value:s.Change,text:s.Change})),S.value=a.data.map(s=>({value:s.Pid,text:s.PName}));const u=await c.get("/source");A.value=u.data.map(s=>({value:s.id,text:s.Name}));const h=await c.get("/graphictimes");L.value=h.data.map(s=>({value:s.id,text:s.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},H={sortable:!0,filter:!0,resizable:!0},K=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",U={columnDefs:B.value,getRowClass:K,headerHeight:43},W=e=>{const{colDef:a,data:u}=e;a.field==="Value"&&u.Value&&J(e)},J=e=>{console.log(e),f.value={...e.data},M.value=e.node,r.id=f.value.id,r.Value=f.value.Value,r.Comment=f.value.Comment,w.value=!0},X=e=>{console.log("Updated Data:",e)},Y=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},P=()=>{const e=Y();return e>=Ne&&e<=Te?1:2},Z=()=>{q.push("/vparams")};l.Change=P(),$(()=>P());const p=async()=>{l.Change,be(x.value,_e);try{const e=await c.get(`/vparamsGetValue/${store.state.user.structure_id}`);f.value=Array.isArray(e.data)?e.data:e.data.items}catch(e){console.error("Error fetching data:",e)}},ee=async e=>{const{data:a,colDef:u,newValue:h,oldValue:s}=e;if(h!==s)try{await ae(a);const V=e.rowIndex;v.value&&v.value.ensureIndexVisible(V,"bottom")}catch(V){console.error("Error saving data",V)}},ae=async e=>{try{const a=await c.post("/vparams",{...e,userId:Q,structureID:_});return te(),p(),a}catch(a){console.error("Error saving data",a)}},te=()=>{v.value&&v.value.clearFocusedCell()},le=()=>{y.value&&v.value&&(v.value.stopEditing(),y.value=!1,p())};let b=null,I=null,y=o(!1);const oe=e=>{const{column:a}=e;if(a){const u=a.getColId();u==="Value"||u==="Comment"?(T(),y.value=!0,g.value&&clearTimeout(g.value),g.value=setTimeout(le,6e4)):N()}},se=e=>{const{column:a}=e;if(a){const u=a.getColId();(u==="Value"||u==="Comment")&&(T(),y.value=!1,g.value&&(clearTimeout(g.value),g.value=null))}},N=()=>{b||(b=setInterval(p,6e4)),I||(I=setInterval(R,6e4))},ne=async()=>{try{const{data:e}=await c.post("/vparams",{...l});e.status===200?(C.value=!1,l.ParametersID="",l.Name="",l.ShortName="",l.Comment="",l.Value="",l.BlogsID="",await p(),window.location.reload()):console.error("Error saving data:",e.message)}catch(e){console.error("Error saving data:",e)}},re=async e=>{try{const{data:a}=await c.post("/vparamsEdit",r);a.status===200?(C.value=!1,r.id="",r.Comment="",r.Value="",r.userId="",e.setData(a.updatedRowData),U.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},T=()=>{b&&(clearInterval(b),b=null),I&&(clearInterval(I),I=null)},ue=e=>{v.value=e.api,e.api.addEventListener("cellFocused",oe),e.api.addEventListener("cellBlurred",se),N()};return ve([()=>l.Change,()=>x.value],p),fe(()=>{p(),R(),N()}),ge(()=>{T()}),(e,a)=>{const u=m("VaButton"),h=m("VaSelect"),s=m("VaInput"),V=m("VaTextarea"),G=m("VaForm"),F=m("VaModal"),de=m("VaDateInput"),ie=m("ag-grid-vue");return j(),pe("div",Ie,[d("main",null,[d("div",xe,[a[11]||(a[11]=d("span",{class:"flex w-full"},null,-1)),n(u,{onClick:a[0]||(a[0]=t=>C.value=!0),class:"w-14 h-12 mt-3 mr-1",icon:"add"})]),n(F,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=t=>C.value=t),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:ne,"close-button":""},{default:D(()=>[a[12]||(a[12]=d("h3",{class:"va-h3"}," Qiymatlarni kiritish ",-1)),d("div",null,[n(G,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:D(()=>[d("div",ye,[n(h,{modelValue:l.ParametersID,"onUpdate:modelValue":a[1]||(a[1]=t=>l.ParametersID=t),"value-by":"value",class:"mb-1",label:"Parametr turini tanlang",options:S.value,clearable:""},null,8,["modelValue","options"])]),n(s,{class:"w-full",modelValue:l.Value,"onUpdate:modelValue":a[2]||(a[2]=t=>l.Value=t),rules:[t=>t&&t.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),n(V,{class:"w-full",modelValue:l.Comment,"onUpdate:modelValue":a[3]||(a[3]=t=>l.Comment=t),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"]),n(F,{modelValue:w.value,"onUpdate:modelValue":a[7]||(a[7]=t=>w.value=t),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[8]||(a[8]=t=>re(M.value)),"close-button":""},{default:D(()=>[a[13]||(a[13]=d("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1)),d("div",null,[n(G,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:D(()=>[n(s,{class:"w-full",modelValue:r.Value,"onUpdate:modelValue":a[5]||(a[5]=t=>r.Value=t),rules:[t=>t&&t.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),n(V,{class:"w-full",modelValue:r.Comment,"onUpdate:modelValue":a[6]||(a[6]=t=>r.Comment=t),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),d("main",De,[d("div",Ee,[n(de,{modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=t=>x.value=t),class:"mr-2",label:"Day"},null,8,["modelValue"]),n(h,{modelValue:l.Change,"onUpdate:modelValue":a[10]||(a[10]=t=>l.Change=t),"value-by":"value",label:he(i)("menu.changes"),options:k.value,clearable:""},null,8,["modelValue","label","options"]),n(u,{onClick:Z,class:"btn btn-primary mt-3 ml-3",icon:"grade"})]),n(ie,{rowData:f.value,columnDefs:B.value,defaultColDef:H,gridOptions:U,animateRows:"true",class:"ag-theme-material h-full",onGridReady:ue,onCellValueChanged:ee,onCellDoubleClicked:W},null,8,["rowData","columnDefs"]),w.value?(j(),Ve(we,{key:0,showModalEdit:w.value,resultEdit:r,onUpdate:X},null,8,["showModalEdit","resultEdit"])):Ce("",!0)])])}}};export{Pe as default};

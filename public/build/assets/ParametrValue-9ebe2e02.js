import{b as Ve,c as ye,r as s,F as c,d as H,x as K,I as xe,o as De,M as Ne,f as p,g as E,h as z,i as b,k as f,l as T,j as w,L as j,N as Ie,m as o,V as Ee,n as Te,D as Q,J as _e,K as Fe,O as ke,B as Re,t as Se}from"./app-911d8845.js";/* empty css                   */import{_ as Me}from"./EditValue-f49956fb.js";import{f as S}from"./format-45c98358.js";const Pe={class:"grid grid-rows-[55px,1fr]"},Ae=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ue={class:"flex flex-col"},$e={class:"m-2 flex"},Be="yyyy-MM-dd",Le=8*60,Oe=19*60+59,je={__name:"ParametrValue",setup(qe){const J=Ve(),{t:n,locale:W}=ye(),M=s([]),u=s(null),_=s({}),P=s([]),F=s(new Date),X=s(null),x=s(null),Y=s(null),A=s(null);s(null);const v=s(null),Z=c.state.user.id,ee=c.state.user.structure_id,g=s(null);s([]);const ae=s([]),D=s([]),te=s([]),le=s([]);s(0);const N=H({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:c.state.user.structure_id,SourceID:"",userId:c.state.user.id}),m=H({id:"",Comment:"",Value:"",userId:c.state.user.id}),U=s([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:K(()=>W.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>S(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>S(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:!0,suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===_.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==_.value[e.data.id]&&_.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),se=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?g.value>1?g.value-=1:g.value=D.value.length:g.value<D.value.length?g.value+=1:g.value=1)},re=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&u.navigateToNextCell({key:e.key}))},ne=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&re(e)})};function oe(){const e=A.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const $=async()=>{try{const e=await o.get("/changes"),a=await o.get("/pages");D.value=a.data;const r=await o.get(`/paramWithId/${ee}`);P.value=e.data.map(t=>({value:t.Change,text:t.Change})),ae.value=r.data.map(t=>({value:t.Pid,text:t.PName}));const i=await o.get("/source");te.value=i.data.map(t=>({value:t.id,text:t.Name}));const h=await o.get("/graphictimes");le.value=h.data.map(t=>({value:t.id,text:t.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},ue={sortable:!0,filter:!0,resizable:!0},ie=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",B={columnDefs:U.value,getRowClass:ie,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},de=e=>{console.log("Updated Data:",e)},ce=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},L=()=>{const e=ce();return e>=Le&&e<=Oe?1:2},me=()=>{J.push("/vparamsget")};N.Change=L(),K(()=>L());async function O(e){c.state.newValue=e;const a=N.Change,r=S(F.value,Be);new Date().getHours();try{o.all([o.get(`/get-params-for-user/${c.state.user.structure_id}/${a}/${r}/${e}`),o.get(`/vparams-value/${c.state.user.structure_id}/${r}`)]).then(o.spread(({data:i},{data:h})=>{i.forEach((d,l)=>{const q=h.find(G=>G.TimeID==d.GTid&&G.ParametersID==d.ParametersID);q&&(i[l]={...d,...q})});const t=h.map(d=>d.ParametersID);console.log(t);const y=t.map(d=>o.get(`/calculator/${d}`));console.log(y),M.value=i}))}catch(i){console.error("Error fetching data:",i)}}const fe=async e=>{const{data:a,colDef:r,newValue:i,oldValue:h}=e;if(i!==h)try{await ge(a);const t=e.rowIndex,y=u.value.getDisplayedRowCount();if(u.value&&u.value.ensureIndexVisible(t,"bottom"),t<y-1){u.value.stopEditing();const d=r.field==="Value"?"Value":"Comment";u.value.setFocusedCell(t+1,d)}}catch(t){console.error("Error saving data",t)}},ge=async e=>{console.log(e);try{const a=await o.post("/vparams",{...e,userId:Z});return he(),a}catch(a){console.error("Error saving data",a)}},he=()=>{u.value&&u.value.clearFocusedCell()},ve=()=>{I.value&&u.value&&(u.value.stopEditing(),I.value=!1)};let C=null,V=null,I=s(!1);const pe=e=>{const{column:a}=e;if(a){const r=a.getColId();r==="Value"||r==="Comment"?(R(),I.value=!0,v.value&&clearTimeout(v.value),v.value=setTimeout(ve,6e4)):k()}},we=e=>{const{column:a}=e;if(a){const r=a.getColId();(r==="Value"||r==="Comment")&&(R(),I.value=!1,v.value&&(clearTimeout(v.value),v.value=null))}},k=()=>{C||(c.state.newValue=c.state.newValue||1,C=setInterval(()=>O(c.state.newValue),6e4)),V||(V=setInterval($,6e4))},be=async e=>{try{const{data:a}=await o.post("/vparamsEdit",m);a.status===200?(X.value=!1,m.id="",m.Comment="",m.Value="",m.userId="",e.setData(a.updatedRowData),B.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},R=()=>{C&&(clearInterval(C),C=null),V&&(clearInterval(V),V=null)},Ce=e=>{u.value=e.api,e.api.addEventListener("cellFocused",pe),e.api.addEventListener("cellBlurred",we),k()};return xe(g,e=>{O(e)}),De(()=>{$(),k(),ne()}),Ne(()=>{R()}),(e,a)=>{const r=p("VaTextarea"),i=p("VaModal"),h=p("VaDateInput"),t=p("VaSelect"),y=p("VaTab"),d=p("ag-grid-vue");return E(),z("div",Pe,[b("main",null,[f(i,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=l=>x.value=l),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=l=>be(Y.value)),"close-button":""},{default:T(()=>[Ae,b("div",null,[f(w(Ee),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:T(()=>[f(w(Te),{class:"w-full",modelValue:m.Value,"onUpdate:modelValue":a[0]||(a[0]=l=>m.Value=l),rules:[l=>l&&l.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),f(r,{class:"w-full",modelValue:m.Comment,"onUpdate:modelValue":a[1]||(a[1]=l=>m.Comment=l),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",Ue,[b("div",$e,[f(h,{modelValue:F.value,"onUpdate:modelValue":a[4]||(a[4]=l=>F.value=l),class:"mr-2",label:"Day"},null,8,["modelValue"]),f(t,{modelValue:N.Change,"onUpdate:modelValue":a[5]||(a[5]=l=>N.Change=l),"value-by":"value",label:w(n)("menu.changes"),options:P.value,clearable:""},null,8,["modelValue","label","options"]),f(w(Q),{onClick:oe,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),f(w(Q),{onClick:me,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),b("div",{ref_key:"gridContainer",ref:A,class:"ag-grid-container h-full"},[f(w(ke),{modelValue:g.value,"onUpdate:modelValue":a[6]||(a[6]=l=>g.value=l),stateful:"",grow:"",onKeydown:se,tabindex:"0"},{tabs:T(()=>[(E(!0),z(_e,null,Fe(D.value,l=>(E(),j(y,{key:l.id,name:l.id},{default:T(()=>[Re(Se(l.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),f(d,{rowData:M.value,columnDefs:U.value,defaultColDef:ue,gridOptions:B,animateRows:"true",class:"ag-theme-material h-full",onGridReady:Ce,onCellValueChanged:fe,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),x.value?(E(),j(Me,{key:0,showModalEdit:x.value,resultEdit:m,onUpdate:de},null,8,["showModalEdit","resultEdit"])):Ie("",!0)])])}}};export{je as default};

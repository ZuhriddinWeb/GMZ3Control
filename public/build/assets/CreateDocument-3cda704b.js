import{r as u,c as C,o as M,g as P,h as q,k as r,j as o,l as w,m,D as E,i as p,R}from"./app-cceea9b3.js";import{p as V,q as z,D as i}from"./data-grid-5521d64e.js";const B={class:"h-full w-full text-center content-center"},N=p("h3",null,[p("span",{class:"va-h3"},"Ruxsatlar")],-1),K={class:"flex-grow mt-8"},L={__name:"CreateDocument",props:["params"],setup(D){const h=D,c=u(!1),{locale:g,t:v}=C(),n=u([]),s=u([]),l=u({id:[],parameters:[]}),x=async()=>{c.value=!0,await k()},k=async()=>{try{const e=(await m.get(`/getUserData/${h.params.data.id}`)).data[0];e&&(l.value.id=e.FactoryStructureID||[],l.value.parameters=e.ParametersID||[],s.value=[],l.value.id.forEach((t,d)=>{(l.value.parameters[d]||[]).forEach(b=>{const y=n.value.find(f=>f.FactoryStructureID===t&&f.ParametersID===b);y&&s.value.push(y.id)})}),console.log("Foydalanuvchi ma'lumotlariga ko'ra tanlangan row keys:",s.value))}catch(a){console.error("Foydalanuvchi ma’lumotlarini olishda xatolik:",a)}},S=async()=>{try{const a=await m.get("/paramsgraph");n.value=a.data,console.log("Olingan rowData:",n.value)}catch(a){console.error("Ma’lumotlarni olishda xatolik:",a)}},_=async()=>{try{const a={id:l.value.id,parameters:l.value.parameters,user_id:h.params.data.id},e=await m.post("/documents",a);e.status===200?(console.log("Ma'lumotlar muvaffaqiyatli saqlandi:",e.data),alert("Ma'lumotlar muvaffaqiyatli saqlandi!")):(console.error("Ma'lumotlarni saqlashda xatolik yuz berdi:",e),alert("Ma'lumotlarni saqlashda xatolik yuz berdi!"))}catch(a){console.error("Xatolik yuz berdi:",a),alert("Xatolik yuz berdi. Ma'lumotlarni saqlash amalga oshmadi.")}},I=({selectedRowKeys:a})=>{s.value=a,console.log("Tanlangan row keys:",s.value),F()},F=()=>{const a={};s.value.forEach(e=>{const t=n.value.find(d=>d.id===e);t&&(a[t.FactoryStructureID]||(a[t.FactoryStructureID]={id:t.FactoryStructureID,parameters:[]}),a[t.FactoryStructureID].parameters.push(t.ParametersID))}),l.value={id:Object.keys(a).map(Number),parameters:Object.values(a).map(e=>e.parameters)}};return M(()=>{const a=localStorage.getItem("locale");a&&(g.value=a),S()}),(a,e)=>(P(),q("div",B,[r(o(E),{round:"",icon:"history_edu",preset:"primary",class:"mt-1",onClick:x}),r(o(R),{"max-width":"45%",modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),"ok-text":o(v)("modals.apply"),"cancel-text":o(v)("modals.cancel"),onOk:_,onClose:e[1]||(e[1]=t=>c.value=!1),"close-button":""},{default:w(()=>[N,p("main",K,[r(o(V),{"data-source":n.value,showBorders:"true",rowAlternationEnabled:"true",selectedRowKeys:s.value,onSelectionChanged:I,columnAutoWidth:"true",showColumnLines:"true",showRowLines:"true",wordWrapEnabled:"true",pager:{visible:!0,showPageSizeSelector:!0,allowedPageSizes:[5,10,20],showInfo:!0},keyExpr:"id"},{default:w(()=>[r(o(z),{mode:"multiple",showCheckBoxesMode:"always"}),r(o(i),{dataField:"FName",caption:"Sex nomi",groupIndex:"0"}),r(o(i),{dataField:"FactoryStructureID",caption:"",width:"50"}),r(o(i),{dataField:"ParametersID",caption:"Parameter Id si"}),r(o(i),{dataField:"PName",caption:"Parameter nomi"})]),_:1},8,["data-source","selectedRowKeys"])])]),_:1},8,["modelValue","ok-text","cancel-text"])]))}};export{L as default};

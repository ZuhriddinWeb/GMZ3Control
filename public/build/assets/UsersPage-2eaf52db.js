import{r as h,c as I,G as q,f as y,g as x,h as b,k as d,l as C,i as c,t as k,j as t,m as V,d as L,o as U,D as B,V as A,n as M,u as T,K as j,L as K,I as R,R as W,J as G,x as X}from"./app-3bceb5f3.js";/* empty css                   */import{a as J,b as Y,D as F}from"./data-grid-6eca2d9e.js";const H={class:"h-full w-full text-center content-center"},Q={class:"va-h3"},Z={__name:"DeleteUserModal",props:["params"],setup(D){const v=h(!1),o=D,{t:f}=I(),w=q("ondeleted"),g=async()=>{try{const{data:s}=await V.delete(`/units/${o.params.data.id}`);s.status===200?(w(o.params.data),v.value=!1):console.error("Error deleting data:",s.message)}catch(s){console.error("Error deleting data:",s)}};return(s,n)=>{const _=y("VaButton"),p=y("VaModal");return x(),b("main",H,[d(_,{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:n[0]||(n[0]=u=>v.value=!0)}),d(p,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=u=>v.value=u),"ok-text":t(f)("modals.apply"),"cancel-text":t(f)("modals.cancel"),onClose:n[2]||(n[2]=u=>v.value=!1),onOk:g,"close-button":""},{default:C(()=>[c("h3",Q,k(t(f)("modals.title")),1),c("p",null,k(t(f)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}};const ee={class:"h-full w-full text-center content-center"},ae={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},te={__name:"EditUserModal",setup(D){const{locale:v,t:o}=I();h([]),h(null);const f=h(!1),w=h([]),g=h(!1),s=L({Name:"",Phone:"",Login:"",Password:""}),n=async()=>{try{const p=await V.get("/structure");w.value=p.data.map(u=>({value:u.id,text:u.Name}))}catch(p){console.error("Error fetching graphics data:",p)}},_=async()=>{try{const{data:p}=await V.put("/users",s);p.status===200?(f.value=!1,s.Name="",s.Phone="",s.Login="",s.Password="",s.StructureID=[],await fetchData()):console.error("Error saving data:",p.message)}catch(p){console.error("Error saving data:",p)}};return U(()=>{const p=localStorage.getItem("locale");p&&(v.value=p),n()}),(p,u)=>{const S=y("VaSelect"),$=y("VaModal");return x(),b("main",ee,[d(t(B),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:u[0]||(u[0]=l=>g.value=!0)}),d($,{modelValue:g.value,"onUpdate:modelValue":u[6]||(u[6]=l=>g.value=l),"ok-text":t(o)("modals.apply"),"cancel-text":t(o)("modals.cancel"),onOk:_,onClose:u[7]||(u[7]=l=>g.value=!1),"close-button":""},{default:C(()=>[c("h3",{class:"va-h3",onVnodeMounted:n},k(t(o)("modals.addUserTitle")),513),c("div",null,[d(t(A),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:C(()=>[c("div",ae,[d(S,{modelValue:s.StructureID,"onUpdate:modelValue":u[1]||(u[1]=l=>s.StructureID=l),label:t(o)("form.structureName"),options:w.value,multiple:""},null,8,["modelValue","label","options"])]),d(t(M),{class:"w-full",modelValue:s.Name,"onUpdate:modelValue":u[2]||(u[2]=l=>s.Name=l),rules:[l=>l&&l.length>0||t(o)("form.requiredField")],label:t(o)("form.userName")},null,8,["modelValue","rules","label"]),d(t(M),{class:"w-full",modelValue:s.Phone,"onUpdate:modelValue":u[3]||(u[3]=l=>s.Phone=l),rules:[l=>l&&l.length>0||t(o)("form.requiredField")],type:"tel",label:t(o)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),d(t(M),{class:"w-full",modelValue:s.Login,"onUpdate:modelValue":u[4]||(u[4]=l=>s.Login=l),rules:[l=>l&&l.length>0||t(o)("form.requiredField")],label:t(o)("form.login")},null,8,["modelValue","rules","label"]),d(t(M),{class:"w-full",modelValue:s.Password,"onUpdate:modelValue":u[5]||(u[5]=l=>s.Password=l),rules:[l=>l&&l.length>0||t(o)("form.requiredField")],label:t(o)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}};const le={class:"h-full w-full text-center content-center"},oe={class:"va-table-responsive"},se={class:"va-table va-table--clickable w-full"},ne=c("thead",null,[c("tr",null,[c("th",null,"Nomi"),c("th",null,"Ruxsat"),c("th",null,"Yaratish"),c("th",null,"O'zgartirish"),c("th",null,"O'chirish")])],-1),re={key:0},de={key:1},ue={key:2},ce={__name:"RolesComponent",props:["params"],setup(D){const v=D,o=h(!1);q("onupdated");const f=h([]),{init:w}=T(),{locale:g,t:s}=I(),n=L({id:v.params.data.id,userName:v.params.data.name}),_=(l,a)=>{l[a]=!l[a],console.log(`${a} for ${l.name} changed to ${l[a]}`)},p=l=>l?"success":"danger";async function u(){V.get(`/user_role/${v.params.data.id}`).then(l=>{l.data.forEach(a=>{const e=f.value.find(r=>r.id==a.role_id);e!=null&&(e.view=a.view,e.create=a.create,e.update=a.update,e.delete=a.delete)})})}async function S(){try{const l=await V.get("/role");f.value=Array.isArray(l.data)?l.data:l.data.items,f.value.forEach(a=>{a.id=a.id,a.view=a.view||!1,a.create=a.create||!1,a.update=a.update||!1,a.delete=a.delete||!1})}catch(l){console.error("Error fetching data:",l)}}const $=async()=>{try{const l=f.value.map(e=>({id:e.id,name:e.name,view:e.view,create:e.create,edit:e.update,delete:e.delete})),{data:a}=await V.post("/user_role",{...n,roles:l});a.status===200?(o.value=!1,w({message:s("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(l){console.error("Error saving data:",l)}};return U(async()=>{await S(),u()}),(l,a)=>{const e=y("VaSwitch"),r=y("VaModal");return x(),b("main",le,[d(t(B),{round:"",icon:"settings",preset:"primary",class:"mt-1",onClick:a[0]||(a[0]=i=>o.value=!0)}),d(r,{"max-width":"45%",modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=i=>o.value=i),"ok-text":t(s)("modals.apply"),"cancel-text":t(s)("modals.cancel"),onOk:$,onClose:a[2]||(a[2]=i=>o.value=!1),"close-button":""},{default:C(()=>[c("h3",null,[c("span",{class:"va-h3",onVnodeMounted:S},k(t(s)("table.user"))+" : "+k(n.userName),513)]),c("div",null,[c("div",oe,[c("table",se,[ne,c("tbody",null,[(x(!0),b(j,null,K(f.value,i=>(x(),b("tr",{key:i.id},[c("td",null,k(t(s)(`${i.name}`)),1),c("td",null,[d(e,{"model-value":i.view,onChange:()=>_(i,"view"),color:p(i.view)},null,8,["model-value","onChange","color"])]),i.view?(x(),b("td",re,[d(e,{"model-value":i.create,onChange:()=>_(i,"create"),color:p(i.create)},null,8,["model-value","onChange","color"])])):R("",!0),i.view?(x(),b("td",de,[d(e,{"model-value":i.update,onChange:()=>_(i,"update"),color:p(i.update)},null,8,["model-value","onChange","color"])])):R("",!0),i.view?(x(),b("td",ue,[d(e,{"model-value":i.delete,onChange:()=>_(i,"delete"),color:p(i.delete)},null,8,["model-value","onChange","color"])])):R("",!0)]))),128))])])])])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ie={class:"h-full w-full text-center content-center"},me={class:"va-h3"},pe={__name:"RestartPassword",props:["params"],setup(D){const v=D,{t:o}=I(),f=h(!1),w=q("onupdated"),g=async()=>{try{const{data:s}=await V.get(`/restart-password/${v.params.data.id}`);s.status===200?(w(v.params.node,s.unit),f.value=!1):console.error("Error deleting data:",s.message)}catch(s){console.error("Error deleting data:",s)}};return(s,n)=>{const _=y("VaButton"),p=y("VaModal");return x(),b("main",ie,[d(_,{round:"",icon:"restart_alt",preset:"primary",class:"mt-1",onClick:n[0]||(n[0]=u=>f.value=!0)}),d(p,{modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=u=>f.value=u),"ok-text":t(o)("modals.apply"),"cancel-text":t(o)("modals.cancel"),onClose:n[2]||(n[2]=u=>f.value=!1),onOk:g,"close-button":""},{default:C(()=>[c("h3",me,k(t(o)("modals.restart")),1),c("p",null,k(t(o)("modals.messageRestart")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}};const fe={class:"h-full w-full text-center content-center"},ve=c("h3",null,[c("span",{class:"va-h3"},"Ruxsatlar")],-1),ge={class:"flex-grow mt-8"},he={__name:"CreateDocument",props:["params"],setup(D){const v=D,o=h(!1),{locale:f,t:w}=I(),g=h([]),s=h([]),n=h({id:[],parameters:[]}),_=async()=>{o.value=!0,await p()},p=async()=>{try{const e=(await V.get(`/getUserData/${v.params.data.id}`)).data[0];e&&(n.value.id=e.FactoryStructureID||[],n.value.parameters=e.ParametersID||[],s.value=[],n.value.id.forEach((r,i)=>{(n.value.parameters[i]||[]).forEach(N=>{const P=g.value.find(E=>E.FactoryStructureID===r&&E.ParametersID===N);P&&s.value.push(P.id)})}),console.log("Foydalanuvchi ma'lumotlariga ko'ra tanlangan row keys:",s.value))}catch(a){console.error("Foydalanuvchi ma’lumotlarini olishda xatolik:",a)}},u=async()=>{try{const a=await V.get("/paramsgraph");g.value=a.data}catch(a){console.error("Ma’lumotlarni olishda xatolik:",a)}},S=async()=>{try{const a={id:n.value.id,parameters:n.value.parameters,user_id:v.params.data.id},e=await V.post("/documents",a);e.status===200?(console.log("Ma'lumotlar muvaffaqiyatli saqlandi:",e.data),alert("Ma'lumotlar muvaffaqiyatli saqlandi!")):(console.error("Ma'lumotlarni saqlashda xatolik yuz berdi:",e),alert("Ma'lumotlarni saqlashda xatolik yuz berdi!"))}catch(a){console.error("Xatolik yuz berdi:",a),alert("Xatolik yuz berdi. Ma'lumotlarni saqlash amalga oshmadi.")}},$=({selectedRowKeys:a})=>{s.value=a,console.log("Tanlangan row keys:",s.value),l()},l=()=>{const a={};s.value.forEach(e=>{const r=g.value.find(i=>i.id===e);r&&(a[r.FactoryStructureID]||(a[r.FactoryStructureID]={id:r.FactoryStructureID,parameters:[]}),a[r.FactoryStructureID].parameters.push(r.ParametersID))}),n.value={id:Object.keys(a).map(Number),parameters:Object.values(a).map(e=>e.parameters)}};return U(()=>{const a=localStorage.getItem("locale");a&&(f.value=a),u()}),(a,e)=>(x(),b("div",fe,[d(t(B),{round:"",icon:"history_edu",preset:"primary",class:"mt-1",onClick:_}),d(t(W),{"max-width":"45%",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r),"ok-text":t(w)("modals.apply"),"cancel-text":t(w)("modals.cancel"),onOk:S,onClose:e[1]||(e[1]=r=>o.value=!1),"close-button":""},{default:C(()=>[ve,c("main",ge,[d(t(J),{"data-source":g.value,showBorders:"true",rowAlternationEnabled:"true",selectedRowKeys:s.value,onSelectionChanged:$,columnAutoWidth:"true",showColumnLines:"true",showRowLines:"true",wordWrapEnabled:"true",pager:{visible:!0,showPageSizeSelector:!0,allowedPageSizes:[5,10,20],showInfo:!0},keyExpr:"id"},{default:C(()=>[d(t(Y),{mode:"multiple",showCheckBoxesMode:"always"}),d(t(F),{dataField:"FName",caption:"Sex nomi",groupIndex:"0"}),d(t(F),{dataField:"FactoryStructureID",caption:"",width:"50"}),d(t(F),{dataField:"ParametersID",caption:"Parameter Id si"}),d(t(F),{dataField:"PName",caption:"Parameter nomi"})]),_:1},8,["data-source","selectedRowKeys"])])]),_:1},8,["modelValue","ok-text","cancel-text"])]))}};const we={class:"grid grid-rows-[55px,1fr]"},_e={class:"flex justify-between"},ye=c("span",{class:"flex w-full"},null,-1),Ve={class:"va-h3"},xe={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},be={class:"flex-grow"},Se={__name:"UsersPage",setup(D){const{locale:v,t:o}=I(),f=h([]),w=h(null),g=h(!1),s=h([]),n=L({Name:"",Phone:"",Login:"",Password:"",StructureID:[]});function _(e){w.value.applyTransaction({remove:[e]})}function p(e,r){e.setData(r)}G("ondeleted",_),G("onupdated",p);const u=X(()=>[{headerName:o("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:o("table.userName"),field:"name",flex:1},{headerName:o("table.login"),field:"login",flex:1},{headerName:o("table.phone"),field:"phone"},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:he},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:te},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ce},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:pe},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:Z}]),S={sortable:!0,filter:!0},$=async()=>{try{const e=await V.get("/users");f.value=Array.isArray(e.data)?e.data:e.data.items}catch(e){console.error("Error fetching data:",e)}},l=async()=>{try{const e=await V.get("/structure");s.value=e.data.map(r=>({value:r.id,text:r.Name}))}catch(e){console.error("Error fetching graphics data:",e)}},a=async()=>{try{const{data:e}=await V.post("/users",n);e.status===200?(g.value=!1,n.Name="",n.Phone="",n.Login="",n.Password="",n.StructureID=[],await $()):console.error("Error saving data:",e.message)}catch(e){console.error("Error saving data:",e)}};return U(()=>{const e=localStorage.getItem("locale");e&&(v.value=e),$(),l()}),(e,r)=>{const i=y("VaButton"),O=y("VaSelect"),N=y("VaInput"),P=y("VaForm"),E=y("VaModal"),z=y("ag-grid-vue");return x(),b("div",we,[c("main",null,[c("div",_e,[ye,d(i,{onClick:r[0]||(r[0]=m=>g.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})]),d(E,{modelValue:g.value,"onUpdate:modelValue":r[6]||(r[6]=m=>g.value=m),"ok-text":t(o)("buttons.save"),"cancel-text":t(o)("buttons.cancel"),onOk:a,"close-button":""},{default:C(()=>[c("h3",Ve,k(t(o)("modals.addUserTitle")),1),c("div",null,[d(P,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:C(()=>[c("div",xe,[d(O,{modelValue:n.StructureID,"onUpdate:modelValue":r[1]||(r[1]=m=>n.StructureID=m),label:t(o)("form.structureName"),options:s.value,multiple:""},null,8,["modelValue","label","options"])]),d(N,{class:"w-full",modelValue:n.Name,"onUpdate:modelValue":r[2]||(r[2]=m=>n.Name=m),rules:[m=>m&&m.length>0||t(o)("form.requiredField")],label:t(o)("form.userName")},null,8,["modelValue","rules","label"]),d(N,{class:"w-full",modelValue:n.Phone,"onUpdate:modelValue":r[3]||(r[3]=m=>n.Phone=m),rules:[m=>m&&m.length>0||t(o)("form.requiredField")],type:"tel",label:t(o)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),d(N,{class:"w-full",modelValue:n.Login,"onUpdate:modelValue":r[4]||(r[4]=m=>n.Login=m),rules:[m=>m&&m.length>0||t(o)("form.requiredField")],label:t(o)("form.login")},null,8,["modelValue","rules","label"]),d(N,{class:"w-full",modelValue:n.Password,"onUpdate:modelValue":r[5]||(r[5]=m=>n.Password=m),rules:[m=>m&&m.length>0||t(o)("form.requiredField")],label:t(o)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),c("main",be,[d(z,{rowData:f.value,columnDefs:u.value,defaultColDef:S,animateRows:"true",class:"ag-theme-material h-full",onGridReady:r[7]||(r[7]=m=>w.value=m.api)},null,8,["rowData","columnDefs"])])])}}};export{Se as default};

import{b as ye,c as Ne,r,F as u,d as K,x as z,K as De,o as xe,N as Ee,f as w,g as I,h as W,i as C,k as c,l as k,j as b,L as j,M as Te,m,V as Fe,n as Ie,D as Q,I as ke,J as _e,B as Re,t as Se,O as Pe}from"./app-df2e272d.js";/* empty css                   */import{_ as Me}from"./EditValue-2e16492d.js";import{f as M}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Ae={class:"grid grid-rows-[55px,1fr]"},Ue=C("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),$e={class:"flex flex-col"},Oe={class:"m-2 flex"},Be="yyyy-MM-dd",Le=8*60,qe=19*60+59,je={__name:"ParametrValue",props:{id:Number},setup(J){const _=J,X=ye(),{t:n,locale:Y}=Ne(),A=r([]),i=r(null),v=r({}),U=r([]),x=r(new Date),Z=r(null),E=r(null),ee=r(null),$=r(null);r(null);const p=r(null),ae=u.state.user.id;u.state.user.structure_id;const f=r(null);r([]);const te=r([]),T=r([]),le=r([]),se=r([]);r(0);const V=K({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:u.state.user.structure_id,SourceID:"",userId:u.state.user.id}),d=K({id:"",Comment:"",Value:"",userId:u.state.user.id}),O=r([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0,cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=v.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=v.value)==null?void 0:a[e.data.id])&&((t=v.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"}},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:z(()=>Y.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:e=>(console.log("params.data:",e.data),e.data&&e.data.WithFormula!=="1"),suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=v.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=v.value)==null?void 0:a[e.data.id])&&((t=v.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),re=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?f.value>1?f.value-=1:f.value=T.value.length:f.value<T.value.length?f.value+=1:f.value=1)},ne=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&i.navigateToNextCell({key:e.key}))},oe=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&ne(e)})};function ue(){const e=$.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const B=async()=>{try{const e=await m.get("/changes"),a=await m.get(`/pages-select/${_.id}`);T.value=a.data;const t=await m.get(`/paramWithId/${_.id}`);U.value=e.data.map(l=>({value:l.Change,text:l.Change})),te.value=t.data.map(l=>({value:l.Pid,text:l.PName}));const o=await m.get("/source");le.value=o.data.map(l=>({value:l.id,text:l.Name}));const g=await m.get("/graphictimes");se.value=g.data.map(l=>({value:l.id,text:l.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},ie={sortable:!0,filter:!0,resizable:!0},de=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",L={columnDefs:O.value,suppressScrollOnNewData:!0,getRowClass:de,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},ce=e=>{console.log("Updated Data:",e)},me=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},q=()=>{const e=me();return e>=Le&&e<=qe?1:2},fe=()=>{X.push("/vparamsget")};V.Change=q(),z(()=>q());async function R(e){u.state.newValue=e;const a=V.Change,t=M(x.value,Be);u.state.ValueDay=t,new Date().getHours();try{const[o,g]=await m.all([m.get(`/get-params-for-user/${_.id}/${a}/${t}/${e}`),m.get(`/vparams-value/${u.state.user.structure_id}/${t}/${a}`)]),l=o.data,D=g.data;l.forEach((h,s)=>{const G=D.find(H=>H.TimeID==h.GTid&&H.ParametersID==h.ParametersID);G&&(l[s]={...h,...G})}),A.value=l}catch(o){console.error("Error fetching data:",o)}}const ge=async e=>{const{data:a,colDef:t,newValue:o,oldValue:g}=e;if(o!==g)try{await he(a);const l=e.rowIndex,D=i.value.getDisplayedRowCount();if(i.value&&i.value.ensureIndexVisible(l,"bottom"),l<D-1){i.value.stopEditing();const h=t.field==="Value"?"Value":"Comment";i.value.setFocusedCell(l+1,h)}}catch(l){console.error("Error saving data",l)}},he=async e=>{console.log(x.value);const a=V.Change,t=u.state.ValueDay;try{const o=await m.post("/vparams",{...e,userId:ae,change:a,daySelect:t});return ve(),R(u.state.newValue),o}catch(o){console.error("Error saving data",o)}},ve=()=>{i.value&&i.value.clearFocusedCell()},pe=()=>{F.value&&i.value&&(i.value.stopEditing(),F.value=!1)};let y=null,N=null,F=r(!1);const we=e=>{const{column:a}=e;if(a){const t=a.getColId();t==="Value"||t==="Comment"?(P(),F.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(pe,6e4)):S()}},be=e=>{const{column:a}=e;if(a){const t=a.getColId();(t==="Value"||t==="Comment")&&(P(),F.value=!1,p.value&&(clearTimeout(p.value),p.value=null))}},S=()=>{y||(u.state.newValue=u.state.newValue||1,y=setInterval(()=>R(u.state.newValue),6e4)),N||(N=setInterval(B,6e4))},Ce=async e=>{try{const{data:a}=await m.post("/vparamsEdit",d);a.status===200?(Z.value=!1,d.id="",d.Comment="",d.Value="",d.userId="",e.setData(a.updatedRowData),L.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},P=()=>{y&&(clearInterval(y),y=null),N&&(clearInterval(N),N=null)},Ve=e=>{i.value=e.api,e.api.addEventListener("cellFocused",we),e.api.addEventListener("cellBlurred",be),S()};return De(f,e=>{R(e)}),xe(()=>{B(),S(),oe()}),Ee(()=>{P()}),(e,a)=>{const t=w("VaTextarea"),o=w("VaModal"),g=w("VaDateInput"),l=w("VaSelect"),D=w("VaTab"),h=w("ag-grid-vue");return I(),W("div",Ae,[C("main",null,[c(o,{modelValue:E.value,"onUpdate:modelValue":a[2]||(a[2]=s=>E.value=s),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=s=>Ce(ee.value)),"close-button":""},{default:k(()=>[Ue,C("div",null,[c(b(Fe),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:k(()=>[c(b(Ie),{class:"w-full",modelValue:d.Value,"onUpdate:modelValue":a[0]||(a[0]=s=>d.Value=s),rules:[s=>s&&s.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),c(t,{class:"w-full",modelValue:d.Comment,"onUpdate:modelValue":a[1]||(a[1]=s=>d.Comment=s),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),C("main",$e,[C("div",Oe,[c(g,{modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=s=>x.value=s),class:"mr-2",label:"Day"},null,8,["modelValue"]),c(l,{modelValue:V.Change,"onUpdate:modelValue":a[5]||(a[5]=s=>V.Change=s),"value-by":"value",label:b(n)("menu.changes"),options:U.value,clearable:""},null,8,["modelValue","label","options"]),c(b(Q),{onClick:ue,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),c(b(Q),{onClick:fe,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),C("div",{ref_key:"gridContainer",ref:$,class:"ag-grid-container h-full"},[c(b(Pe),{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=s=>f.value=s),stateful:"",grow:"",onKeydown:re,tabindex:"0"},{tabs:k(()=>[(I(!0),W(ke,null,_e(T.value,s=>(I(),j(D,{key:s.NumberPage,name:s.NumberPage},{default:k(()=>[Re(Se(s.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),c(h,{rowData:A.value,columnDefs:O.value,defaultColDef:ie,gridOptions:L,animateRows:"true",class:"ag-theme-material h-full",onGridReady:Ve,onCellValueChanged:ge,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),E.value?(I(),j(Me,{key:0,showModalEdit:E.value,resultEdit:d,onUpdate:ce},null,8,["showModalEdit","resultEdit"])):Te("",!0)])])}}};export{je as default};

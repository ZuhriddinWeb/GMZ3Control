import{c as O,a as j,u as z,r as c,s as m,d as L,o as q,f,g as J,h as N,i as n,j as d,F as K,G as Q,k as r,z as W,l as T,t as X,V as Y,n as u,H as C}from"./app-BikTMOPd.js";/* empty css                   */import{_ as Z,a as ee}from"./DeleteGraphicTimesModal-DnrbgwoY.js";import{f as v}from"./format-D9pTN3Kd.js";const ae={class:"grid grid-rows-[55px,1fr]"},te={class:"flex justify-between"},le={class:"va-h3"},oe={class:"grid grid-cols-1 md:grid-cols-1 gap-1 items-end w-full"},se={class:"grid grid-cols-2 md:grid-cols-3 gap-3 items-end"},re={class:"flex-grow"},me={__name:"GraphicTimesPage",props:{id:Number},setup(_){const{locale:y,t}=O(),D=j(),{init:I}=z(),g=_,b=c([]),w=c(null),p=c(!1),E=c([]),V=c([]),k=m(()=>D.state.user.roles[8]),h=a=>{var e,i;return((i=(e=k.value)==null?void 0:e.pivot)==null?void 0:i[a])==="1"},G=m(()=>h("create")),S=m(()=>h("update")),$=m(()=>h("delete")),l=L({GraphicId:g.id,ChangeId:"",Name:"",StartTime:"",EndTime:""});function H(a){w.value.applyTransaction({remove:[a]})}function R(a,e){a.setData(e)}C("ondeleted",H),C("onupdated",R);const U=m(()=>{const a=[{headerName:t("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:"ID",field:"id",width:80},{headerName:t("table.change"),field:"Change",width:120},{headerName:t("table.graphicName"),field:"GName",flex:1},{headerName:t("table.name"),field:"Name",flex:1,valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.startTime"),field:"StartTime",valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.endTime"),field:"EndTime",valueFormatter:e=>v(new Date(`1970-01-01T${e.value}`),"HH:mm")},{headerName:t("table.comment"),field:"Comment",flex:1}];return S.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:Z}),$.value&&a.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ee}),a}),B={sortable:!0,filter:!0},x=async()=>{try{const a=await u.get(`/getTimes/${g.id}`);b.value=Array.isArray(a.data)?a.data:a.data.items}catch(a){console.error("Error fetching data:",a)}},F=async()=>{try{const a=await u.get("/graphics"),e=await u.get(`/graphicterms/${g.id}`);console.log(e);const i=await u.get("/changes");E.value=a.data.map(s=>({value:s.id,text:s.Name})),V.value=i.data.map(s=>({value:s.Change,text:s.Change}))}catch(a){console.error("Error fetching graphics data:",a)}},M=async()=>{try{const{data:a}=await u.post("/graphictimes",l);a.status===200?(p.value=!1,l.ChangeId="",l.Name="",l.StartTime="",l.EndTime="",await x(),I({message:t("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}};return q(()=>{const a=localStorage.getItem("locale");a&&(y.value=a),x(),F()}),(a,e)=>{const i=f("VaSelect"),s=f("VaTimeInput"),P=f("VaModal"),A=f("ag-grid-vue");return N(),J("div",ae,[n("main",null,[n("div",te,[e[7]||(e[7]=n("span",{class:"flex w-full"},null,-1)),G.value?(N(),K(r(W),{key:0,onClick:e[0]||(e[0]=o=>p.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):Q("",!0)]),d(P,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),"ok-text":r(t)("buttons.save"),"cancel-text":r(t)("buttons.cancel"),onOk:M,"close-button":""},{default:T(()=>[n("h3",le,X(r(t)("modals.addGraphicTimesTitle")),1),n("div",null,[d(r(Y),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:T(()=>[n("div",oe,[d(i,{modelValue:l.ChangeId,"onUpdate:modelValue":e[1]||(e[1]=o=>l.ChangeId=o),"value-by":"value",class:"mb-6",label:r(t)("form.selectChange"),options:V.value,clearable:""},null,8,["modelValue","label","options"])]),n("div",se,[d(s,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.name"),modelValue:l.Name,"onUpdate:modelValue":e[2]||(e[2]=o=>l.Name=o)},null,8,["label","modelValue"]),d(s,{clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.startTime"),modelValue:l.Name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.Name=o)},null,8,["label","modelValue"]),d(s,{modelValue:l.EndTime,"onUpdate:modelValue":e[4]||(e[4]=o=>l.EndTime=o),clearable:"","clearable-icon":"cancel",color:"textPrimary",label:r(t)("form.endTime")},null,8,["modelValue","label"])])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),n("main",re,[d(A,{rowData:b.value,columnDefs:U.value,defaultColDef:B,animateRows:"true",class:"ag-theme-material h-full",onGridReady:e[6]||(e[6]=o=>w.value=o.api)},null,8,["rowData","columnDefs"])])])}}};export{me as default};

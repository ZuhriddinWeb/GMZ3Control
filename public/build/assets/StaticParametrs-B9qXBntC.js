import{u as $,c as G,r as m,E as z,f as P,g as O,h as E,j as d,k as n,z as R,l as N,i as v,t as C,n as D,d as A,V as L,m as ee,a as ae,s as I,o as te,K as le,F as oe,G as se,H as j}from"./app-Cd02JuBi.js";/* empty css                   */const ne={class:"h-full w-full text-center content-center"},re={class:"va-h3"},de={__name:"DeleteParam",props:["params"],setup(h){const{init:S}=$(),{t:r}=G(),g=m(!1),s=h,x=z("ondeleted"),y=async()=>{try{const{data:o}=await D.delete(`/static/${s.params.data.id}`);o.status===200?(x(s.params.data),g.value=!1,S({message:r("login.successMessage"),color:"success"})):console.error("Error deleting data:",o.message)}catch(o){console.error("Error deleting data:",o)}};return(o,V)=>{const w=P("VaModal");return E(),O("main",ne,[d(n(R),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:V[0]||(V[0]=b=>g.value=!0)}),d(w,{modelValue:g.value,"onUpdate:modelValue":V[1]||(V[1]=b=>g.value=b),"ok-text":n(r)("modals.apply"),"cancel-text":n(r)("modals.cancel"),onClose:V[2]||(V[2]=b=>g.value=!1),onOk:y,"close-button":""},{default:N(()=>[v("h3",re,C(n(r)("modals.title")),1),v("p",null,C(n(r)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ue={class:"h-full w-full text-center content-center"},ie={class:"flex gap-5 flex-wrap w-full mt-4"},me={__name:"EditParam",props:["params"],setup(h){const{init:S}=$(),{t:r}=G(),g=h,s=m(!1),x=z("onupdated"),y=m([]);m([]),m([]);const o=A({Value:"",PeriodTypeId:"",PeriodStartDate:"",PeriodEndDate:"",Comment:"",id:g.params.data.id}),V=async()=>{try{const[p,e]=await Promise.all([D.get("/periodType"),D.get(`static/${g.params.data.id}`)]);y.value=p.data.map(t=>({value:t.id,text:t.name})),o.Value=+e.data.value,o.PeriodTypeId=+e.data.period_type_id,o.PeriodStartDate=e.data.period_start_date?new Date(e.data.period_start_date):null,o.PeriodEndDate=e.data.period_end_date?new Date(e.data.period_end_date):null,o.Comment=e.data.Comment}catch(p){console.error("Error fetching data:",p)}},w=p=>{if(!p)return null;const e=new Date(p);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().split("T")[0]},b=async()=>{try{const p={...o,PeriodStartDate:w(o.PeriodStartDate),PeriodEndDate:w(o.PeriodEndDate)},{data:e}=await D.put("/static",p);e.status===200?(x(g.params.node,e.unit),s.value=!1,S({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",e.message)}catch(p){console.error("Error saving data:",p)}};return(p,e)=>{const t=P("VaDatePicker"),T=P("VaSelect"),_=P("VaTextarea"),U=P("VaModal");return E(),O("main",ue,[d(n(R),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:e[0]||(e[0]=u=>s.value=!0)}),d(U,{modelValue:s.value,"onUpdate:modelValue":e[6]||(e[6]=u=>s.value=u),"ok-text":n(r)("modals.apply"),"cancel-text":n(r)("modals.cancel"),onOk:b,onClose:e[7]||(e[7]=u=>s.value=!1),"close-button":""},{default:N(()=>[v("h3",{class:"va-h3",onVnodeMounted:V},C(n(r)("modals.editFactory")),513),v("div",null,[d(n(L),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[d(n(ee),{class:"w-full",modelValue:o.Value,"onUpdate:modelValue":e[1]||(e[1]=u=>o.Value=u),rules:[u=>u&&u.length>0||n(r)("validation.required")],label:n(r)("table.value")},null,8,["modelValue","rules","label"]),v("div",ie,[d(t,{modelValue:o.PeriodStartDate,"onUpdate:modelValue":e[2]||(e[2]=u=>o.PeriodStartDate=u),stateful:"","highlight-weekend":""},null,8,["modelValue"]),d(t,{modelValue:o.PeriodEndDate,"onUpdate:modelValue":e[3]||(e[3]=u=>o.PeriodEndDate=u),stateful:"","highlight-weekend":""},null,8,["modelValue"])]),d(T,{modelValue:o.PeriodTypeId,"onUpdate:modelValue":e[4]||(e[4]=u=>o.PeriodTypeId=u),"value-by":"value",class:"mb-6 w-full",label:n(r)("menu.paramtypes"),options:y.value,clearable:""},null,8,["modelValue","label","options"]),d(_,{class:"w-full",modelValue:o.Description,"onUpdate:modelValue":e[5]||(e[5]=u=>o.Description=u),"max-length":"125",label:n(r)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ce={class:"grid grid-rows-[55px,1fr]"},pe={class:"flex justify-between"},fe={class:"flex gap-5 flex-wrap w-full mt-4"},ve={class:"flex-grow"},De={__name:"StaticParametrs",props:{id:Number},setup(h){const S=ae(),r=h,{init:g}=$(),{t:s}=G(),x=m([]),y=m(null),o=m(!1),V=m([]);m([]);const w=m([]),b=m([]),p=m([]),e=m([]);m([]);const t=A({FactoryStructureID:"",ParameterID:"",Value:"",NumberPage:r.id,GroupID:"",PeriodTypeId:"",PeriodStartDate:null,PeriodEndDate:null,Comment:""}),T=I(()=>S.state.user.roles[10]),_=l=>{var a,c;return((c=(a=T.value)==null?void 0:a.pivot)==null?void 0:c[l])==="1"},U=I(()=>_("create")),u=I(()=>_("update")),q=I(()=>_("delete"));function H(l){y.value.applyTransaction({remove:[l]})}function K(l,a){l.setData(a)}j("ondeleted",H),j("onupdated",K);const W=I(()=>{const l=[{headerName:s("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:s("table.id"),field:"Uuid",hide:!0,flex:1},{headerName:s("table.name"),field:"PName",flex:1},{headerName:s("menu.paramtypes"),field:"PTName"},{headerName:s("menu.units"),field:"UName"},{headerName:s("table.value"),field:"value"},{headerName:s("table.startingDay"),field:"period_start_date"},{headerName:s("table.endingDay"),field:"period_end_date"},{headerName:s("table.comment"),field:"Comment",flex:1}];return u.value&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:me}),q.value&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:de}),l}),J={sortable:!0,filter:!0};console.log(r.id);const M=async()=>{const{data:l}=await D.get(`/staticCard/${r.id}`);x.value=Array.isArray(l)?l:l.items},Q=async()=>{try{const l=await D.get("/param"),a=await D.get("/periodType"),c=await D.get("/structure"),k=await D.get("/pages-svodka/22");w.value=l.data.map(f=>({value:f.Uuid,text:f.Name})),b.value=c.data.map(f=>({value:f.id,text:f.Name})),V.value=a.data.map(f=>({value:f.id,text:f.name})),p.value=k.data.map(f=>({value:f.NumberPage,text:f.Name})),t.NumberPage&&await F()}catch(l){console.error("Error fetching graphics data:",l)}},F=async()=>{try{const l=r.id||t.NumberPage;if(!l){e.value=[],t.GroupID=null;return}const{data:a}=await D.get(`/getRowGroupWith/${l}`);e.value=a.map(c=>({value:c.id,text:c.Name})),e.value.some(c=>c.value===t.GroupID)||(t.GroupID=null)}catch(l){e.value=[],t.GroupID=null,console.error("Error fetching groups:",l)}},B=l=>{if(!l)return null;const a=new Date(l);return a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a.toISOString().split("T")[0]},X=async()=>{try{const l={...t,PeriodStartDate:B(t.PeriodStartDate),PeriodEndDate:B(t.PeriodEndDate)},{data:a}=await D.post("/static",l);a.status===200?(o.value=!1,t.FactoryStructureID="",t.ParameterID="",t.Value="",t.Comment="",t.NumberPage="",t.PeriodTypeId="",t.PeriodStartDate=null,t.PeriodEndDate=null,await M(),g({message:s("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(l){console.error("Error saving data:",l)}};return te(()=>{M(),t.NumberPage=r.id,F()}),le(()=>r.id,M),(l,a)=>{const c=P("VaSelect"),k=P("VaDatePicker"),f=P("VaTextarea"),Y=P("VaModal"),Z=P("ag-grid-vue");return E(),O("div",ce,[v("main",null,[v("div",pe,[a[10]||(a[10]=v("span",{class:"flex w-full"},null,-1)),U.value?(E(),oe(n(R),{key:0,onClick:a[0]||(a[0]=i=>o.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):se("",!0)]),d(Y,{modelValue:o.value,"onUpdate:modelValue":a[8]||(a[8]=i=>o.value=i),"ok-text":n(s)("modals.apply"),"cancel-text":n(s)("modals.cancel"),onOk:X,"close-button":""},{default:N(()=>[v("h3",{class:"va-h3",onVnodeMounted:Q},C(n(s)("modals.addParamsTitle")),513),v("div",null,[d(n(L),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[d(c,{modelValue:t.FactoryStructureID,"onUpdate:modelValue":[a[1]||(a[1]=i=>t.FactoryStructureID=i),l.getPages],"value-by":"value",class:"mb-1 w-full",label:n(s)("menu.structure"),options:b.value,clearable:""},null,8,["modelValue","onUpdate:modelValue","label","options"]),d(c,{modelValue:t.ParameterID,"onUpdate:modelValue":a[2]||(a[2]=i=>t.ParameterID=i),"value-by":"value",class:"mb-1 w-full",label:n(s)("menu.params"),options:w.value,searchable:"",clearable:""},null,8,["modelValue","label","options"]),d(c,{modelValue:t.GroupID,"onUpdate:modelValue":a[3]||(a[3]=i=>t.GroupID=i),"value-by":"value",class:"mb-1 w-full",label:n(s)("menu.groups"),options:e.value,searchable:""},null,8,["modelValue","label","options"]),v("div",fe,[d(k,{modelValue:t.PeriodStartDate,"onUpdate:modelValue":a[4]||(a[4]=i=>t.PeriodStartDate=i),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),d(k,{modelValue:t.PeriodEndDate,"onUpdate:modelValue":a[5]||(a[5]=i=>t.PeriodEndDate=i),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),d(c,{modelValue:t.PeriodTypeId,"onUpdate:modelValue":a[6]||(a[6]=i=>t.PeriodTypeId=i),"value-by":"value",class:"mb-6 w-full",label:n(s)("menu.paramtypes"),options:V.value,clearable:""},null,8,["modelValue","label","options"]),d(f,{class:"w-full",modelValue:t.Comment,"onUpdate:modelValue":a[7]||(a[7]=i=>t.Comment=i),"max-length":"125",label:n(s)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),v("main",ve,[d(Z,{rowData:x.value,columnDefs:W.value,defaultColDef:J,animateRows:"true",class:"ag-theme-material h-full",onGridReady:a[9]||(a[9]=i=>y.value=i.api)},null,8,["rowData","columnDefs"])])])}}};export{De as default};

import{r as y,c as E,G as R,f,g as w,h as V,k as m,l as k,i as s,t as b,j as r,m as C,u as A,d as P,o as B,D as G,M as q,N as j,L as M,H as S,x as T}from"./app-914dfeee.js";/* empty css                   */const z={class:"h-full w-full text-center content-center"},H={class:"va-h3"},Y={__name:"DeleteUserModal",props:["params"],setup($){const p=y(!1),l=$,{t:i}=E(),x=R("ondeleted"),h=async()=>{try{const{data:u}=await C.delete(`/units/${l.params.data.id}`);u.status===200?(x(l.params.data),p.value=!1):console.error("Error deleting data:",u.message)}catch(u){console.error("Error deleting data:",u)}};return(u,t)=>{const _=f("VaButton"),g=f("VaModal");return w(),V("main",z,[m(_,{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:t[0]||(t[0]=v=>p.value=!0)}),m(g,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=v=>p.value=v),"ok-text":r(i)("modals.apply"),"cancel-text":r(i)("modals.cancel"),onClose:t[2]||(t[2]=v=>p.value=!1),onOk:h,"close-button":""},{default:k(()=>[s("h3",H,b(r(i)("modals.title")),1),s("p",null,b(r(i)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}};const J={class:"h-full w-full text-center content-center"},K={class:"va-h3"},Q={class:"va-table-responsive"},W={class:"va-table va-table--clickable w-full"},X=s("thead",null,[s("tr",null,[s("th",null,"Nomi"),s("th",null,"Ruxsat"),s("th",null,"Yaratish"),s("th",null,"O'zgartirish"),s("th",null,"O'chirish")])],-1),Z={key:0},ee={key:1},te={key:2},ae={__name:"RolesComponent",props:["params"],setup($){const p=$,l=y(!1);R("onupdated");const i=y([]),{init:x}=A(),{locale:h,t:u}=E(),t=P({id:p.params.data.id,userName:p.params.data.name}),_=(c,a)=>{c[a]=!c[a],console.log(`${a} for ${c.name} changed to ${c[a]}`)},g=c=>c?"success":"danger";async function v(){C.get(`/user_role/${p.params.data.id}`).then(c=>{c.data.forEach(a=>{const e=i.value.find(n=>n.id==a.role_id);e!=null&&(e.view=a.view,e.create=a.create,e.update=a.update,e.delete=a.delete)})})}async function U(){try{const c=await C.get("/role");i.value=Array.isArray(c.data)?c.data:c.data.items,i.value.forEach(a=>{a.id=a.id,a.view=a.view||!1,a.create=a.create||!1,a.update=a.update||!1,a.delete=a.delete||!1})}catch(c){console.error("Error fetching data:",c)}}const D=async()=>{try{const c=i.value.map(e=>({id:e.id,name:e.name,view:e.view,create:e.create,edit:e.update,delete:e.delete})),{data:a}=await C.post("/user_role",{...t,roles:c});a.status===200?(l.value=!1,x({message:u("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(c){console.error("Error saving data:",c)}};return B(async()=>{await U(),v()}),(c,a)=>{const e=f("VaSwitch"),n=f("VaModal");return w(),V("main",J,[m(r(G),{round:"",icon:"settings",preset:"primary",class:"mt-1",onClick:a[0]||(a[0]=d=>l.value=!0)}),m(n,{"max-width":"45%",modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=d=>l.value=d),"ok-text":r(u)("modals.apply"),"cancel-text":r(u)("modals.cancel"),onOk:D,onClose:a[2]||(a[2]=d=>l.value=!1),"close-button":""},{default:k(()=>[s("h3",null,[s("span",K,b(r(u)("table.user"))+" : "+b(t.userName),1)]),s("div",null,[s("div",Q,[s("table",W,[X,s("tbody",null,[(w(!0),V(q,null,j(i.value,d=>(w(),V("tr",{key:d.id},[s("td",null,b(r(u)(`${d.name}`)),1),s("td",null,[m(e,{"model-value":d.view,onChange:()=>_(d,"view"),color:g(d.view)},null,8,["model-value","onChange","color"])]),d.view?(w(),V("td",Z,[m(e,{"model-value":d.create,onChange:()=>_(d,"create"),color:g(d.create)},null,8,["model-value","onChange","color"])])):M("",!0),d.view?(w(),V("td",ee,[m(e,{"model-value":d.update,onChange:()=>_(d,"update"),color:g(d.update)},null,8,["model-value","onChange","color"])])):M("",!0),d.view?(w(),V("td",te,[m(e,{"model-value":d.delete,onChange:()=>_(d,"delete"),color:g(d.delete)},null,8,["model-value","onChange","color"])])):M("",!0)]))),128))])])])])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},le={class:"h-full w-full text-center content-center"},oe={class:"va-h3"},se={__name:"RestartPassword",props:["params"],setup($){const p=$,{t:l}=E(),i=y(!1),x=R("onupdated"),h=async()=>{try{const{data:u}=await C.get(`/restart-password/${p.params.data.id}`);u.status===200?(x(p.params.node,u.unit),i.value=!1):console.error("Error deleting data:",u.message)}catch(u){console.error("Error deleting data:",u)}};return(u,t)=>{const _=f("VaButton"),g=f("VaModal");return w(),V("main",le,[m(_,{round:"",icon:"restart_alt",preset:"primary",class:"mt-1",onClick:t[0]||(t[0]=v=>i.value=!0)}),m(g,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=v=>i.value=v),"ok-text":r(l)("modals.apply"),"cancel-text":r(l)("modals.cancel"),onClose:t[2]||(t[2]=v=>i.value=!1),onOk:h,"close-button":""},{default:k(()=>[s("h3",oe,b(r(l)("modals.restart")),1),s("p",null,b(r(l)("modals.messageRestart")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}};const ne={class:"grid grid-rows-[55px,1fr]"},re={class:"flex justify-between"},de=s("span",{class:"flex w-full"},null,-1),ue={class:"va-h3"},ce={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},ie={class:"flex-grow"},fe={__name:"UsersPage",setup($){const{locale:p,t:l}=E(),i=y([]),x=y(null),h=y(!1),u=y([]),t=P({Name:"",Phone:"",Login:"",Password:"",StructureID:[]});function _(e){x.value.applyTransaction({remove:[e]})}function g(e,n){e.setData(n)}S("ondeleted",_),S("onupdated",g);const v=T(()=>[{headerName:l("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:l("table.userName"),field:"name",flex:1},{headerName:l("table.login"),field:"login",flex:1},{headerName:l("table.phone"),field:"phone"},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ae},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:se},{cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:Y}]),U={sortable:!0,filter:!0},D=async()=>{try{const e=await C.get("/users");i.value=Array.isArray(e.data)?e.data:e.data.items}catch(e){console.error("Error fetching data:",e)}},c=async()=>{try{const e=await C.get("/structure");u.value=e.data.map(n=>({value:n.id,text:n.Name}))}catch(e){console.error("Error fetching graphics data:",e)}},a=async()=>{try{const{data:e}=await C.post("/users",t);e.status===200?(h.value=!1,t.Name="",t.Phone="",t.Login="",t.Password="",t.StructureID=[],await D()):console.error("Error saving data:",e.message)}catch(e){console.error("Error saving data:",e)}};return B(()=>{const e=localStorage.getItem("locale");e&&(p.value=e),D(),c()}),(e,n)=>{const d=f("VaButton"),I=f("VaSelect"),N=f("VaInput"),F=f("VaForm"),L=f("VaModal"),O=f("ag-grid-vue");return w(),V("div",ne,[s("main",null,[s("div",re,[de,m(d,{onClick:n[0]||(n[0]=o=>h.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})]),m(L,{modelValue:h.value,"onUpdate:modelValue":n[6]||(n[6]=o=>h.value=o),"ok-text":r(l)("buttons.save"),"cancel-text":r(l)("buttons.cancel"),onOk:a,"close-button":""},{default:k(()=>[s("h3",ue,b(r(l)("modals.addUserTitle")),1),s("div",null,[m(F,{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:k(()=>[s("div",ce,[m(I,{modelValue:t.StructureID,"onUpdate:modelValue":n[1]||(n[1]=o=>t.StructureID=o),label:r(l)("form.structureName"),options:u.value,multiple:""},null,8,["modelValue","label","options"])]),m(N,{class:"w-full",modelValue:t.Name,"onUpdate:modelValue":n[2]||(n[2]=o=>t.Name=o),rules:[o=>o&&o.length>0||r(l)("form.requiredField")],label:r(l)("form.userName")},null,8,["modelValue","rules","label"]),m(N,{class:"w-full",modelValue:t.Phone,"onUpdate:modelValue":n[3]||(n[3]=o=>t.Phone=o),rules:[o=>o&&o.length>0||r(l)("form.requiredField")],type:"tel",label:r(l)("form.userPhone"),placeholder:"597****"},null,8,["modelValue","rules","label"]),m(N,{class:"w-full",modelValue:t.Login,"onUpdate:modelValue":n[4]||(n[4]=o=>t.Login=o),rules:[o=>o&&o.length>0||r(l)("form.requiredField")],label:r(l)("form.login")},null,8,["modelValue","rules","label"]),m(N,{class:"w-full",modelValue:t.Password,"onUpdate:modelValue":n[5]||(n[5]=o=>t.Password=o),rules:[o=>o&&o.length>0||r(l)("form.requiredField")],label:r(l)("form.password")},null,8,["modelValue","rules","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),s("main",ie,[m(O,{rowData:i.value,columnDefs:v.value,defaultColDef:U,animateRows:"true",class:"ag-theme-material h-full",onGridReady:n[7]||(n[7]=o=>x.value=o.api)},null,8,["rowData","columnDefs"])])])}}};export{fe as default};

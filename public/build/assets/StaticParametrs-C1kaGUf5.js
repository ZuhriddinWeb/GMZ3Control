import{u as M,c as $,r as m,E as z,f as D,g as G,h as E,j as n,k as s,z as O,l as N,i as p,t as C,n as V,d as A,V as L,m as Z,a as ee,s as _,o as ae,F as te,G as le,H as j}from"./app-c0G7Ml5G.js";/* empty css                   */const oe={class:"h-full w-full text-center content-center"},se={class:"va-h3"},ne={__name:"DeleteParam",props:["params"],setup(I){const{init:S}=M(),{t:i}=$(),l=m(!1),f=I,x=z("ondeleted"),b=async()=>{try{const{data:o}=await V.delete(`/static/${f.params.data.id}`);o.status===200?(x(f.params.data),l.value=!1,S({message:i("login.successMessage"),color:"success"})):console.error("Error deleting data:",o.message)}catch(o){console.error("Error deleting data:",o)}};return(o,v)=>{const y=D("VaModal");return E(),G("main",oe,[n(s(O),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:v[0]||(v[0]=P=>l.value=!0)}),n(y,{modelValue:l.value,"onUpdate:modelValue":v[1]||(v[1]=P=>l.value=P),"ok-text":s(i)("modals.apply"),"cancel-text":s(i)("modals.cancel"),onClose:v[2]||(v[2]=P=>l.value=!1),onOk:b,"close-button":""},{default:N(()=>[p("h3",se,C(s(i)("modals.title")),1),p("p",null,C(s(i)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},re={class:"h-full w-full text-center content-center"},de={class:"flex gap-5 flex-wrap w-full mt-4"},ue={__name:"EditParam",props:["params"],setup(I){const{init:S}=M(),{t:i}=$(),l=I,f=m(!1),x=z("onupdated"),b=m([]);m([]),m([]);const o=A({Value:"",PeriodTypeId:"",PeriodStartDate:"",PeriodEndDate:"",Comment:"",id:l.params.data.id}),v=async()=>{try{const[u,e]=await Promise.all([V.get("/periodType"),V.get(`static/${l.params.data.id}`)]);b.value=u.data.map(w=>({value:w.id,text:w.name})),o.Value=+e.data.value,o.PeriodTypeId=+e.data.period_type_id,o.PeriodStartDate=e.data.period_start_date?new Date(e.data.period_start_date):null,o.PeriodEndDate=e.data.period_end_date?new Date(e.data.period_end_date):null,o.Comment=e.data.Comment}catch(u){console.error("Error fetching data:",u)}},y=u=>{if(!u)return null;const e=new Date(u);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().split("T")[0]},P=async()=>{try{const u={...o,PeriodStartDate:y(o.PeriodStartDate),PeriodEndDate:y(o.PeriodEndDate)},{data:e}=await V.put("/static",u);e.status===200?(x(l.params.node,e.unit),f.value=!1,S({message:i("login.successMessage"),color:"success"})):console.error("Error saving data:",e.message)}catch(u){console.error("Error saving data:",u)}};return(u,e)=>{const w=D("VaDatePicker"),h=D("VaSelect"),T=D("VaTextarea"),U=D("VaModal");return E(),G("main",re,[n(s(O),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:e[0]||(e[0]=d=>f.value=!0)}),n(U,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=d=>f.value=d),"ok-text":s(i)("modals.apply"),"cancel-text":s(i)("modals.cancel"),onOk:P,onClose:e[7]||(e[7]=d=>f.value=!1),"close-button":""},{default:N(()=>[p("h3",{class:"va-h3",onVnodeMounted:v},C(s(i)("modals.editFactory")),513),p("div",null,[n(s(L),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[n(s(Z),{class:"w-full",modelValue:o.Value,"onUpdate:modelValue":e[1]||(e[1]=d=>o.Value=d),rules:[d=>d&&d.length>0||s(i)("validation.required")],label:s(i)("table.value")},null,8,["modelValue","rules","label"]),p("div",de,[n(w,{modelValue:o.PeriodStartDate,"onUpdate:modelValue":e[2]||(e[2]=d=>o.PeriodStartDate=d),stateful:"","highlight-weekend":""},null,8,["modelValue"]),n(w,{modelValue:o.PeriodEndDate,"onUpdate:modelValue":e[3]||(e[3]=d=>o.PeriodEndDate=d),stateful:"","highlight-weekend":""},null,8,["modelValue"])]),n(h,{modelValue:o.PeriodTypeId,"onUpdate:modelValue":e[4]||(e[4]=d=>o.PeriodTypeId=d),"value-by":"value",class:"mb-6 w-full",label:s(i)("menu.paramtypes"),options:b.value,clearable:""},null,8,["modelValue","label","options"]),n(T,{class:"w-full",modelValue:o.Description,"onUpdate:modelValue":e[5]||(e[5]=d=>o.Description=d),"max-length":"125",label:s(i)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},ie={class:"grid grid-rows-[55px,1fr]"},me={class:"flex justify-between"},ce={class:"flex gap-5 flex-wrap w-full mt-4"},pe={class:"flex-grow"},Ve={__name:"StaticParametrs",setup(I){const S=ee(),{init:i}=M(),{t:l}=$(),f=m([]),x=m(null),b=m(!1),o=m([]);m([]);const v=m([]),y=m([]),P=m([]),u=m([]);m([]);const e=A({FactoryStructureID:"",ParameterID:"",Value:"",NumberPage:"",GroupID:"",PeriodTypeId:"",PeriodStartDate:null,PeriodEndDate:null,Comment:""}),w=_(()=>S.state.user.roles[10]),h=t=>{var a,g;return((g=(a=w.value)==null?void 0:a.pivot)==null?void 0:g[t])==="1"},T=_(()=>h("create")),U=_(()=>h("update")),d=_(()=>h("delete"));function q(t){x.value.applyTransaction({remove:[t]})}function H(t,a){t.setData(a)}j("ondeleted",q),j("onupdated",H);const W=_(()=>{const t=[{headerName:l("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80},{headerName:l("table.id"),field:"Uuid",hide:!0,flex:1},{headerName:l("table.name"),field:"PName",flex:1},{headerName:l("menu.paramtypes"),field:"PTName"},{headerName:l("menu.units"),field:"UName"},{headerName:l("table.value"),field:"value"},{headerName:l("table.startingDay"),field:"period_start_date"},{headerName:l("table.endingDay"),field:"period_end_date"},{headerName:l("table.comment"),field:"Comment",flex:1}];return U.value&&t.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ue}),d.value&&t.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ne}),t}),J={sortable:!0,filter:!0},R=async()=>{try{const t=await V.get("/static");f.value=Array.isArray(t.data)?t.data:t.data.items}catch(t){console.error("Error fetching data:",t)}},K=async()=>{try{const t=await V.get("/param"),a=await V.get("/periodType"),g=await V.get("/structure"),k=await V.get("/pages-svodka/22");v.value=t.data.map(c=>({value:c.Uuid,text:c.Name})),y.value=g.data.map(c=>({value:c.id,text:c.Name})),o.value=a.data.map(c=>({value:c.id,text:c.name})),P.value=k.data.map(c=>({value:c.NumberPage,text:c.Name})),e.NumberPage&&await F()}catch(t){console.error("Error fetching graphics data:",t)}},F=async()=>{if(!e.NumberPage){u.value=[],e.GroupID=null;return}try{const{data:t}=await V.get(`/getRowGroupWith/${e.NumberPage}`);u.value=t.map(a=>({value:a.id,text:a.Name})),u.value.some(a=>a.value===e.GroupID)||(e.GroupID=null)}catch(t){u.value=[],e.GroupID=null,console.error("Error fetching groups:",t)}},B=t=>{if(!t)return null;const a=new Date(t);return a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a.toISOString().split("T")[0]},Q=async()=>{try{const t={...e,PeriodStartDate:B(e.PeriodStartDate),PeriodEndDate:B(e.PeriodEndDate)},{data:a}=await V.post("/static",t);a.status===200?(b.value=!1,e.FactoryStructureID="",e.ParameterID="",e.Value="",e.Comment="",e.NumberPage="",e.PeriodTypeId="",e.PeriodStartDate=null,e.PeriodEndDate=null,await R(),i({message:l("login.successMessage"),color:"success"})):console.error("Error saving data:",a.message)}catch(t){console.error("Error saving data:",t)}};return ae(()=>{R()}),(t,a)=>{const g=D("VaSelect"),k=D("VaDatePicker"),c=D("VaTextarea"),X=D("VaModal"),Y=D("ag-grid-vue");return E(),G("div",ie,[p("main",null,[p("div",me,[a[11]||(a[11]=p("span",{class:"flex w-full"},null,-1)),T.value?(E(),te(s(O),{key:0,onClick:a[0]||(a[0]=r=>b.value=!0),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):le("",!0)]),n(X,{modelValue:b.value,"onUpdate:modelValue":a[9]||(a[9]=r=>b.value=r),"ok-text":s(l)("modals.apply"),"cancel-text":s(l)("modals.cancel"),onOk:Q,"close-button":""},{default:N(()=>[p("h3",{class:"va-h3",onVnodeMounted:K},C(s(l)("modals.addParamsTitle")),513),p("div",null,[n(s(L),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:N(()=>[n(g,{modelValue:e.FactoryStructureID,"onUpdate:modelValue":[a[1]||(a[1]=r=>e.FactoryStructureID=r),t.getPages],"value-by":"value",class:"mb-1 w-full",label:s(l)("menu.structure"),options:y.value,clearable:""},null,8,["modelValue","onUpdate:modelValue","label","options"]),n(g,{modelValue:e.ParameterID,"onUpdate:modelValue":a[2]||(a[2]=r=>e.ParameterID=r),"value-by":"value",class:"mb-1 w-full",label:s(l)("menu.params"),options:v.value,searchable:"",clearable:""},null,8,["modelValue","label","options"]),n(g,{modelValue:e.NumberPage,"onUpdate:modelValue":[a[3]||(a[3]=r=>e.NumberPage=r),F],"value-by":"value",class:"mb-1 w-full",label:s(l)("table.page"),options:P.value,clearable:""},null,8,["modelValue","label","options"]),n(g,{modelValue:e.GroupID,"onUpdate:modelValue":a[4]||(a[4]=r=>e.GroupID=r),"value-by":"value",class:"mb-1 w-full",label:s(l)("menu.groups"),options:u.value,searchable:""},null,8,["modelValue","label","options"]),p("div",ce,[n(k,{modelValue:e.PeriodStartDate,"onUpdate:modelValue":a[5]||(a[5]=r=>e.PeriodStartDate=r),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"]),n(k,{modelValue:e.PeriodEndDate,"onUpdate:modelValue":a[6]||(a[6]=r=>e.PeriodEndDate=r),stateful:"","highlight-weekend":"","text-input":!0},null,8,["modelValue"])]),n(g,{modelValue:e.PeriodTypeId,"onUpdate:modelValue":a[7]||(a[7]=r=>e.PeriodTypeId=r),"value-by":"value",class:"mb-6 w-full",label:s(l)("menu.paramtypes"),options:o.value,clearable:""},null,8,["modelValue","label","options"]),n(c,{class:"w-full",modelValue:e.Comment,"onUpdate:modelValue":a[8]||(a[8]=r=>e.Comment=r),"max-length":"125",label:s(l)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),p("main",pe,[n(Y,{rowData:f.value,columnDefs:W.value,defaultColDef:J,animateRows:"true",class:"ag-theme-material h-full",onGridReady:a[10]||(a[10]=r=>x.value=r.api)},null,8,["rowData","columnDefs"])])])}}};export{Ve as default};

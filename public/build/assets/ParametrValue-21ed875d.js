import{b as Ce,c as Ve,r as s,F as o,d as K,x as z,M as ye,o as Ne,N as De,f as p,g as I,h as W,i as b,k as c,l as T,j as w,H as j,I as xe,m as f,V as Ee,n as Fe,D as Q,K as Ie,L as Te,B as ke,t as _e,O as Re}from"./app-c8fa83ea.js";/* empty css                   */import{_ as Se}from"./EditValue-d58846c9.js";import{f as M}from"./format-45c98358.js";import"./_commonjs-dynamic-modules-302442b1.js";const Pe={class:"grid grid-rows-[55px,1fr]"},Me=b("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Ae={class:"flex flex-col"},$e={class:"m-2 flex"},Ue="yyyy-MM-dd",Be=8*60,Le=19*60+59,ze={__name:"ParametrValue",props:{id:Number},setup(J){const k=J,X=Ce(),{t:n,locale:Y}=Ve(),A=s([]),u=s(null),g=s({}),$=s([]),_=s(new Date),Z=s(null),x=s(null),ee=s(null),U=s(null);s(null);const v=s(null),ae=o.state.user.id;o.state.user.structure_id;const m=s(null);s([]);const te=s([]),E=s([]);s([]),s([]),s(0);const C=K({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:o.state.user.structure_id,SourceID:"",userId:o.state.user.id}),i=K({id:"",Comment:"",Value:"",userId:o.state.user.id}),B=s([{headerName:n("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0,cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=g.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=g.value)==null?void 0:a[e.data.id])&&((t=g.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"}},{headerName:n("table.change"),field:"Change",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.parameters"),field:z(()=>Y.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.graphictimes"),headerClass:"header-center",children:[{headerName:n("table.startingTime"),field:"STime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>M(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.interval"),headerClass:"header-center",children:[{headerName:n("table.min"),field:"Min",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0},{headerName:n("table.max"),field:"Max",width:100,headerClass:"header-center",editable:!1,suppressNavigable:!0}]},{headerName:n("table.value"),field:"Value",width:150,editable:e=>e.data&&e.data.WithFormula!=="1",suppressNavigable:!1,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>{var a;return e.data&&e.data.Value===((a=g.value)==null?void 0:a[e.data.id])},"cell-yellow":e=>{var a,t;return e.data&&e.data.Value!==((a=g.value)==null?void 0:a[e.data.id])&&((t=g.value)==null?void 0:t[e.data.id])===void 0&&e.data.WithFormula!=="1"},"cell-pink":e=>e.data&&e.data.WithFormula==="1"},cellStyle:e=>({"font-size":"16px","text-align":"center"}),headerClass:"header-center"},{headerName:n("table.comment"),field:"Comment",flex:1,editable:!0,suppressNavigable:!1,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]),le=e=>{e.key===" "&&(e.preventDefault(),e.shiftKey?m.value>1?m.value-=1:m.value=E.value.length:m.value<E.value.length?m.value+=1:m.value=1)},se=e=>{(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(e.preventDefault(),document.activeElement.classList.contains("ag-cell")&&u.navigateToNextCell({key:e.key}))},re=()=>{window.addEventListener("keydown",e=>{e.key===" "&&handleSpaceKeyForTabs(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&se(e)})};function ne(){const e=U.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const L=async()=>{try{const e=await f.get("/changes"),a=await f.get(`/pages-select/${k.id}`);E.value=a.data;const t=await f.get(`/paramWithId/${k.id}`);$.value=e.data.map(r=>({value:r.Change,text:r.Change})),te.value=t.data.map(r=>({value:r.Pid,text:r.PName}))}catch(e){console.error("Error fetching graphics data:",e)}},oe={sortable:!0,filter:!0,resizable:!0},ue=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",q={columnDefs:B.value,suppressScrollOnNewData:!0,getRowClass:ue,headerHeight:27,rowHeight:30,navigateToNextCell:e=>{const{key:a}=e.event;return a==="ArrowUp"||a==="ArrowDown"||a==="ArrowLeft"||a==="ArrowRight"?!0:e.previousCellDef}},de=e=>{},ie=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},O=()=>{const e=ie();return e>=Be&&e<=Le?1:2},ce=()=>{X.push("/vparamsget")};C.Change=O(),z(()=>O());async function R(e){o.state.newValue=e;const a=C.Change,t=M(_.value,Ue);o.state.ValueDay=t,new Date().getHours();try{const[r,N]=await f.all([f.get(`/get-params-for-user/${k.id}/${a}/${t}/${e}`),f.get(`/vparams-value/${o.state.user.structure_id}/${t}/${a}`)]),d=r.data,D=N.data;d.forEach((h,l)=>{const H=D.find(G=>G.TimeStr==h.GTName&&G.ParametersID==h.ParametersID);H&&(d[l]={...h,...H})}),A.value=d}catch(r){console.error("Error fetching data:",r)}}const me=async e=>{const{data:a,colDef:t,newValue:r,oldValue:N}=e;if(r!==N)try{await fe(a);const d=e.rowIndex,D=u.value.getDisplayedRowCount();if(u.value&&u.value.ensureIndexVisible(d,"bottom"),d<D-1){u.value.stopEditing();const h=t.field==="Value"?"Value":"Comment";u.value.setFocusedCell(d+1,h)}}catch(d){console.error("Error saving data",d)}},fe=async e=>{const a=C.Change,t=o.state.ValueDay;try{const r=await f.post("/vparams",{...e,userId:ae,change:a,daySelect:t});return he(),R(o.state.newValue),r}catch(r){console.error("Error saving data",r)}},he=()=>{u.value&&u.value.clearFocusedCell()},ge=()=>{F.value&&u.value&&(u.value.stopEditing(),F.value=!1)};let V=null,y=null,F=s(!1);const ve=e=>{const{column:a}=e;if(a){const t=a.getColId();t==="Value"||t==="Comment"?(P(),F.value=!0,v.value&&clearTimeout(v.value),v.value=setTimeout(ge,6e4)):S()}},pe=e=>{const{column:a}=e;if(a){const t=a.getColId();(t==="Value"||t==="Comment")&&(P(),F.value=!1,v.value&&(clearTimeout(v.value),v.value=null))}},S=()=>{V||(o.state.newValue=o.state.newValue||1,V=setInterval(()=>R(o.state.newValue),6e4)),y||(y=setInterval(L,6e4))},we=async e=>{try{const{data:a}=await f.post("/vparamsEdit",i);a.status===200?(Z.value=!1,i.id="",i.Comment="",i.Value="",i.userId="",e.setData(a.updatedRowData),q.api.refreshCells()):console.error("Error saving data:",a.message)}catch(a){console.error("Error saving data:",a)}},P=()=>{V&&(clearInterval(V),V=null),y&&(clearInterval(y),y=null)},be=e=>{u.value=e.api,e.api.addEventListener("cellFocused",ve),e.api.addEventListener("cellBlurred",pe),S()};return ye(m,e=>{R(e)}),Ne(()=>{L(),S(),re()}),De(()=>{P()}),(e,a)=>{const t=p("VaTextarea"),r=p("VaModal"),N=p("VaDateInput"),d=p("VaSelect"),D=p("VaTab"),h=p("ag-grid-vue");return I(),W("div",Pe,[b("main",null,[c(r,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=l=>x.value=l),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:a[3]||(a[3]=l=>we(ee.value)),"close-button":""},{default:T(()=>[Me,b("div",null,[c(w(Ee),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:T(()=>[c(w(Fe),{class:"w-full",modelValue:i.Value,"onUpdate:modelValue":a[0]||(a[0]=l=>i.Value=l),rules:[l=>l&&l.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),c(t,{class:"w-full",modelValue:i.Comment,"onUpdate:modelValue":a[1]||(a[1]=l=>i.Comment=l),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),b("main",Ae,[b("div",$e,[c(N,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=l=>_.value=l),class:"mr-2",label:"Day"},null,8,["modelValue"]),c(d,{modelValue:C.Change,"onUpdate:modelValue":a[5]||(a[5]=l=>C.Change=l),"value-by":"value",label:w(n)("menu.changes"),options:$.value,clearable:""},null,8,["modelValue","label","options"]),c(w(Q),{onClick:ne,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),c(w(Q),{onClick:ce,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),b("div",{ref_key:"gridContainer",ref:U,class:"ag-grid-container h-full"},[c(w(Re),{modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=l=>m.value=l),stateful:"",grow:"",onKeydown:le,tabindex:"0"},{tabs:T(()=>[(I(!0),W(Ie,null,Te(E.value,l=>(I(),j(D,{key:l.NumberPage,name:l.NumberPage},{default:T(()=>[ke(_e(l.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),c(h,{rowData:A.value,columnDefs:B.value,defaultColDef:oe,gridOptions:q,animateRows:"true",class:"ag-theme-material h-full",onGridReady:be,onCellValueChanged:me,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),x.value?(I(),j(Se,{key:0,showModalEdit:x.value,resultEdit:i,onUpdate:de},null,8,["showModalEdit","resultEdit"])):xe("",!0)])])}}};export{ze as default};

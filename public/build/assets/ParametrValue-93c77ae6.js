import{b as Ce,c as Ve,r as s,d as G,x as H,I as z,o as we,J as be,f as p,g as T,h as L,i as V,k as c,l as _,j as C,K as j,L as Ie,m as n,V as De,n as xe,D as Q,M as Ee,N as Te,O as _e,B as ye,t as Ne}from"./app-726a9268.js";/* empty css                   */import{_ as Fe}from"./EditValue-7fd1e581.js";import{f as y}from"./format-45c98358.js";const ke={class:"grid grid-rows-[55px,1fr]"},Re=V("h3",{class:"va-h3"}," Qiymatni tahrirlash ",-1),Se={class:"flex flex-col"},$e={class:"m-2 flex"},A="yyyy-MM-dd",Pe=8*60,Me=19*60+59,He={__name:"ParametrValue",setup(Be){const J=Ce(),{t:o,locale:K}=Ve(),N=s([]),m=s(null),F=s({}),$=s([]),w=s(new Date),W=s(null),x=s(null),X=s(null),P=s(null);s(null);const f=s(null),Y=store.state.user.id,Z=store.state.user.structure_id,k=s(null);s([]);const ee=s([]),M=s([]),te=s([]),ae=s([]);s(0);const g=G({ParametersID:"",Change:"",Name:"",ShortName:"",Comment:"",GTime:"",Value:"",BlogsID:store.state.user.structure_id,SourceID:"",userId:store.state.user.id}),i=G({id:"",Comment:"",Value:"",userId:store.state.user.id}),B=s([{headerName:o("table.headerRow"),valueGetter:"node.rowIndex + 1",width:80,headerClass:"header-center"},{headerName:o("table.change"),field:"Change",width:80,headerClass:"header-center"},{headerName:o("table.OrderNumber"),field:"OrderNumber",width:80,headerClass:"header-center"},{headerName:o("table.parameters"),field:H(()=>K.value==="ru"?"PNameRus":"PName"),flex:1,headerClass:"header-center"},{headerName:o("table.graphictimes"),headerClass:"header-center",children:[{headerName:o("table.startingTime"),field:"STime",width:120,valueFormatter:e=>y(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"},{headerName:o("table.endingTime"),field:"ETime",width:120,valueFormatter:e=>y(new Date(`1970-01-01T${e.value}`),"HH:mm"),headerClass:"header-center"}]},{headerName:o("table.interval"),headerClass:"header-center",children:[{headerName:o("table.min"),field:"Min",width:100,headerClass:"header-center"},{headerName:o("table.max"),field:"Max",width:100,headerClass:"header-center"}]},{headerName:o("table.value"),field:"Value",width:150,editable:!0,cellEditor:"agNumberCellEditor",cellClassRules:{"cell-green":e=>e.data&&e.data.Value===F.value[e.data.id],"cell-yellow":e=>e.data&&e.data.Value!==F.value[e.data.id]&&F.value[e.data.id]===void 0},cellStyle:{"font-size":"16px","text-align":"center"},headerClass:"header-center"},{headerName:o("table.comment"),field:"Comment",flex:1,editable:!0,cellEditor:"agLargeTextCellEditor",cellEditorPopup:!0,headerClass:"header-center"}]);function le(){const e=P.value;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}const O=async()=>{try{const e=await n.get("/changes"),t=await n.get("/pages");M.value=t.data;const r=await n.get(`/paramWithId/${Z}`);$.value=e.data.map(a=>({value:a.Change,text:a.Change})),ee.value=r.data.map(a=>({value:a.Pid,text:a.PName}));const u=await n.get("/source");te.value=u.data.map(a=>({value:a.id,text:a.Name}));const d=await n.get("/graphictimes");ae.value=d.data.map(a=>({value:a.id,text:a.GName}))}catch(e){console.error("Error fetching graphics data:",e)}},se={sortable:!0,filter:!0,resizable:!0},re=e=>e.data.STime&&e.data.ETime&&e.data.Value?"row-green":"",q={columnDefs:B.value,getRowClass:re,headerHeight:43},ne=e=>{console.log("Updated Data:",e)},oe=()=>{const e=new Date;return e.getHours()*60+e.getMinutes()},U=()=>{const e=oe();return e>=Pe&&e<=Me?1:2},ue=()=>{J.push("/vparamsget")};g.Change=U(),H(()=>U());const b=async()=>{const e=g.Change,t=y(w.value,A);new Date().getHours();try{n.all([n.get(`/get-params-for-user/${store.state.user.structure_id}/${e}/${t}/1`),n.get(`/vparams-value/${store.state.user.structure_id}/${t}`)]).then(n.spread(({data:r},{data:u})=>{r.forEach((d,a)=>{const v=u.find(h=>h.TimeID==d.GTid&&h.ParametersID==d.ParametersID);v&&(r[a]={...d,...v})}),N.value=r}))}catch(r){console.error("Error fetching data:",r)}};async function de(e){const t=g.Change,r=y(w.value,A);new Date().getHours();try{n.all([n.get(`/get-params-for-user/${store.state.user.structure_id}/${t}/${r}/${e}`),n.get(`/vparams-value/${store.state.user.structure_id}/${r}`)]).then(n.spread(({data:u},{data:d})=>{u.forEach((a,v)=>{const h=d.find(l=>l.TimeID==a.GTid&&l.ParametersID==a.ParametersID);h&&(u[v]={...a,...h})}),N.value=u}))}catch(u){console.error("Error fetching data:",u)}}const ie=async e=>{const{data:t,colDef:r,newValue:u,oldValue:d}=e;if(u!==d)try{await ce(t);const a=e.rowIndex;m.value&&m.value.ensureIndexVisible(a,"bottom")}catch(a){console.error("Error saving data",a)}},ce=async e=>{console.log(e);try{const t=await n.post("/vparams",{...e,userId:Y});return me(),b(),t}catch(t){console.error("Error saving data",t)}},me=()=>{m.value&&m.value.clearFocusedCell()},he=()=>{E.value&&m.value&&(m.value.stopEditing(),E.value=!1,b())};let I=null,D=null,E=s(!1);const fe=e=>{const{column:t}=e;if(t){const r=t.getColId();r==="Value"||r==="Comment"?(S(),E.value=!0,f.value&&clearTimeout(f.value),f.value=setTimeout(he,6e4)):R()}},ge=e=>{const{column:t}=e;if(t){const r=t.getColId();(r==="Value"||r==="Comment")&&(S(),E.value=!1,f.value&&(clearTimeout(f.value),f.value=null))}},R=()=>{I||(I=setInterval(b,6e4)),D||(D=setInterval(O,6e4))},ve=async e=>{try{const{data:t}=await n.post("/vparamsEdit",i);t.status===200?(W.value=!1,i.id="",i.Comment="",i.Value="",i.userId="",e.setData(t.updatedRowData),q.api.refreshCells()):console.error("Error saving data:",t.message)}catch(t){console.error("Error saving data:",t)}},S=()=>{I&&(clearInterval(I),I=null),D&&(clearInterval(D),D=null)},pe=e=>{m.value=e.api,e.api.addEventListener("cellFocused",fe),e.api.addEventListener("cellBlurred",ge),R()};return z([()=>g.Change,()=>w.value],b),z(k,e=>{de(e)}),we(()=>{b(),O(),R()}),be(()=>{S()}),(e,t)=>{const r=p("VaTextarea"),u=p("VaModal"),d=p("VaDateInput"),a=p("VaSelect"),v=p("VaTab"),h=p("ag-grid-vue");return T(),L("div",ke,[V("main",null,[c(u,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=l=>x.value=l),"ok-text":"Saqlash","cancel-text":"Bekor qilish",onOk:t[3]||(t[3]=l=>ve(X.value)),"close-button":""},{default:_(()=>[Re,V("div",null,[c(C(De),{ref:"formRef",class:"flex flex-col items-baseline gap-2"},{default:_(()=>[c(C(xe),{class:"w-full",modelValue:i.Value,"onUpdate:modelValue":t[0]||(t[0]=l=>i.Value=l),rules:[l=>l&&l.length>0||"To'ldirish majburiy bo'lgan maydon"],label:"Qiymat"},null,8,["modelValue","rules"]),c(r,{class:"w-full",modelValue:i.Comment,"onUpdate:modelValue":t[1]||(t[1]=l=>i.Comment=l),"max-length":"125",label:"Izoh"},null,8,["modelValue"])]),_:1},512)])]),_:1},8,["modelValue"])]),V("main",Se,[V("div",$e,[c(d,{modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=l=>w.value=l),class:"mr-2",label:"Day"},null,8,["modelValue"]),c(a,{modelValue:g.Change,"onUpdate:modelValue":t[5]||(t[5]=l=>g.Change=l),"value-by":"value",label:C(o)("menu.changes"),options:$.value,clearable:""},null,8,["modelValue","label","options"]),c(C(Q),{onClick:le,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"fullscreen"}),c(C(Q),{onClick:ue,class:"btn btn-primary items-center justify-center mt-3 ml-3",icon:"grade"})]),V("div",{ref_key:"gridContainer",ref:P,class:"ag-grid-container h-full"},[c(C(_e),{modelValue:k.value,"onUpdate:modelValue":t[6]||(t[6]=l=>k.value=l),stateful:"",grow:""},{tabs:_(()=>[(T(!0),L(Ee,null,Te(M.value,l=>(T(),j(v,{key:l.id,name:l.id},{default:_(()=>[ye(Ne(l.Name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),c(h,{rowData:N.value,columnDefs:B.value,defaultColDef:se,gridOptions:q,animateRows:"true",class:"ag-theme-material h-full",onGridReady:pe,onCellValueChanged:ie,onCellDoubleClicked:e.onCellDoubleClicked},null,8,["rowData","columnDefs","onCellDoubleClicked"])],512),x.value?(T(),j(Fe,{key:0,showModalEdit:x.value,resultEdit:i,onUpdate:ne},null,8,["showModalEdit","resultEdit"])):Ie("",!0)])])}}};export{He as default};

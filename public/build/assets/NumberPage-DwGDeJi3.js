import{u as useToast,c as useI18n,r as ref,E as inject,f as resolveComponent,g as createElementBlock,h as openBlock,j as createVNode,k as unref,z as VaButton,l as withCtx,i as createBaseVNode,t as toDisplayString,n as axios,d as reactive,K as watch,V as VaForm,m as VaInput,x as createTextVNode,F as createBlock,G as createCommentVNode,L as VaModal,_ as _export_sfc,s as computed,o as onMounted,I as Fragment,J as renderList,M as VaSelect,N as VaTextarea,a as useStore,H as provide}from"./app-auAGtMLF.js";/* empty css                   */import{D as DxDataGrid,a as DxSelection,b as DxColumn}from"./data-grid-BHtestQa.js";import{a as anime}from"./anime.es-BNELU3II.js";const _hoisted_1$5={class:"h-full w-full text-center content-center"},_hoisted_2$5={class:"va-h3"},_sfc_main$5={__name:"DeleteBlog",props:["params"],setup(t){const{init:e}=useToast(),{t:a}=useI18n(),o=ref(!1),r=t,p=inject("ondeleted"),m=async()=>{try{const{data:f}=await axios.delete(`/pages/${r.params.data.id}`);f.status===200?(p(r.params.data),o.value=!1,e({message:a("login.successMessage"),color:"success"})):console.error("Error deleting data:",f.message)}catch(f){console.error("Error deleting data:",f)}};return(f,s)=>{const _=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$5,[createVNode(unref(VaButton),{round:"",icon:"delete",preset:"primary",class:"mt-1",onClick:s[0]||(s[0]=g=>o.value=!0)}),createVNode(_,{modelValue:o.value,"onUpdate:modelValue":s[1]||(s[1]=g=>o.value=g),"ok-text":unref(a)("modals.apply"),"cancel-text":unref(a)("modals.cancel"),onClose:s[2]||(s[2]=g=>o.value=!1),onOk:m,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$5,toDisplayString(unref(a)("modals.title")),1),createBaseVNode("p",null,toDisplayString(unref(a)("modals.message")),1)]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$4={class:"h-full w-full text-center content-center"},_hoisted_2$4={class:"grid grid-cols-1 md:grid-cols-1 gap-2 items-end w-full"},_sfc_main$4={__name:"EditBlog",props:["params"],setup(t){const{init:e}=useToast(),a=t,o=ref(!1),r=inject("onupdated"),p=ref([]),{t:m,locale:f}=useI18n(),s=reactive({StructureID:"",Name:"",NameRus:"",NumberPage:"",Comment:"",id:a.params.data.id}),_=async()=>{try{const h=await axios.get("/structure");p.value=h.data.map(S=>({value:S.id,text:f.value==="uz"?S.Name:S.NameRus}));const i=await axios.get(`pages/${a.params.data.id}`);s.StructureID=+i.data.StructureID,s.Name=i.data.Name,s.ShortName=i.data.ShortName,s.NumberPage=i.data.NumberPage,s.Comment=i.data.Comment}catch(h){console.error("Error fetching graphics data:",h)}},g=async()=>{try{const{data:h}=await axios.put("/pages",s);h.status===200?(r(a.params.node,h.unit),o.value=!1,e({message:m("login.successMessage"),color:"success"})):console.error("Error saving data:",h.message)}catch(h){console.error("Error saving data:",h)}};return watch(()=>s.StructureID,h=>{}),(h,i)=>{const S=resolveComponent("VaSelect"),N=resolveComponent("VaTextarea"),B=resolveComponent("VaModal");return openBlock(),createElementBlock("main",_hoisted_1$4,[createVNode(unref(VaButton),{round:"",icon:"edit",preset:"primary",class:"mt-1",onClick:i[0]||(i[0]=d=>(o.value=!0,_))}),createVNode(B,{modelValue:o.value,"onUpdate:modelValue":i[6]||(i[6]=d=>o.value=d),"ok-text":unref(m)("modals.apply"),"cancel-text":unref(m)("modals.cancel"),onOk:g,onClose:i[7]||(i[7]=d=>o.value=!1),"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",{class:"va-h3",onVnodeMounted:_},toDisplayString(unref(m)("modals.editFactory")),513),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$4,[createVNode(S,{modelValue:s.StructureID,"onUpdate:modelValue":i[1]||(i[1]=d=>s.StructureID=d),"value-by":"value",class:"mb-1",label:unref(m)("form.structureName"),options:p.value,clearable:""},null,8,["modelValue","label","options"])]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.NumberPage,"onUpdate:modelValue":i[2]||(i[2]=d=>s.NumberPage=d),type:"number",rules:[d=>d&&d.length>0||unref(m)("validation.requiredField")],label:unref(m)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.Name,"onUpdate:modelValue":i[3]||(i[3]=d=>s.Name=d),rules:[d=>d&&d.length>0||unref(m)("validation.requiredField")],label:unref(m)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:s.NameRus,"onUpdate:modelValue":i[4]||(i[4]=d=>s.NameRus=d),rules:[d=>d&&d.length>0||unref(m)("validation.requiredField")],label:unref(m)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode(N,{class:"w-full",modelValue:s.Comment,"onUpdate:modelValue":i[5]||(i[5]=d=>s.Comment=d),"max-length":"125",label:unref(m)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])])}}},_hoisted_1$3={class:"h-full w-full"},_hoisted_2$3={class:"va-h3 mb-4"},_sfc_main$3={__name:"AddForDocuments",props:["params"],setup(t){const{t:e}=useI18n(),{init:a}=useToast(),o=t,r=inject("onupdated"),p=ref(!1),m=ref([]),f=ref([]),s={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},_=async()=>{p.value=!0,f.value=[];try{const{data:N}=await axios.get(`/addfordoc/${o.params.data.NumberPage}`);m.value=h(N.tree),f.value=g(N.selected??[])}catch(N){console.error(N),a({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function g(N){return N.flat(3)}function h(N){const B=[];return N.forEach(d=>{var y;const D=d.key,c=d.title,n=parseInt(D.split("-")[1]);(y=d.children)==null||y.forEach(v=>{var C;const k=v.title,x=v.key,b=parseInt(x.split("-")[2]);(C=v.children)==null||C.forEach(w=>{var P;const l=w.title,u=w.key,$=parseInt(u.split("-")[3]);(P=w.children)!=null&&P.length&&w.children.forEach(I=>{B.push({rowId:I.ParameterID??`param-${I.key}`,sexName:c,sexId:n,pageName:k,pageId:b,groupName:l,groupId:$,paramName:I.title,ParameterID:I.ParameterID})})})})}),B}const i=({selectedRowKeys:N})=>{f.value=N},S=async()=>{const N=m.value.filter(n=>f.value.includes(n.rowId)),B=[...new Set(N.map(n=>n.sexId))],d=B.map(n=>{const y=N.filter(v=>v.sexId===n).map(v=>v.pageId);return[...new Set(y)]}),D=B.map(n=>{const y=N.filter(k=>k.sexId===n);return[...new Set(y.map(k=>k.pageId))].map(k=>{const x=y.filter(b=>b.pageId===k).map(b=>b.groupId);return[...new Set(x)]})}),c=B.map(n=>{const y=N.filter(k=>k.sexId===n);return[...new Set(y.map(k=>k.pageId))].map(k=>{const x=y.filter(C=>C.pageId===k);return[...new Set(x.map(C=>C.groupId))].map(C=>x.filter(l=>l.groupId===C).map(l=>l.ParameterID).filter(l=>l))})});try{const{data:n}=await axios.post("/addfordoc",{doc_id:o.params.data.NumberPage,FactoryStructureID:B,NumberPageBlogs:d,GroupBlogs:D,ParameterBlogs:c});if(n.status===200)r==null||r(),p.value=!1,a({message:e("login.successMessage"),color:"success"});else throw new Error(n.message||"Unknown error")}catch(n){console.error(n),a({message:e("errors.saveFailed"),color:"danger"})}};return(N,B)=>(openBlock(),createElementBlock("main",_hoisted_1$3,[createVNode(unref(VaButton),{icon:"design_services",round:"",preset:"primary",onClick:_}),createVNode(unref(VaModal),{modelValue:p.value,"onUpdate:modelValue":B[0]||(B[0]=d=>p.value=d),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:S,onClose:B[1]||(B[1]=d=>p.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$3,toDisplayString(unref(e)("modals.editFactory")),1),createTextVNode(toDisplayString(o.params.data.NumberPage)+" ",1),m.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":m.value,"key-expr":"rowId","selected-row-keys":f.value,onSelectionChanged:i,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:s},{default:withCtx(()=>[createVNode(unref(DxSelection),{mode:"multiple","show-check-boxes-mode":"always"}),createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name")},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"])]))}},_hoisted_1$2={class:"flex gap-4"},_hoisted_2$2={class:"calculator"},_hoisted_3$2={class:"answer"},_hoisted_4$2={class:"display"},_hoisted_5$1={class:"flex-1 min-w-[420px]"},_hoisted_6$1={class:"rounded border p-2 mb-3"},_hoisted_7={class:"flex flex-wrap items-center gap-2 mb-2"},_hoisted_8={class:"flex items-center gap-2"},_hoisted_9={class:"text-xs text-gray-500 ml-2"},_hoisted_10={class:"mb-3 flex flex-wrap gap-2"},_hoisted_11={key:0,class:"mb-3 flex flex-wrap gap-2"},_hoisted_12={key:1,class:"mb-3 flex flex-wrap gap-2"},_hoisted_13={class:"border rounded p-2 min-h-[160px]"},_hoisted_14={key:0,class:"flex flex-wrap gap-2"},_hoisted_15={key:1,class:"text-gray-500 text-sm"},_sfc_main$2={__name:"FormulaModal",props:{parameter:{type:[Number,String],required:!0},modelValue:{type:Boolean,default:!1},docId:{type:[Number],required:!0}},emits:["update:modelValue","save"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,openLocal=computed({get:()=>props.modelValue,set:t=>emit("update:modelValue",t)}),{init}=useToast(),items=ref([]),aggOptions=[{value:"RAW",label:"Asosiy"},{value:"HOUR",label:"Soatlik"},{value:"SHIFT",label:"Smenalik"},{value:"DAY",label:"Kunlik"},{value:"WEEK",label:"Haftalik"},{value:"MONTH",label:"Oylik"},{value:"YEAR",label:"Yillik"}],funcOptions=[{text:"Qiymat (joriy)",value:"VALUE"},{text:"O‘rtacha",value:"AVG"},{text:"Yig‘indi",value:"SUM"},{text:"Min",value:"MIN"},{text:"Max",value:"MAX"}],scopeOptions=[{text:"Joriy davr",value:"CURRENT"},{text:"Oldingi davr(lar)",value:"PREV"},{text:"Sirpanma oynaviy",value:"ROLLING"}],applyMode=ref("global"),agg=reactive({agg:"DAY",func:"VALUE",scope:"CURRENT",n:1}),aggSummary=computed(()=>{var a,o;const t=((a=aggOptions.find(r=>r.value===agg.agg))==null?void 0:a.label)??agg.agg,e=((o=funcOptions.find(r=>r.value===agg.func))==null?void 0:o.text)??agg.func;return agg.scope==="CURRENT"?`${t}, ${e}, joriy davr`:agg.scope==="PREV"?`${t}, ${e}, oldingi ${agg.n} davr`:`${t}, ${e}, oxirgi ${agg.n} davr (rolling)`});function appendParam(t){var s,_;const e=typeof agg.func=="object"?agg.func.value:agg.func,a=typeof agg.scope=="object"?agg.scope.value:agg.scope,o=[`Pid=${t.id}`,`agg=${agg.agg}`,`func=${e}`,`scope=${a}`];agg.scope!=="CURRENT"&&o.push(`n=${Number(agg.n)||1}`);const r=o.join("|");result.Calculate.push(r);const p=((s=aggOptions.find(g=>g.value===agg.agg))==null?void 0:s.label)||agg.agg,m=((_=funcOptions.find(g=>g.value===e))==null?void 0:_.text)||e;let f="joriy";a==="PREV"&&(f=`oldingi ${agg.n}`),a==="ROLLING"&&(f=`oxirgi ${agg.n}`),current.value+=`[${t.name||t.id}] ⟨${p} • ${m} • ${f}⟩`}const sel=reactive({sex:0,page:0,group:0}),pages=computed(()=>{var t,e;return((e=(t=items.value)==null?void 0:t[sel.sex])==null?void 0:e.pages)??[]}),groups=computed(()=>{var t,e;return((e=(t=pages.value)==null?void 0:t[sel.page])==null?void 0:e.groups)??[]}),parameters=computed(()=>{var t,e;return((e=(t=groups.value)==null?void 0:t[sel.group])==null?void 0:e.parameters)??[]}),logList=ref(""),current=ref(""),answer=ref(""),operatorClicked=ref(!0),result=reactive({Calculate:[],Comment:""});function anim(t){anime.timeline({targets:`#${t}`,duration:220,easing:"easeInOutCubic"}).add({backgroundColor:"#c1e3ff"}).add({backgroundColor:"#f4faff"})}function append(t){operatorClicked.value&&(current.value="",operatorClicked.value=!1),anim(typeof t=="string"?`n${t}`:"nX"),result.Calculate.push(String(t)),current.value+=String(t)}function addOp(t,e){anim(e),operatorClicked.value||(logList.value+=`${current.value} ${t} `,current.value="",operatorClicked.value=!0,result.Calculate.push(t))}const clear=()=>{addOp("","clear"),logList.value="",current.value="",answer.value="",result.Calculate=[],operatorClicked.value=!1},sign=()=>addOp("±","sign"),percent=()=>addOp("%","percent"),dot=()=>{current.value.includes(".")||append(".")},plus=()=>addOp("+","plus"),minus=()=>addOp("-","minus"),times=()=>addOp("*","times"),divide=()=>addOp("/","divide"),equal=()=>{addOp("=","equal");const expr=result.Calculate.map(t=>t.startsWith("Pid=")||t.startsWith("Static=")?"1":t).join("");try{answer.value=eval(expr)}catch{answer.value="Error"}};function selectSex(t){sel.sex=t,sel.page=0,sel.group=0}function selectPage(t){sel.page=t,sel.group=0}function selectGroup(t){sel.group=t}console.log(props);const loadedOnce=ref(!1),loading=ref(!1);async function loadTree(){var t;if(!loading.value){loading.value=!0;try{const e=((t=props.parameter)==null?void 0:t.id)??props.parameter,{data:a}=await axios.get(`/calculator-structure/${e}`);items.value=Array.isArray(a.items)?a.items:[],loadedOnce.value=!0}catch(e){console.error(e),init({message:"Strukturani yuklashda xatolik",color:"danger"})}finally{loading.value=!1}}}async function emitSave(){var e,a,o,r;const t={page_id_blog:props.parameter.id,doc_id:props.docId,param_id:(e=props.parameter)==null?void 0:e.ParameterID,sex_id:(a=props.parameter)==null?void 0:a.sexId,page_id:(o=props.parameter)==null?void 0:o.pageId,group_id:(r=props.parameter)==null?void 0:r.groupId,tokens:[...result.Calculate],comment:result.Comment||null};await axios.post("/svodkaFormula",t);try{const{data:p}=await axios.get(`/calculator-structure/${props.parameter.id}`);items.value=Array.isArray(p.items)?p.items:[]}catch(p){console.error(p),init({message:"Strukturani yuklashda xatolik",color:"danger"})}emit("save",t),openLocal.value=!1}return onMounted(loadTree),watch(openLocal,async t=>{t&&!loadedOnce.value&&await loadTree()}),watch(()=>{var t;return[props.docId,((t=props.parameter)==null?void 0:t.id)??props.parameter]},()=>{loadedOnce.value=!1}),(t,e)=>(openBlock(),createBlock(unref(VaModal),{modelValue:openLocal.value,"onUpdate:modelValue":e[18]||(e[18]=a=>openLocal.value=a),fullscreen:"",title:"Yangi formula yaratish","ok-text":"Tasdiqlash","cancel-text":"Bekor qilish",onOk:emitSave,"close-button":""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,toDisplayString(answer.value),1),createBaseVNode("div",_hoisted_4$2,toDisplayString(logList.value+current.value),1),createBaseVNode("div",{onClick:clear,id:"clear",class:"btn operator"},"C"),createBaseVNode("div",{onClick:sign,id:"sign",class:"btn operator"},"+/-"),createBaseVNode("div",{onClick:percent,id:"percent",class:"btn operator"},"%"),createBaseVNode("div",{onClick:divide,id:"divide",class:"btn operator"},"/"),createBaseVNode("div",{onClick:e[0]||(e[0]=a=>append("7")),id:"n7",class:"btn"},"7"),createBaseVNode("div",{onClick:e[1]||(e[1]=a=>append("8")),id:"n8",class:"btn"},"8"),createBaseVNode("div",{onClick:e[2]||(e[2]=a=>append("9")),id:"n9",class:"btn"},"9"),createBaseVNode("div",{onClick:times,id:"times",class:"btn operator"},"*"),createBaseVNode("div",{onClick:e[3]||(e[3]=a=>append("4")),id:"n4",class:"btn"},"4"),createBaseVNode("div",{onClick:e[4]||(e[4]=a=>append("5")),id:"n5",class:"btn"},"5"),createBaseVNode("div",{onClick:e[5]||(e[5]=a=>append("6")),id:"n6",class:"btn"},"6"),createBaseVNode("div",{onClick:minus,id:"minus",class:"btn operator"},"-"),createBaseVNode("div",{onClick:e[6]||(e[6]=a=>append("1")),id:"n1",class:"btn"},"1"),createBaseVNode("div",{onClick:e[7]||(e[7]=a=>append("2")),id:"n2",class:"btn"},"2"),createBaseVNode("div",{onClick:e[8]||(e[8]=a=>append("3")),id:"n3",class:"btn"},"3"),createBaseVNode("div",{onClick:plus,id:"plus",class:"btn operator"},"+"),createBaseVNode("div",{onClick:e[9]||(e[9]=a=>append("0")),id:"n0",class:"zero"},"0"),createBaseVNode("div",{onClick:dot,id:"dot",class:"btn"},"."),createBaseVNode("div",{onClick:equal,id:"equal",class:"btn operator"},"="),createBaseVNode("div",{onClick:e[10]||(e[10]=a=>append("(")),id:"lb",class:"btn p-4"},"("),createBaseVNode("div",{onClick:e[11]||(e[11]=a=>append(")")),id:"rb",class:"btn p-4"},")")]),createBaseVNode("div",_hoisted_5$1,[e[26]||(e[26]=createBaseVNode("div",{class:"mb-2 text-xs text-gray-500"},"Sex → Sahifa → Guruh",-1)),createBaseVNode("div",_hoisted_6$1,[e[25]||(e[25]=createBaseVNode("div",{class:"mb-2 text-xs text-gray-500"},"Agregatsiya va oynaviy qoida",-1)),createBaseVNode("div",_hoisted_7,[e[19]||(e[19]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Davr:",-1)),(openBlock(),createElementBlock(Fragment,null,renderList(aggOptions,a=>createVNode(unref(VaButton),{key:a.value,size:"small",color:a.value===agg.agg?"primary":"secondary",onClick:o=>agg.agg=a.value},{default:withCtx(()=>[createTextVNode(toDisplayString(a.label),1)]),_:2},1032,["color","onClick"])),64)),e[20]||(e[20]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Funktsiya:",-1)),createVNode(unref(VaSelect),{modelValue:agg.func,"onUpdate:modelValue":e[12]||(e[12]=a=>agg.func=a),options:funcOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),e[21]||(e[21]=createBaseVNode("span",{class:"ml-3 text-xs text-gray-500"},"Qamrov:",-1)),createVNode(unref(VaSelect),{modelValue:agg.scope,"onUpdate:modelValue":e[13]||(e[13]=a=>agg.scope=a),options:scopeOptions,"value-by":"value","text-by":"text",class:"min-w-[140px]"},null,8,["modelValue"]),agg.scope!=="CURRENT"?(openBlock(),createBlock(unref(VaInput),{key:0,modelValue:agg.n,"onUpdate:modelValue":e[14]||(e[14]=a=>agg.n=a),modelModifiers:{number:!0},type:"number",min:"1",class:"w-20",label:agg.scope==="PREV"?"nechta orqaga":"oyna hajmi"},null,8,["modelValue","label"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_8,[e[24]||(e[24]=createBaseVNode("span",{class:"text-xs text-gray-500"},"Qo'llash:",-1)),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="global"?"primary":"secondary",onClick:e[15]||(e[15]=a=>applyMode.value="global")},{default:withCtx(()=>e[22]||(e[22]=[createTextVNode("Global",-1)])),_:1,__:[22]},8,["color"]),createVNode(unref(VaButton),{size:"small",color:applyMode.value==="next"?"primary":"secondary",onClick:e[16]||(e[16]=a=>applyMode.value="next")},{default:withCtx(()=>e[23]||(e[23]=[createTextVNode(" Keyingi parametr",-1)])),_:1,__:[23]},8,["color"]),createBaseVNode("span",_hoisted_9,toDisplayString(aggSummary.value),1)])]),createBaseVNode("div",_hoisted_10,[(openBlock(!0),createElementBlock(Fragment,null,renderList(items.value,(a,o)=>(openBlock(),createBlock(unref(VaButton),{key:`sex-${a.sexId}`,size:"small",color:o===sel.sex?"primary":"secondary",onClick:r=>selectSex(o)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.sexName||`Sex #${a.sexId}`),1)]),_:2},1032,["color","onClick"]))),128))]),pages.value.length?(openBlock(),createElementBlock("div",_hoisted_11,[(openBlock(!0),createElementBlock(Fragment,null,renderList(pages.value,(a,o)=>(openBlock(),createBlock(unref(VaButton),{key:`page-${a.pageId}`,size:"small",color:o===sel.page?"primary":"secondary",onClick:r=>selectPage(o)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.pageName||`Sahifa ${a.pageId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),groups.value.length?(openBlock(),createElementBlock("div",_hoisted_12,[(openBlock(!0),createElementBlock(Fragment,null,renderList(groups.value,(a,o)=>(openBlock(),createBlock(unref(VaButton),{key:`grp-${a.groupId}`,size:"small",color:o===sel.group?"primary":"secondary",onClick:r=>selectGroup(o)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.groupName||`Guruh #${a.groupId}`),1)]),_:2},1032,["color","onClick"]))),128))])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_13,[parameters.value.length?(openBlock(),createElementBlock("div",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment,null,renderList(parameters.value,a=>(openBlock(),createBlock(unref(VaButton),{key:`param-${a.id}`,color:"warning","text-color":"black",style:{borderRadius:"0"},onClick:o=>appendParam(a)},{default:withCtx(()=>[createTextVNode(toDisplayString(a.name||a.id),1)]),_:2},1032,["onClick"]))),128))])):(openBlock(),createElementBlock("div",_hoisted_15,"Parametrlar topilmadi"))])])]),createVNode(unref(VaTextarea),{class:"w-full mt-3",modelValue:result.Comment,"onUpdate:modelValue":e[17]||(e[17]=a=>result.Comment=a),"max-length":125,label:"Izoh"},null,8,["modelValue"])]),_:1},8,["modelValue"]))}},FormulaModal=_export_sfc(_sfc_main$2,[["__scopeId","data-v-6581e339"]]),_hoisted_1$1={class:"h-full w-full"},_hoisted_2$1={class:"va-h3 mb-4"},_hoisted_3$1={class:"flex items-center justify-between w-full"},_hoisted_4$1={class:"flex items-center w-5/6"},_hoisted_5={key:0,class:"text-green-600"},_hoisted_6={class:"flex justify-between items-center w-1/6"},_sfc_main$1={__name:"ParamsControl",props:["params"],setup(t){const{t:e}=useI18n(),{init:a}=useToast(),o=t,r=inject("onupdated"),p=ref(!1),m=ref([]),f=ref([]),s={visible:!0,showInfo:!0,showPageSizeSelector:!0,allowedPageSizes:[10,20,50]},_=ref(!1),g=ref(null),h=ref("");function i(c,n){g.value={...c,id:n},h.value="",_.value=!0}const S=async()=>{p.value=!0,f.value=[];try{const{data:c}=await axios.get(`/addfordocSelect/${o.params.data.NumberPage}`);m.value=B(c.tree),f.value=N(c.selected)}catch(c){console.error(c),a({message:"Maʼlumotni olishda xatolik",color:"danger"})}};function N(c){return Array.isArray(c)?c.flat(5).filter(Boolean):[]}function B(c){const n=[];return Array.isArray(c)&&c.forEach(y=>{var x;const v=parseInt(String(y.key).split("-")[1]),k=y.title;(x=y.children)==null||x.forEach(b=>{var l;const C=parseInt(String(b.key).split("-")[2]),w=b.title;(l=b.children)==null||l.forEach(u=>{var I;const $=parseInt(String(u.key).split("-")[3]),P=u.title;(I=u.children)==null||I.forEach(V=>{n.push({rowId:V.ParameterID??`param-${V.key}`,sexName:k,sexId:v,pageName:w,pageId:C,groupName:P,groupId:$,paramName:V.title,ParameterID:V.ParameterID})})})})}),n}const d=({selectedRowKeys:c})=>{f.value=c},D=async()=>{const c=m.value.filter(x=>f.value.includes(x.rowId)),n=[...new Set(c.map(x=>x.sexId))],y=n.map(x=>{const b=c.filter(C=>C.sexId===x).map(C=>C.pageId);return[...new Set(b)]}),v=n.map(x=>{const b=c.filter(w=>w.sexId===x);return[...new Set(b.map(w=>w.pageId))].map(w=>{const l=b.filter(u=>u.pageId===w).map(u=>u.groupId);return[...new Set(l)]})}),k=n.map(x=>{const b=c.filter(w=>w.sexId===x);return[...new Set(b.map(w=>w.pageId))].map(w=>{const l=b.filter($=>$.pageId===w);return[...new Set(l.map($=>$.groupId))].map($=>l.filter(I=>I.groupId===$).map(I=>I.ParameterID).filter(Boolean))})});try{const{data:x}=await axios.post("/addfordoc",{doc_id:o.params.data.id,FactoryStructureID:n,NumberPageBlogs:y,GroupBlogs:v,ParameterBlogs:k});if(x.status===200)r==null||r(),p.value=!1,a({message:e("login.successMessage"),color:"success"});else throw new Error(x.message||"Unknown error")}catch(x){console.error(x),a({message:e("errors.saveFailed"),color:"danger"})}};return(c,n)=>{const y=resolveComponent("VaIcon");return openBlock(),createElementBlock("main",_hoisted_1$1,[createVNode(unref(VaButton),{icon:"star",round:"",preset:"primary",onClick:S}),createVNode(unref(VaModal),{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=v=>p.value=v),"ok-text":unref(e)("modals.apply"),"cancel-text":unref(e)("modals.cancel"),onOk:D,onClose:n[1]||(n[1]=v=>p.value=!1),"close-button":"","max-width":"1000px"},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_2$1,toDisplayString(unref(e)("modals.editFactory")),1),createTextVNode(toDisplayString(o.params.data)+" ",1),m.value.length?(openBlock(),createBlock(unref(DxDataGrid),{key:0,"data-source":m.value,"key-expr":"rowId","selected-row-keys":f.value,onSelectionChanged:d,"repaint-changes-only":!0,"show-borders":"","row-alternation-enabled":"","column-auto-width":"","word-wrap-enabled":"",pager:s},{paramCell:withCtx(({data:v})=>[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[f.value.includes(v.data.rowId)?(openBlock(),createElementBlock("span",_hoisted_5,"✅")):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(v.data.paramName),1)]),createBaseVNode("div",_hoisted_6,[createVNode(unref(VaButton),{round:"",color:"info",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:k=>i(v.data,o.params.data.id)},{default:withCtx(()=>[createVNode(y,{name:"calculate",size:"16px"})]),_:2},1032,["onClick"]),createVNode(unref(VaButton),{round:"",color:"primary",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:k=>c.onEdit(v.data)},{default:withCtx(()=>[createVNode(y,{name:"edit",size:"16px"})]),_:2},1032,["onClick"]),createVNode(unref(VaButton),{round:"",color:"danger",class:"m-1",style:{"--va-button-height":"30px","--va-button-padding":"0",width:"30px",minWidth:"30px",borderRadius:"9999px"},onClick:k=>c.deleteFormula(v.data)},{default:withCtx(()=>[createVNode(y,{name:"delete",size:"16px"})]),_:2},1032,["onClick"])])])]),default:withCtx(()=>[createVNode(unref(DxColumn),{"data-field":"sexName",caption:unref(e)("form.structureName"),"group-index":0},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"pageName",caption:unref(e)("form.numberpage"),"group-index":1},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"groupName",caption:unref(e)("menu.groups"),"group-index":2},null,8,["caption"]),createVNode(unref(DxColumn),{"data-field":"paramName",caption:unref(e)("form.name"),"cell-template":"paramCell","min-width":320,"allow-sorting":!1},null,8,["caption"])]),_:1},8,["data-source","selected-row-keys"])):createCommentVNode("",!0)]),_:1},8,["modelValue","ok-text","cancel-text"]),_.value?(openBlock(),createBlock(FormulaModal,{key:0,modelValue:_.value,"onUpdate:modelValue":n[2]||(n[2]=v=>_.value=v),parameter:g.value,formula:h.value,onSave:c.handleFormulaSave,onClose:c.handleFormulaClose},null,8,["modelValue","parameter","formula","onSave","onClose"])):createCommentVNode("",!0)])}}},ParamsControl=_export_sfc(_sfc_main$1,[["__scopeId","data-v-f7b20557"]]),_hoisted_1={class:"grid grid-rows-[55px,1fr]"},_hoisted_2={class:"flex justify-between"},_hoisted_3={class:"va-h3"},_hoisted_4={class:"flex-grow"},_sfc_main={__name:"NumberPage",props:{id:Number},setup(t){const{init:e}=useToast(),a=useStore(),{locale:o,t:r}=useI18n(),p=t,m=ref([]),f=ref(null),s=ref(!1),_=ref([]),g=reactive({StructureID:p.id,Name:"",NameRus:"",NumberPage:"",Comment:""}),h=computed(()=>a.state.user.roles[17]),i=l=>{var u,$;return(($=(u=h.value)==null?void 0:u.pivot)==null?void 0:$[l])==="1"},S=l=>p.id===22,N=computed(()=>i("create")),B=computed(()=>i("update")),d=computed(()=>i("delete"));computed(()=>S);function D(l){f.value.applyTransaction({remove:[l]})}function c(l,u){l.setData(u)}provide("ondeleted",D),provide("onupdated",c);const n=computed(()=>{const l=[{headerName:r("table.headerRow"),valueGetter:"node.rowIndex + 1"},{headerName:r("table.structure"),field:x(),flex:1},{headerName:r("table.name"),field:v(),flex:1},{headerName:r("table.numberpage"),field:"NumberPage"},{headerName:r("table.comment"),field:k()}];return p.id==22&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:ParamsControl}),p.id==22&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$3}),B.value&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$4}),d.value&&l.push({cellClass:["px-0"],headerName:"",field:"",width:70,cellRenderer:_sfc_main$5}),l}),y={sortable:!0,filter:!0},v=()=>o.value==="uz"?"Name":"NameRus",k=()=>o.value==="uz"?"ShortName":"ShortNameRus",x=()=>o.value==="uz"?"SName":"NameRus",b=async()=>{try{const l=await axios.get(`/getRowPage/${p.id}`);m.value=Array.isArray(l.data)?l.data:l.data.items}catch(l){console.error("Error fetching data:",l)}},C=async()=>{try{const l=await axios.get("/structure");_.value=l.data.map(u=>({value:u.id,text:o.value==="uz"?u.Name:u.NameRus}))}catch(l){console.error("Error fetching graphics data:",l)}},w=async()=>{try{const{data:l}=await axios.post("/pages",g);l.status===200?(s.value=!1,g.StructureID="",g.Name="",g.NameRus="",g.NumberPage="",g.Comment="",await b(),e({message:r("login.successMessage"),color:"success"})):console.error("Error saving data:",l.message)}catch(l){console.error("Error saving data:",l)}};return onMounted(()=>{const l=localStorage.getItem("locale");l&&(o.value=l),b(),C()}),computed(()=>o.value==="uz"?"Русский":"O‘zbek"),(l,u)=>{const $=resolveComponent("VaTextarea"),P=resolveComponent("VaModal"),I=resolveComponent("ag-grid-vue");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("main",null,[createBaseVNode("div",_hoisted_2,[u[7]||(u[7]=createBaseVNode("span",{class:"flex w-full"},null,-1)),N.value?(openBlock(),createBlock(unref(VaButton),{key:0,onClick:u[0]||(u[0]=V=>(s.value=!0,C)),class:"w-14 h-12 mt-1 mr-1",icon:"add"})):createCommentVNode("",!0)]),createVNode(P,{modelValue:s.value,"onUpdate:modelValue":u[5]||(u[5]=V=>s.value=V),"ok-text":unref(r)("buttons.save"),"cancel-text":unref(r)("buttons.cancel"),onOk:w,"close-button":""},{default:withCtx(()=>[createBaseVNode("h3",_hoisted_3,toDisplayString(unref(r)("modals.addPageTitle")),1),createBaseVNode("div",null,[createVNode(unref(VaForm),{ref:"formRef",class:"flex flex-col items-baseline gap-1"},{default:withCtx(()=>[createVNode(unref(VaInput),{class:"w-full",modelValue:g.NumberPage,"onUpdate:modelValue":u[1]||(u[1]=V=>g.NumberPage=V),type:"number",rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.numberpage")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:g.Name,"onUpdate:modelValue":u[2]||(u[2]=V=>g.Name=V),rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.name")},null,8,["modelValue","rules","label"]),createVNode(unref(VaInput),{class:"w-full",modelValue:g.NameRus,"onUpdate:modelValue":u[3]||(u[3]=V=>g.NameRus=V),rules:[V=>V&&V.length>0||unref(r)("validation.requiredField")],label:unref(r)("form.nameRus")},null,8,["modelValue","rules","label"]),createVNode($,{class:"w-full",modelValue:g.Comment,"onUpdate:modelValue":u[4]||(u[4]=V=>g.Comment=V),"max-length":"125",label:unref(r)("form.comment")},null,8,["modelValue","label"])]),_:1},512)])]),_:1},8,["modelValue","ok-text","cancel-text"])]),createBaseVNode("main",_hoisted_4,[createVNode(I,{rowData:m.value,columnDefs:n.value,defaultColDef:y,animateRows:"true",class:"ag-theme-material h-full",onGridReady:u[6]||(u[6]=V=>f.value=V.api)},null,8,["rowData","columnDefs"])])])}}};export{_sfc_main as default};
